{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"CAP","text":"<p>CAP is a library based on .net standard, which is a solution to deal with distributed transactions, also has the function of EventBus, it is lightweight, easy to use, and efficient.</p>"},{"location":"#introduction","title":"Introduction","text":"<p>In the process of building an SOA or MicroService system, we usually need to use the event to integrate each service. In the process, simple use of message queue does not guarantee reliability. CAP adopts local message table program integrated with the current database to solve exceptions that may occur in the process of the distributed system calling each other. It can ensure that the event messages are not lost in any case.</p> <p>You can also use CAP as an EventBus. CAP provides a simpler way to implement event publishing and subscriptions. You do not need to inherit or implement any interface during subscription and sending process.</p> <p>CAP implements the Outbox Pattern described in the eShop ebook</p> <p></p> <p>Atomicity when publishing events to the event bus with a worker microservice</p> <p>For detailed instructions see the Getting Started Guide.</p>"},{"location":"#contributing","title":"Contributing","text":"<p>One of the easiest ways to contribute is to participate in discussions and discuss issues. You can also contribute by submitting pull requests with code changes.</p> <p>If you have any question or problems, please report them on the CAP repository:</p> <p> Report Issue  Active Issues </p>"},{"location":"#license","title":"License","text":"<p>CAP is licensed under the MIT license.</p>"},{"location":"about/contact-us/","title":"Contact Us","text":""},{"location":"about/contact-us/#authors","title":"Authors","text":"<ul> <li>Author: @yang-xiaodong</li> <li>Email: yangxiaodong1214@126.com</li> <li>Blogs: https://savorboard.cnblogs.com</li> </ul>"},{"location":"about/contact-us/#ncc-organization","title":"NCC Organization","text":"<ul> <li>Email: dotnetcn@outlook.com</li> <li>Twitter: https://twitter.com/ncc_community</li> <li>Weibo: https://weibo.com/dotnetcore</li> </ul>"},{"location":"about/license/","title":"License","text":"<p>MIT License</p> <p>Copyright \u00a9 2016 - 2023 Savorboard</p> <p>Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the \"Software\"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:</p> <p>The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.</p> <p>THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</p>"},{"location":"about/release-notes/","title":"Release Notes","text":""},{"location":"about/release-notes/#version-700-2022-11-27","title":"Version 7.0.0 (2022-11-27)","text":"<p>Breaking Changes:</p> <ul> <li><code>SubscribeFilter</code> method to asynchronous.</li> <li><code>IConsumerClient</code> interface <code>OnMessage</code> and <code>OnLog</code> is from event to delegate.</li> </ul> <p>Features:</p> <ul> <li>Performance improvement</li> <li>Add support publish delay message. (#1237)</li> <li>Dashbord support viewing and immediately publish for delayed messages.</li> <li>Add support for metrics diagnostics. (#1230)</li> <li>Dashboard support real-time metric graph viewing.</li> <li>Add support manual start/stop CAP process. (#1238)</li> <li>Add EnableConsumerPrefetch option of consumer. (#1240)</li> <li>Add PublishConfirms options for RabbitMQ.</li> </ul> <p>Others:</p> <ul> <li>Change framework target from netstandard to net6.</li> <li>Upgrade NuGet to the latest version.</li> </ul> <p>Bug Fixed:</p> <ul> <li>RabbitMQ cluster connection failed without using default ports. (#1232)</li> </ul>"},{"location":"about/release-notes/#version-621-2022-10-15","title":"Version 6.2.1 (2022-10-15)","text":"<p>Bug Fixed:</p> <ul> <li>Fixed EnvironmentVariableTarget.Machine only supported on windows. (#1220) Thanks @cuibty</li> <li>Fixed RedisStream TryGetOrCreateStreamGroupAsync to create ConsumerGroup when not found. (#1212) Thanks @mlatoszek</li> </ul>"},{"location":"about/release-notes/#version-620-2022-09-19","title":"Version 6.2.0 (2022-09-19)","text":"<p>Features:</p> <ul> <li>Add Chinese support for dashboard localization.  (#1157)  Thanks @tetris1128</li> <li>Make DbTransaction property virtual for extend of CapTransactionBase. (#1179)  @yang-xiaodong </li> <li>Add logs for duplicate subscriber in same group. (#1186)  @yang-xiaodong </li> <li>Record the Instance Id in the executed received messages. (#1187)  @yang-xiaodong </li> </ul> <p>Bug Fixed:</p> <ul> <li>SnowflakeId excludes virtual and loopback and non-working NICs. (#1163)  Thanks @xiatiandegaga</li> <li>Fixed the health check could not get the status correctly when RabbitMQ lost connection and quickly recovered. (#1193) Thanks @rpenha</li> <li>Fixed dashboard gateway proxy request missing QueryString (#1168) Thanks @wwwu</li> <li>Fixed the disconnect detection of RabbitMQ connection abnormality. (#1178)</li> <li>Fixed Mongo queries not returning results when a element convention name is registered. (#1193) Thanks @rpenha</li> <li>Fixed subscriber lookup in scoped lifecycle of factory mode. (#1204) Thanks @sampsonye</li> </ul>"},{"location":"about/release-notes/#version-610-2022-06-10","title":"Version 6.1.0 (2022-06-10)","text":"<p>Features:</p> <ul> <li>Optimize snowflake algorithm. (#1065)  Thanks @Allen-dududu</li> <li>Add authorization policy option feature to CAP dashboard. (#1113)  Thanks @albertopm19</li> <li>Added support of ScheduledEnqueueTimeUtc for AzureServiceBus transport. (#1137)  Thanks @webinex</li> <li>Add option to configure failed messages expiration term. (#1142) Thanks @dima-zhemkov</li> </ul> <p>Bug Fixed:</p> <ul> <li>Fixed sequence validation error when both enable Challenge and Auth of dashboard authentication. (#1097)</li> <li>Used concurrentdictionary since PublishedMessages and ReceivedMessages are public and accessed from various places. (#1104) Thanks @wakiter</li> <li>Fixed the health check could not get the status correctly when RabbitMQ lost connection and quickly recovered. (#1140)</li> <li>Fixed date file format bug when retrying query from database. (#1143)</li> <li>Change reading/creating streams and consumer groups to handle non idempotent operations. (#1150) Thanks @MahmoudSamir101</li> </ul>"},{"location":"about/release-notes/#version-601-2022-02-15","title":"Version 6.0.1 (2022-02-15)","text":"<p>Bug Fixed:</p> <ul> <li>Fixed kafka consume excepiton for GroupLoadInProress errcode (#1085)</li> <li>Fixed deserialization exception when message body is empty byte array. (#1087)</li> <li>Fixed dashboard authentication challenge bug. (#1077)</li> </ul>"},{"location":"about/release-notes/#version-600-2022-01-06","title":"Version 6.0.0 (2022-01-06)","text":"<p>Features:</p> <ul> <li>Fully support .NET 6.</li> <li>Add support for OpenTelemetry. (#885)</li> <li>Improve support for NATS JetStream wildcard topic. (#1047)</li> <li>Add support customer header options for Azure Service Bus. (#1063) Thanks @Mateus Viegas</li> </ul>"},{"location":"about/release-notes/#version-520-2021-11-12","title":"Version 5.2.0 (2021-11-12)","text":"<p>Features:</p> <ul> <li>Add support for NATS JetStream. (#983)</li> <li>Add support for Apache Pulsar. (#610)</li> <li>Add possibility to process messages for each consumer group indepedently. (#1027)</li> </ul> <p>Bug Fixed:</p> <ul> <li>Fixed message content of bigint type cannot be displayed correctly in dashboard. (#1028)</li> <li>Fixed unobserved tasks of async method calls in Amazon SQS. (#1033)</li> <li>Fixed RabbitMQ federation plugin message header object values cause exceptions. (#1036)</li> </ul>"},{"location":"about/release-notes/#version-512-2021-07-26","title":"Version 5.1.2 (2021-07-26)","text":"<p>Bug Fixed:</p> <ul> <li>Fixed consumer register cancellation token source null referencee bug. (#952)</li> <li>Fixed redis streams transport cluster keys cross-hashslot bug. (#944)</li> </ul>"},{"location":"about/release-notes/#version-511-2021-07-09","title":"Version 5.1.1 (2021-07-09)","text":"<p>Features:</p> <ul> <li>Improve flow control for message cache of in memory. (#935)</li> <li>Add cancellation token support to subscribers. (#912)</li> <li>Add pathbase options for dashbaord. (#901)</li> <li>Add custom authorization scheme support for dashbaord. (#906)</li> </ul> <p>Bug Fixed:</p> <ul> <li>Fixed mysql connect timeout expired bug. (#931)</li> <li>Fixed consul health check path invalid bug. (#921)</li> <li>Fixed mongo dashbaord query bug. (#909)</li> </ul>"},{"location":"about/release-notes/#version-510-2021-06-07","title":"Version 5.1.0 (2021-06-07)","text":"<p>Features:</p> <ul> <li>Add configure options for json serialization. (#879)</li> <li>Add Redis Streams transport support. (#817)</li> <li>New dashboard build with vue. (#880)</li> <li>Add subscribe filter support. (#894)</li> </ul> <p>Bug Fixed:</p> <ul> <li>Fixed use CapEFDbTransaction to get dbtransaction extension method bug. (#868)</li> <li>Fixed pending message has not been deleted from buffer list in SQL Server. (#889)</li> <li>Fixed dispatcher processing when storage message exception bug. (#900)</li> </ul>"},{"location":"about/release-notes/#version-503-2021-05-14","title":"Version 5.0.3 (2021-05-14)","text":"<p>Bug Fixed:</p> <ul> <li>Fix the bug of getting db transaction through the IDbContextTransaction for SQLServer. (#867)</li> <li>Fix RabbitMQ Connection close forced. (#861)</li> </ul>"},{"location":"about/release-notes/#version-502-2021-04-28","title":"Version 5.0.2 (2021-04-28)","text":"<p>Features:</p> <ul> <li>Add support for Azure Service Bus sessions. (#829)</li> <li>Add custom message headers support for RabbitMQ consumer. (#818)</li> </ul> <p>Bug Fixed:</p> <ul> <li>Downgrading Microsoft.Data.SqlClient to 2.0.1. (#839)</li> <li>DiagnosticObserver does not use null connection. (#845)</li> <li>Fix null reference in AmazonSQSTransport. (#846)</li> </ul>"},{"location":"about/release-notes/#version-501-2021-04-07","title":"Version 5.0.1 (2021-04-07)","text":"<p>Features:</p> <ul> <li>Add KafkaOptions.MainConfig to AutoCreateTopic. (#810)</li> <li>Add support rewriting the default configuration of Kafka consumer. (#822)</li> <li>Add DefaultChallengeScheme dashboard options to specify dashboard auth challenge scheme. (#815)</li> </ul> <p>Bug Fixed:</p> <ul> <li>Fixed topic selector in IConsumerServiceSelector. (#806)</li> <li>Update AWS topic subscription and SQS access policy generation. (#808)</li> <li>Fixed memory leak when using transction to publish message. (#816)</li> <li>Fixed SQL content filter on IMonitoringApi.PostgreSql.cs. (#814)</li> <li>Fixed the expiration time display problem in the dashboard due to time zone issues (#820)</li> <li>Fixed the creation timing of Kafka automatically creating Topic. (#823)</li> <li>Fixed Dashboard metric not update. (#819)</li> </ul>"},{"location":"about/release-notes/#version-500-2021-03-23","title":"Version 5.0.0 (2021-03-23)","text":"<p>Features:</p> <ul> <li>Upgrade to .NET Standard 2.1 and support .NET 5. (#727)</li> <li>Replace Newtonsoft.Json to System.Text.Json. (#740)</li> <li>Support NATS Transport. (#595,#743)</li> <li>Enabling publiser confirms for RabbitMQ. (#730)</li> <li>Support query subscription from DI implementation factory. (#756)</li> <li>Add options to create lazy queue for RabbitMQ. (#772)</li> <li>Support to add custom tags for Consul. (#786)</li> <li>Support custom group and topic prefiex. (#780)</li> <li>Renemae DefaultGroup option to DefaultGroupName.</li> <li>Add auto create topic at startup for Kafka. (#795,#744)</li> </ul> <p>Bug Fixed:</p> <ul> <li>Fixed retrying process earlier than consumer registration to DI. (#760)</li> <li>Fixed Amazon SQS missing pagination topics. (#765)</li> <li>Fixed RabbitMQ MessageTTL option to int type. (#787)</li> <li>Fixed Dashboard auth. (#793)</li> <li>Fixed ClientProvidedName could not be renamed for RabbitMQ. (#791)</li> <li>Fixed EntityFramework transaction will not rollback when exception occurred. (#798)</li> </ul>"},{"location":"about/release-notes/#version-312-2020-12-03","title":"Version 3.1.2 (2020-12-03)","text":"<p>Features: * Support record the exception message in the headers. (#679) * Support consul service check for https. (#722) * Support custom producer threads count options for sending. (#731) * Upgrade dependent nuget packages to latest.</p> <p>Bug Fixed:</p> <ul> <li>Fixed InmemoryQueue expired messages are not removed bug. (#691)</li> <li>Fixed Executor key change lead to possible null reference exception. (#698)</li> <li>Fixed Postgresql delete expires data logic error. (#714)</li> </ul>"},{"location":"about/release-notes/#version-311-2020-09-23","title":"Version 3.1.1 (2020-09-23)","text":"<p>Features:</p> <ul> <li>Add consumer parameter with interface suppport. (#669)</li> <li>Add custom correlation id and message id support. (#668)</li> <li>Enhanced custom serialization support. (#641)</li> </ul> <p>Bug Fixed:</p> <ul> <li>Solve the issue of being duplicated executors from different assemblies. (#666)</li> <li>Added comparer to remove duplicate ConsumerExecutors. (#653)</li> <li>Add re-enable the auto create topics configuration item for Kafka, it's false by default. now is true. (#635)</li> <li>Fixed postgresql transaction rollback invoke bug. (#640)</li> <li>Fixed SQLServer table name customize bug. (#632)</li> </ul>"},{"location":"about/release-notes/#version-310-2020-08-15","title":"Version 3.1.0 (2020-08-15)","text":"<p>Features:</p> <ul> <li>Add Amazon SQS support. (#597)</li> <li>Remove Dapper and replace with ADO.NET in storage project. (#583)</li> <li>Add debug symbols package to nuget.</li> <li>Upgrade dependent nuget package version to latest.</li> <li>English docs grammar correction. Thanks @mzorec</li> </ul> <p>Bug Fixed:</p> <ul> <li>Fix mysql transaction rollback bug. (#598)</li> <li>Fix dashboard query bug. (#600)</li> <li>Fix mongo db query bug. (#611)</li> <li>Fix dashboard browser language detection bug. (#631)</li> </ul>"},{"location":"about/release-notes/#version-304-2020-05-27","title":"Version 3.0.4 (2020-05-27)","text":"<p>Bug Fixed:</p> <ul> <li>Fix kafka consumer group does not works bug. (#541)</li> <li>Fix cast object to primitive types failed bug. (#547)</li> <li>Fix subscriber primitive types convert exception. (#568)</li> <li>Add conosole app sample.</li> <li>Upgrade Confluent.Kafka to 1.4.3</li> </ul>"},{"location":"about/release-notes/#version-303-2020-04-01","title":"Version 3.0.3 (2020-04-01)","text":"<p>Bug Fixed:</p> <ul> <li>Change ISubscribeInvoker interface access modifier to public. (#537)</li> <li>Fix rabbitmq connection may be reused when close forced. (#533)</li> <li>Fix dahsboard message reexecute button throws exception bug. (#525)</li> </ul>"},{"location":"about/release-notes/#version-302-2020-02-05","title":"Version 3.0.2 (2020-02-05)","text":"<p>Bug Fixed:</p> <ul> <li>Fixed diagnostics event data object error. (#504 )</li> <li>Fixed RabbitMQ transport check not working. (#503 )</li> <li>Fixed Azure Service Bus subscriber error. (#502  )</li> </ul>"},{"location":"about/release-notes/#version-301-2020-01-19","title":"Version 3.0.1 (2020-01-19)","text":"<p>Bug Fixed:</p> <ul> <li>Fixed Dashboard requeue and reconsume failed bug.  (#482 )</li> <li>Fixed Azure service bus null reference exception. (#483 )</li> <li>Fixed type cast exception from storage. (#473 )</li> <li>Fixed SqlServer  connection undisponse bug. (#477 )</li> </ul>"},{"location":"about/release-notes/#version-300-2019-12-30","title":"Version 3.0.0 (2019-12-30)","text":"<p>Breaking Changes:</p> <p>In this version, we have made major improvements to the code structure, which have introduced some destructive changes.</p> <ul> <li> <p>Publisher and Consumer are not compatible with older versions This version is not compatible with older versions of the message protocol because we have improved the format in which messages are published and stored.</p> </li> <li> <p>Interface changes We have done a lot of refactoring of the code, and some of the interfaces may be incompatible with older versions</p> </li> <li> <p>Detach the dashboard project</p> </li> </ul> <p>Features:</p> <ul> <li>Supports .NET Core 3.1.</li> <li>Upgrade dependent packages.</li> <li>New serialization interface <code>ISerializer</code> to support serialization of message body sent to MQ.</li> <li>Add new api for <code>ICapPublisher</code> to publish message with headers.</li> <li>Diagnostics event structure and names improved. #378</li> <li>Support consumer method to read the message headers. #472</li> <li>Support rename message storage tables. #435</li> <li>Support for Kafka to write such as Offset and Partition to the header. #374</li> <li>Improved the processor retry interval time. #444</li> </ul> <p>Bug Fixed:</p> <ul> <li>Fixed SqlServer dashboard sql query bug. #470</li> <li>Fixed Kafka health check bug. #436</li> <li>Fixed dashboard bugs. #412 #404</li> <li>Fixed transaction bug for sql server when using EF. #402</li> </ul>"},{"location":"about/release-notes/#version-260-2019-08-29","title":"Version 2.6.0 (2019-08-29)","text":"<p>Features:</p> <ul> <li>Improvement Diagnostic support. Thanks @gfx687 </li> <li>Improvement documention. https://cap.dotnetcore.xyz</li> <li>Improvement <code>ConsumerInvoker</code> implementation. Thanks @hetaoos</li> <li>Support multiple consumer threads. (#295)</li> <li>Change DashboardMiddleware to async. (#390) Thanks @liuzhenyulive </li> </ul> <p>Bug Fixed:</p> <ul> <li>SQL Server Options Bug.</li> <li>Fix transaction scope disposed bug. (#365)</li> <li>Fix thread safe issue of ICapPublisher bug. (#371)</li> <li>Improved Ctrl+C action raised exception issue.</li> <li>Fixed asynchronous exception catching bug of sending.</li> <li>Fix MatchPoundUsingRegex \".\" not escaped bug (#373)</li> </ul>"},{"location":"about/release-notes/#version-251-2019-06-21","title":"Version 2.5.1 (2019-06-21)","text":"<p>Features:</p> <ul> <li>Improved logs record.</li> <li>Upgrade dependent nuget packages version. (MySqlConnector, confluent-kafka-dotnet-1.0 )</li> <li>NodeId type change to string of DiscoveryOptions for Consul. (#314)</li> <li>Change the IConsumerServiceSelector interface access modifier to public. (#333)</li> <li>Improved RabbitMQOptions to provide extensions option to configure the client original configuration. (#350)</li> <li>Add index for MongoDB CAP collections. (#353)</li> </ul> <p>Bugs Fixed:</p> <ul> <li>Fixed consumer re-register transport bug. (#329)</li> <li>Handle messages retrieval failure. (#324)</li> <li>Fixed DiagnosticListener  null reference exception bug. (#335)</li> <li>Add subscription name validation for the AzureServerBus. (#344)</li> <li>Fixed thread safety issues of publisher. (#331)</li> </ul>"},{"location":"about/release-notes/#version-250-2019-03-30","title":"Version 2.5.0 (2019-03-30)","text":"<p>Features:</p> <ul> <li>Support Azure Service Bus. (#307)</li> <li>Support In-Memory Storage. (#296)</li> <li>Upgrade Dapper to version 1.60.1</li> <li>Support read environment variables CAP_WORKERID and CAP_DATACENTERID as the snowflake algorithm workerid and datacenterid.</li> </ul> <p>Bug Fixed:</p> <ul> <li>Modify MySQL cap table encoding to utf8mb4. (#305)</li> <li>Move CapSubscribeAttribute class to DotNetCore.CAP project.</li> <li>Fixed multiple instance snowflake algorithm generating primary key conflicts. (#294)</li> </ul>"},{"location":"about/release-notes/#version-242-2019-01-08","title":"Version 2.4.2 (2019-01-08)","text":"<p>Features:</p> <ul> <li>Startup the CAP with the .NET Core 2.1 BackgroundService. (#265)</li> <li>Improved message delivery performance. #261</li> </ul> <p>Bug Fixed:</p> <ul> <li>Fixed PostgreSql version isolation feature bug. (#256)</li> <li>Fixed SQL Server sql bug for dashboard search. (#266)</li> </ul>"},{"location":"about/release-notes/#version-241-2018-12-19","title":"Version 2.4.1 (2018-12-19)","text":"<p>Bug Fixed:</p> <ul> <li>Fixed MongoDB version isolation feature bug. (#253)</li> </ul>"},{"location":"about/release-notes/#version-240-2018-12-08","title":"Version 2.4.0 (2018-12-08)","text":"<p>Features:</p> <ul> <li>Supported version options. (#220)</li> <li>Upgrade nuget package to .net core 2.2.</li> </ul> <p>Breaking Changes:</p> <p>In order to support the \"version isolation\" feature, we introduced a new version field in version 2.4.0 to isolate different versions of the message, so this requires some adjustments to the database table structure. You can use the following SQL to add a version field to your database CAP related table.</p> <p>MySQL <pre><code>ALTER TABLE `cap.published` ADD Version VARCHAR(20) NULL;\nALTER TABLE `cap.received` ADD Version VARCHAR(20) NULL;\n</code></pre></p> <p>SQL Server <pre><code>ALTER TABLE Cap.[Published] ADD Version VARCHAR(20) NULL;\nALTER TABLE Cap.[Received] ADD Version VARCHAR(20) NULL;\n</code></pre></p> <p>PostgreSQL <pre><code>ALTER TABLE cap.published ADD  \"Version\" VARCHAR(20) NULL;\nALTER TABLE cap.received ADD \"Version\" VARCHAR(20) NULL;\n</code></pre></p> <p>MongoDb <pre><code>db.CapPublishedMessage.update({},{\"$set\" : {\"Version\" : \"1\"}});\ndb.CapReceivedMessage.update({},{\"$set\" : {\"Version\" : \"1\"}});\n</code></pre></p> <p>Bug Fixed:</p> <ul> <li>Fixed different groups of the same topic name in one instance will cause routing bug. (#235)</li> <li>Fixed message presistence bug. (#240)</li> <li>Fixed RabbitMQ topic name contains numbers will cause exception bug. (#181)</li> </ul>"},{"location":"about/release-notes/#version-231-2018-10-29","title":"Version 2.3.1 (2018-10-29)","text":"<p>Features:</p> <ul> <li>Add Source Link Support</li> <li>Upgrade dependent NuGet packages.</li> </ul> <p>Bug Fixed:</p> <ul> <li>Fixed dashboard messages requeue error. (#205)</li> <li>Adjustment snowflake workerId to random id.</li> <li>Fixed flush unclaer data bug.</li> </ul>"},{"location":"about/release-notes/#version-230-2018-08-30","title":"Version 2.3.0 (2018-08-30)","text":"<p>In this version, we made some breaking changes for the publisher API, you can see this blog to understand the story behind.</p> <p>If you have any migration question, please comment in issue (#190).</p> <p>Breaking Changes:</p> <ul> <li>Removed app.UseCap() from Startup.cs</li> <li>Message table primary key data type has been modified to Bigint and non auto-Increment. (#180)</li> <li>New publisher Api. (#188)</li> </ul> <p>Features:</p> <ul> <li>MongoDb supported. (#143)</li> <li>Automatic commit transaction. (#191)</li> </ul> <p>Bug Fixed:</p> <ul> <li>Fix message still sent if transaction faild bug. (#118)</li> <li>Multiple events in one transaction. (#171)</li> </ul>"},{"location":"about/release-notes/#version-225-2018-07-19","title":"Version 2.2.5 (2018-07-19)","text":"<p>Features: - Performance improvement</p> <p>Bug Fixed:</p> <ul> <li>Fixed message enqueue exception.</li> <li>Fixed Retry processor bugs.</li> <li>Fixed Kafka producer exception log without logging when publish message.</li> <li>Fixed Incorrect local IP address judgment of IPv6. (#140)</li> <li>Fixed DateTime localization format conversion error to sql. (#139)</li> <li>Fixed dashboard message page re-requeue and re-executed operate bug. (#158)</li> <li>Fixed SendAsync or ExecuteAsync recursion retries bug. (#160)</li> <li>Fixed configuration options of FailedThresholdCallback could not be invoke when the value less then three. (#161)</li> </ul>"},{"location":"about/release-notes/#version-224-2018-06-05","title":"Version 2.2.4 (2018-06-05)","text":"<p>Because version 2.2.3 was not released to nuget, so released 2.2.4.</p>"},{"location":"about/release-notes/#version-223-2018-06-05","title":"Version 2.2.3 (2018-06-05)","text":"<p>Features:</p> <ul> <li>Improved log output.</li> <li>Upgrade nuget packages.</li> <li>Support pattern matching for consumer. (#132)</li> </ul> <p>Bug Fixed:</p> <ul> <li>Fixed exception thrown when terminate the program with Ctrl+C. (#130)</li> </ul>"},{"location":"about/release-notes/#version-222-2018-04-28","title":"Version 2.2.2 (2018-04-28)","text":"<p>Features:</p> <ul> <li>Improved log output. #114</li> <li>Add default timeout configuration for kafka client.</li> <li>Rename configuration options FailedCallback to FailedThresholdCallback.</li> </ul> <p>Bug Fixed:</p> <ul> <li>Fixed message enqueue exception.</li> <li>Fixed retry processor bugs.</li> <li>Fixed kafka producer exception log without logging when publish message.</li> </ul>"},{"location":"about/release-notes/#version-221-2018-04-18","title":"Version 2.2.1 (2018-04-18)","text":"<p>Bug Fixed:</p> <ul> <li>Fixed message enqueue bug in v2.2</li> </ul>"},{"location":"about/release-notes/#version-220-2018-04-17","title":"Version 2.2.0 (2018-04-17)","text":"<p>Features:</p> <ul> <li>Remove database queue mode. (#102)</li> <li>Support for Diagnostics. (#112)</li> <li>Upgrade dependent nuget packages.</li> </ul> <p>Bug Fixed:</p> <ul> <li>Fixed bug of the FailedRetryCount does not increase when raised SubscribeNotFoundException. (#90)</li> </ul>"},{"location":"about/release-notes/#version-214-2018-03-16","title":"Version 2.1.4 (2018-03-16)","text":"<p>Features:</p> <ul> <li>Remove TableNamePrefix option from MySqlOptions to EFOptions.</li> <li>Upgrade nuget package</li> </ul> <p>Bug Fixed:</p> <ul> <li>Fixed the connection bug of getting message from table. (#83)</li> <li>Fixed entityframework rename table name prefix bug. (#84)</li> <li>Fixed sql server scripts bug of create table scheme. (#85)</li> <li>Fixed thread safety issue about KafkaOptions.(#89)</li> </ul>"},{"location":"about/release-notes/#version-213-2018-01-24","title":"Version 2.1.3 (2018-01-24)","text":"<p>Features:</p> <ul> <li>Upgrade dependent nuget packages version.</li> <li>NuGet package include xml doc now.</li> <li>NuGet now contains the CAP symbol files.</li> </ul> <p>Bug Fixed:</p> <ul> <li>Fixed thread conflict issue when sending messages with PublishAsync. (#80)</li> <li>Fixed kafka received message sava failed may caused the mssage loss bug. (#78)</li> <li>Fixed dashboard js syntax issue. (#77)</li> </ul>"},{"location":"about/release-notes/#version-212-2017-12-18","title":"Version 2.1.2 (2017-12-18)","text":"<p>Bug Fixed:</p> <ul> <li>Fixed and improve the performance of mysql processing messages. (#68) (#36)</li> <li>Fixed dashboard manually trigger reconsumption bug. (#67)</li> <li>Fixed mysql 5.5 table initialization bug. (#65)</li> <li>Fixed mysql message queue executor bug. (#66)</li> </ul>"},{"location":"about/release-notes/#version-211-2017-11-28","title":"Version 2.1.1 (2017-11-28)","text":"<p>Bug Fixed:</p> <ul> <li>Fixed 'dotnet.exe' process incomplete quit when shutdown application (Ctrl+C). (#64)</li> <li>Fixed failure to issue as expected of RabbitMQ SubscriberNotFoundException. (#63)</li> <li>Fixed Sent async message in the loop causes an exception. (#62)</li> </ul>"},{"location":"about/release-notes/#version-210-2017-11-17","title":"Version 2.1.0 (2017-11-17)","text":"<p>Features:</p> <ul> <li>Interface display optimization of dashboard.</li> <li>Adds a more friendly display when looks at the message content.</li> <li>Now you can see the exception infomation in the message conent filed when message send or executed failed.</li> <li>Optimize LAN to see Dashboard without authentication.</li> <li>Add IContentSerializer interface, you can customize the serialized message content.</li> <li>Add IMessagePacker interface, you can customize wapper of the message.</li> <li>Upgrade the dependent package.</li> </ul> <p>Bug Fixed:</p> <ul> <li>Fixed dashboard query bugs.</li> <li>Fixed dashboard multilanguage display bugs.</li> <li>Fixed RabbitMQ connection pool bug.</li> <li>Fixed dashboard display bugs on mobile.</li> </ul>"},{"location":"about/release-notes/#version-202-2017-09-29","title":"Version 2.0.2 (2017-09-29)","text":"<p>Bug Fixed:</p> <ul> <li>Fixed asp.net core 2.0 startup error of MySql and PostgreSql. (#44</li> </ul>"},{"location":"about/release-notes/#version-201-2017-09-16","title":"Version 2.0.1 (2017-09-16)","text":"<p>Bug Fixed:</p> <ul> <li>DbContext services bug. (#44)</li> <li>Dependency injection bug. (#45)</li> </ul>"},{"location":"about/release-notes/#version-200-2017-09-01","title":"Version 2.0.0 (2017-09-01)","text":"<p>Features:</p> <ul> <li>Supported .net standard 2.0.</li> <li>Supported PostgreSQL 9.5+.</li> <li>Supported asynchronous function subscriptions.</li> <li><code>ICapPublisher</code> api supported callback subsrciber.</li> </ul> <p>Bug Fixed:</p> <ul> <li>Fixed multiple subscriber subscribe bug. (#38)</li> <li>Fixed model binde bug. (#17) (#18)</li> <li>Fixed database connection disposed bug. (#25)</li> <li>Fixed consumer method injection context bug. (#34)</li> </ul>"},{"location":"about/release-notes/#version-110-2017-08-04","title":"Version 1.1.0 (2017-08-04)","text":"<p>Features:</p> <ul> <li>Support MySQL database persistent message.</li> <li>Add message failed call-back in CapOptions.</li> <li>Remove publish messages API of string name at <code>ICapPublisher</code>.</li> </ul> <p>Bug Fixed:</p> <ul> <li>Fixed can not send message for string type. (#17)</li> <li>Fixed model bind for type like datetime guid always failed. (#18)</li> </ul>"},{"location":"about/release-notes/#version-101-2017-07-25","title":"Version 1.0.1 (2017-07-25)","text":"<p>Features:</p> <ul> <li>ICapPublisher interface added synchronous publish API.</li> <li>Add infinity retry failed processor.</li> </ul>"},{"location":"about/release-notes/#version-100-2017-07-19","title":"Version 1.0.0 (2017-07-19)","text":"<ul> <li>Project published</li> </ul>"},{"location":"user-guide/en/cap/configuration/","title":"Configuration","text":"<p>By default, you can specify configuration when you register CAP services into the IoC container for ASP.NET Core project.</p> <pre><code>services.AddCap(config=&gt; {\n// config.XXX \n});\n</code></pre> <p><code>services</code> is <code>IServiceCollection</code> interface, which can be found in the <code>Microsoft.Extensions.DependencyInjection</code> package.</p> <p>If you don't want to use Microsoft's IoC container, you can take a look at ASP.NET Core documentation here to learn how to replace the default container implementation.</p>"},{"location":"user-guide/en/cap/configuration/#what-is-minimum-configuration-required-for-cap","title":"What is minimum configuration required for CAP","text":"<p>you have to configure at least a transport and a storage. If you want to get started quickly you can use the following configuration:</p> <pre><code>services.AddCap(capOptions =&gt; {\ncapOptions.UseInMemoryQueue();\ncapOptions.UseInmemoryStorage();\n});\n</code></pre> <p>For specific transport and storage configuration, you can take a look at the configuration options provided by the specific components in the Transports section and the Persistent section.</p>"},{"location":"user-guide/en/cap/configuration/#custom-configuration","title":"Custom configuration","text":"<p>The <code>CapOptions</code> is used to store configuration information. By default they have default values, sometimes you may need to customize them.</p>"},{"location":"user-guide/en/cap/configuration/#defaultgroupname","title":"DefaultGroupName","text":"<p>Default: cap.queue.{assembly name}</p> <p>The default consumer group name, corresponds to different names in different Transports, you can customize this value to customize the names in Transports for easy viewing.</p> <p>Mapping</p> <p>Map to Queue Names in RabbitMQ. Map to Consumer Group Id in Apache Kafka. Map to Subscription Name in Azure Service Bus. Map to Queue Group Name in NATS. Map to Consumer Group in Redis Streams.</p>"},{"location":"user-guide/en/cap/configuration/#groupnameprefix","title":"GroupNamePrefix","text":"<p>Default: Null</p> <p>Add unified prefixes for consumer group.  https://github.com/dotnetcore/CAP/pull/780</p>"},{"location":"user-guide/en/cap/configuration/#topicnameprefix","title":"TopicNamePrefix","text":"<p>Default: Null</p> <p>Add unified prefixes for topic/queue name.  https://github.com/dotnetcore/CAP/pull/780</p>"},{"location":"user-guide/en/cap/configuration/#versioning","title":"Versioning","text":"<p>Default: v1</p> <p>This is a new configuration option introduced in the CAP v2.4 version. It is used to specify a version of a message to isolate messages of different versions of the service. It is often used in A/B testing or multi-service version scenarios. Following are application scenarios that needs versioning:</p> <p>Business Iterative and compatible</p> <p>Due to the rapid iteration of services, the data structure of the message is not fixed during each service integration process. Sometimes we add or modify certain data structures to accommodate the newly introduced requirements. If you have a brand new system, there's no problem, but if your system is already deployed to a production environment and serves customers, this will cause new features to be incompatible with the old data structure when they go online, and then these changes can cause serious problems. To work around this issue, you can only clean up message queues and persistent messages before starting the application, which is obviously not acceptable for production environments.</p> <p>Multiple versions of the server</p> <p>Sometimes, the server's server needs to provide multiple sets of interfaces to support different versions of the app. Data structures of the same interface and server interaction of these different versions of the app may be different, so usually server does not provide the same routing addresses to adapt to different versions of App calls.</p> <p>Using the same persistent table/collection in different instance</p> <p>If you want multiple different instance services to use the same database, in versions prior to 2.4, we could isolate database tables for different instances by specifying different table names. After version 2.4 this can be achived through CAP configuration, by configuring different table name prefixes.</p> <p>Check out the blog to learn more about the Versioning feature: https://www.cnblogs.com/savorboard/p/cap-2-4.html</p>"},{"location":"user-guide/en/cap/configuration/#failedretryinterval","title":"FailedRetryInterval","text":"<p>Default: 60 sec</p> <p>During the message sending process if message transport fails, CAP will try to send the message again. This configuration option is used to configure the interval between each retry.</p> <p>During the message sending process if consumption method fails, CAP will try to execute the method again. This configuration option is used to configure the interval between each retry.</p> <p>Retry &amp; Interval</p> <p>By default if failure occurs on send or consume, retry will start after 4 minutes in order to avoid possible problems caused by setting message state delays.   Failures in the process of sending and consuming messages will be retried 3 times immediately, and will be retried polling after 3 times, at which point the FailedRetryInterval configuration will take effect.</p> <p>Multi-instance concurrent retries</p> <p>We introduced database-based distributed locks in version 7.1.0 to solve the problem of retrying concurrent fetches from the database under multiple instances, you need to explicitly configure <code>UseStorageLock</code> to true.</p>"},{"location":"user-guide/en/cap/configuration/#usestoragelock","title":"UseStorageLock","text":"<p>Default: false</p> <p>If set to true, we will use a database-based distributed lock to solve the problem of concurrent fetches data by retry processes with multiple instances. This will generate the cap.lock table in the database.</p>"},{"location":"user-guide/en/cap/configuration/#collectorcleaninginterval","title":"CollectorCleaningInterval","text":"<p>Default: 300 sec</p> <p>The interval of the collector processor deletes expired messages.</p>"},{"location":"user-guide/en/cap/configuration/#consumerthreadcount","title":"ConsumerThreadCount","text":"<p>Default: 1</p> <p>Number of consumer threads, when this value is greater than 1, the order of message execution cannot be guaranteed.</p>"},{"location":"user-guide/en/cap/configuration/#failedretrycount","title":"FailedRetryCount","text":"<p>Default: 50</p> <p>Maximum number of retries. When this value is reached, retry will stop and the maximum number of retries will be modified by setting this parameter.</p>"},{"location":"user-guide/en/cap/configuration/#failedthresholdcallback","title":"FailedThresholdCallback","text":"<p>Default: NULL</p> <p>Type: <code>Action&lt;FailedInfo&gt;</code></p> <p>Failure threshold callback. This action is called when the retry reaches the value set by <code>FailedRetryCount</code>, you can receive notification by specifying this parameter to make a manual intervention. For example, send an email or notification. </p>"},{"location":"user-guide/en/cap/configuration/#succeedmessageexpiredafter","title":"SucceedMessageExpiredAfter","text":"<p>Default: 24*3600 sec (1 days)</p> <p>The expiration time (in seconds) of the success message. When the message is sent or consumed successfully, it will be removed from database storage when the time reaches <code>SucceedMessageExpiredAfter</code> seconds. You can set the expiration time by specifying this value.</p>"},{"location":"user-guide/en/cap/configuration/#failedmessageexpiredafter","title":"FailedMessageExpiredAfter","text":"<p>Default: 15*24*3600 sec(15 days)</p> <p>The expiration time (in seconds) of the failed message. When the message is sent or consumed failed, it will be removed from database storage when the time reaches <code>FailedMessageExpiredAfter</code> seconds. You can set the expiration time by specifying this value.</p>"},{"location":"user-guide/en/cap/configuration/#usedispatchingpergroup","title":"UseDispatchingPerGroup","text":"<p>Default: false</p> <p>If <code>true</code> then all consumers within the same group pushes received messages to own dispatching pipeline channel. Each channel has set thread count to <code>ConsumerThreadCount</code> value.</p> <p>If option set true, the EnableConsumerPrefetch option is disabled</p>"},{"location":"user-guide/en/cap/configuration/#enableconsumerprefetch","title":"EnableConsumerPrefetch","text":"<p>Default: false\uff0c Before version 7.0 the default behavior is true</p> <p>By default, CAP will only read one message from the message queue, then execute the subscription method. After the execution is done, it will read the next message for execution. If set to true, the consumer will prefetch some messages to the memory queue, and then distribute them to the scheduler for execution.</p> <p>Precautions</p> <p>Setting it to true may cause some problems. When the subscription method executes too slowly and takes too long, it will cause the retry thread to pick up messages that have not yet been executed. The retry thread picks up messages from 4 minutes ago by default, that is to say, if the message backlog of more than 4 minutes on the consumer side will be picked up again and executed again</p>"},{"location":"user-guide/en/cap/filter/","title":"Filter","text":"<p>Subscriber filters are similar to ASP.NET MVC filters and are mainly used to process additional work before and after the subscriber method is executed. Such as transaction management or logging, etc.</p>"},{"location":"user-guide/en/cap/filter/#create-subscribe-filter","title":"Create subscribe filter","text":""},{"location":"user-guide/en/cap/filter/#create-filter","title":"Create Filter","text":"<p>Create a new filter class and inherit the <code>SubscribeFilter</code> abstract class.</p> <pre><code>public class MyCapFilter: SubscribeFilter\n{\npublic override Task OnSubscribeExecutingAsync(ExecutingContext context)\n{\n// before subscribe method exectuing\n}\n\npublic override Task OnSubscribeExecutedAsync(ExecutedContext context)\n{\n// after subscribe method executed\n}\n\npublic override Task OnSubscribeExceptionAsync(ExceptionContext context)\n{\n// subscribe method execution exception\n}\n}\n</code></pre> <p>In some scenarios, if you want to terminate the subscriber method execution, you can throw an exception in <code>OnSubscribeExecutingAsync</code>, and choose to ignore the exception in <code>OnSubscribeExceptionAsync</code>.</p> <p>To ignore exceptions, you can setting <code>context.ExceptionHandled = true</code> in <code>ExceptionContext</code></p> <pre><code>public override Task OnSubscribeExceptionAsync(ExceptionContext context)\n{\ncontext.ExceptionHandled = true;\n}\n</code></pre>"},{"location":"user-guide/en/cap/filter/#configuration-filter","title":"Configuration Filter","text":"<p>Use <code>AddSubscribeFilter&lt;&gt;</code> to add a filter.</p> <pre><code>services.AddCap(opt =&gt;\n{\n// ***\n}.AddSubscribeFilter&lt;MyCapFilter&gt;();\n</code></pre> <p>Currently, we do not support adding multiple filters.</p>"},{"location":"user-guide/en/cap/idempotence/","title":"Idempotence","text":"<p>Imdempotence (which you may read a formal definition of on Wikipedia, when we are talking about messaging, is when a message redelivery can be handled without ending up in an unintended state.</p>"},{"location":"user-guide/en/cap/idempotence/#delivery-guarantees1","title":"Delivery guarantees1","text":"<p>Before we talk about idempotency, let's talk about the delivery of messages on the consumer side.</p> <p>Since CAP doesn't uses MS DTC or other type of 2PC distributed transaction mechanism, there is a problem that the message is strictly delivered at least once. Specifically, in a message-based system, there are three possibilities:</p> <ul> <li>Exactly Once(*)  </li> <li>At Most Once </li> <li>At Least Once  </li> </ul> <p>Exactly once has a (*) next to it, because in the general case, it is simply not possible.</p>"},{"location":"user-guide/en/cap/idempotence/#at-most-once","title":"At Most Once","text":"<p>The At Most Once delivery guarantee covers the case when you are guaranteed to receive all messages either once, or maybe not at all.</p> <p>This type of delivery guarantee can arise from your messaging system and your code performing its actions in the following order:</p> <pre><code>1. Remove message from queue\n2. Start work transaction\n3. Handle message (your code)\n4. Success?\n    Yes:\n        1. Commit work transaction\n    No: \n        1. Roll back work transaction\n        2. Put message back into the queue\n</code></pre> <p>In the best case scenario, this is all well and good \u2013 your messages will be received, and work transactions will be committed, and you will be happy.</p> <p>However, the sun does not always shine, and stuff tends to fail \u2013 especially if you do alot of stuff. Consider e.g. what would happen if anything fails after having performed step (1), and then \u2013 when you try to execute step (4)/(2) (i.e. put the message back into the queue) \u2013 the network was temporarily unavailable, or the message broker restarted, or the host machine decided to reboot because it had installed an update.</p> <p>This can be OK if it's what you want, but most things in CAP revolve around the concept of DURABLE messages, i.e. messages whose contents is just as important as the data in your database.</p>"},{"location":"user-guide/en/cap/idempotence/#at-least-once","title":"At Least Once","text":"<p>This delivery guarantee covers the case when you are guaranteed to receive all messages either once, or maybe more times if something has failed.</p> <p>It requires a slight change to the order we are executing our steps in, and it requires that the message queue system supports transactions, either in the form of the traditional begin-commit-rollback protocol (MSMQ does this), or in the form of a receive-ack-nack protocol (RabbitMQ, Azure Service Bus, etc. do this).</p> <p>Check this out \u2013 if we do this:</p> <pre><code>1. Grab lease on message in queue\n2. Start work transaction\n3. Handle message (your code)\n4. Success?\n    Yes: \n        1. Commit work transaction\n        2. Delete message from queue\n    No: \n        1. Roll back work transaction\n        2. Release lease on message\n</code></pre> <p>and the \"lease\" we grabbed on the message in step (1) is associated with an appropriate timeout, then we are guaranteed that no matter how wrong things go, we will only actually remove the message from the queue (i.e. execute step (4)/(2)) if we have successfully committed our \"work transaction\".</p>"},{"location":"user-guide/en/cap/idempotence/#what-is-a-work-transaction","title":"What is a \"work transaction\"?","text":"<p>It depends on what you're doing \ud83d\ude04 maybe it's a transaction in a relational database (which traditionally have pretty good support in this regard), maybe it's a transaction in a document database that happens to support transaction (like RavenDB or Postgres), or maybe it's a conceptual transaction in the form of whichever work you happen to carry out as a consequence of handling a message, e.g. update a bunch of documents in MongoDB, move some files around in the file system, or mutate some obscure in-mem data structure.</p> <p>The fact that the \"work transaction\" is just a conceptual thing is what makes it impossible to support the aforementioned Exactly Once delivery guarantee \u2013 it's just not generally possible to commit or roll back a \"work transaction\" and a \"queue transaction\" (which is what we could call the protocol carried out with the message queue systems) atomically and consistently.</p>"},{"location":"user-guide/en/cap/idempotence/#idempotence-at-cap","title":"Idempotence at CAP","text":"<p>In CAP, At Least Once  delivery guarantee is used.</p> <p>Since we have a temporary storage medium (database table), we may be able to do At Most Once, but in order to strictly guarantee that the message will not be lost, we do not provide related functions or configurations.</p>"},{"location":"user-guide/en/cap/idempotence/#why-are-we-not-providingachieving-idempotency","title":"Why are we not providing(achieving) idempotency ?","text":"<ol> <li> <p>The message was successfully written, but the execution of the Consumer method failed.  </p> <p>There are a lot of reasons why the Consumer method fails. I don't know if the specific scene is blindly retrying or not retrying is an incorrect choice. For example, if the consumer is debiting service, if the execution of the debit is successful, but fails to write the debit log, the CAP will judge that the consumer failed to execute and try again. If the client does not guarantee idempotency, the framework will retry it, which will inevitably lead to serious consequences for multiple debits.</p> </li> <li> <p>The execution of the Consumer method succeeded, but received the same message.  </p> <p>This scenario is also possible. If the Consumer has been successfully executed at the beginning, but for some reason, such as the Broker recovery, same message has been received, CAP will consider this as a new message after receiving the Broker message. Message will be executed again by the Consumer. Because it is a new message, CAP cannot be idempotent at this time.</p> </li> <li> <p>The current data storage mode can not be idempotent.  </p> <p>Since the table of the CAP message is deleted after 1 hour for the successfully consumed message, if the historical message cannot be idempotent. Historically, if the broker has maintained or manually processed some messages for some reason.</p> </li> <li> <p>Industry practices.</p> <p>Many event-driven frameworks require users to ensure idempotent operations, such as ENode, RocketMQ, etc...</p> </li> </ol> <p>From an implementation point of view, CAP can do some less stringent idempotence, but strict idempotent can not be guaranteed.</p>"},{"location":"user-guide/en/cap/idempotence/#naturally-idempotent-message-processing","title":"Naturally idempotent message processing","text":"<p>Generally, the best way to deal with message redeliveries is to make the processing of each message naturally idempotent.</p> <p>Natural idempotence arises when the processing of a message consists of calling an idempotent method on a domain object, like</p> <pre><code>obj.MarkAsDeleted();\n</code></pre> <p>or</p> <pre><code>obj.UpdatePeriod(message.NewPeriod);\n</code></pre> <p>You can use the <code>INSERT ON DUPLICATE KEY UPDATE</code> provided by the database to easily done.</p>"},{"location":"user-guide/en/cap/idempotence/#explicitly-handling-redeliveries","title":"Explicitly handling redeliveries","text":"<p>Another way of making message processing idempotent, is to simply track IDs of processed messages explicitly, and then make your code handle a redelivery.</p> <p>Assuming that you are keeping track of message IDs by using an <code>IMessageTracker</code> that uses the same transactional data store as the rest of your work, your code might look somewhat like this:</p> <pre><code>readonly IMessageTracker _messageTracker;\n\npublic SomeMessageHandler(IMessageTracker messageTracker)\n{\n_messageTracker = messageTracker;\n}\n\n[CapSubscribe]\npublic async Task Handle(SomeMessage message) {\nif (await _messageTracker.HasProcessed(message.Id))\n{\nreturn;\n}\n\n// do the work here\n// ...\n\n// remember that this message has been processed\nawait _messageTracker.MarkAsProcessed(messageId);\n}\n</code></pre> <p>As for the implementation of <code>IMessageTracker</code>, you can use a storage message Id such as Redis or a database and the corresponding processing state.</p> <ol> <li> <p>The chapter refers to the Delivery guarantees of rebus, which I think is described very good.\u00a0\u21a9</p> </li> </ol>"},{"location":"user-guide/en/cap/messaging/","title":"Message","text":"<p>The data sent by using the <code>ICapPublisher</code> interface is called <code>Message</code>.</p>"},{"location":"user-guide/en/cap/messaging/#compensating-transaction","title":"Compensating transaction","text":"<p>Wiki : Compensating transaction</p> <p>In some cases, consumers need to return the execution value to tell the publisher, so that the publisher can implement some compensation actions, usually we called message compensation.</p> <p>Usually you can notify the upstream by republishing a new message in the consumer code. CAP provides a simple way to do this. You can specify <code>callbackName</code> parameter when publishing message, usually this only applies to point-to-point consumption. The following is an example.</p> <p>For example, in an e-commerce application, the initial status of the order is pending, and the status is marked as succeeded when the product quantity is successfully deducted, otherwise it is failed.</p> <pre><code>// =============  Publisher =================\n\n_capBus.Publish(\"place.order.qty.deducted\", contentObj: new { OrderId = 1234, ProductId = 23255, Qty = 1 }, callbackName: \"place.order.mark.status\");    // publisher using `callbackName` to subscribe consumer result\n\n[CapSubscribe(\"place.order.mark.status\")]\npublic void MarkOrderStatus(JsonElement param)\n{\nvar orderId = param.GetProperty(\"OrderId\").GetInt32();\nvar isSuccess = param.GetProperty(\"IsSuccess\").GetBoolean();\n\nif(isSuccess){\n// mark order status to succeeded\n}\nelse{\n// mark order status to failed\n}\n}\n\n// =============  Consumer ===================\n\n[CapSubscribe(\"place.order.qty.deducted\")]\npublic object DeductProductQty(JsonElement param)\n{\nvar orderId = param.GetProperty(\"OrderId\").GetInt32();\nvar productId = param.GetProperty(\"ProductId\").GetInt32();\nvar qty = param.GetProperty(\"Qty\").GetInt32();\n\n//business logic \n\nreturn new { OrderId = orderId, IsSuccess = true };\n}\n</code></pre>"},{"location":"user-guide/en/cap/messaging/#heterogeneous-system-integration","title":"Heterogeneous system integration","text":"<p>In version 3.0+, we reconstructed the message structure. We used the Header in the message protocol in the message queue to transmit some additional information, so that we can do it in the Body without modifying or packaging the user\u2019s original The message data format and content are sent.</p> <p>This approach is reasonable. It helps to better integrate in heterogeneous systems. Compared with previous versions, users do not need to know the message structure used inside CAP to complete the integration work.</p> <p>Now we divide the message into Header and Body for transmission.</p> <p>The data in the body is the content of the original message sent by the user, that is, the content sent by calling the Publish method. We do not perform any packaging, but send it to the message queue after serialization.</p> <p>In the Header, we need to pass some additional information so that the CAP can extract the key features for operation when the message is received.</p> <p>The following is the content that needs to be written into the header of the message when sending a message in a heterogeneous system:</p> Key DataType Description cap-msg-id string Message Id, Generated by snowflake algorithm, can also be guid cap-msg-name string The name of the message cap-msg-type string The type of message, <code>typeof(T).FullName</code>(not required) cap-senttime string sending time (not required)"},{"location":"user-guide/en/cap/messaging/#custom-headers","title":"Custom headers","text":"<p>To consume messages sent without CAP headers, both AzureServiceBus, Kafka and RabbitMQ consumers can inject a minimal set of headers using the <code>CustomHeaders</code> property as shown below (RabbitMQ example): <pre><code>container.AddCap(x =&gt;\n{\nx.UseRabbitMQ(z =&gt;\n{\nz.ExchangeName = \"TestExchange\";\nz.CustomHeaders = e =&gt; new List&lt;KeyValuePair&lt;string, string&gt;&gt;\n{\nnew KeyValuePair&lt;string, string&gt;(DotNetCore.CAP.Messages.Headers.MessageId, SnowflakeId.Default().NextId().ToString()),\nnew KeyValuePair&lt;string, string&gt;(DotNetCore.CAP.Messages.Headers.MessageName, e.RoutingKey)\n};\n});\n});\n</code></pre></p> <p>After adding <code>cap-msg-id</code> and <code>cap-msg-name</code>, CAP consumers receive messages sent directly from any external system, like the RabbitMQ management tool when using RabbitMQ as a transport.</p>"},{"location":"user-guide/en/cap/messaging/#scheduling","title":"Scheduling","text":"<p>After CAP receives a message, it sends the message to Transport(RabitMq, Kafka...), which is transported by transport.</p> <p>When you send message using the <code>ICapPublisher</code> interface, CAP will dispatch message to the corresponding Transport. Currently, bulk messaging is not supported.</p> <p>For more information on transports, see Transports section.</p>"},{"location":"user-guide/en/cap/messaging/#storage","title":"Storage","text":"<p>CAP will store the message after receiving it. For more information on storage, see the Storage section.</p>"},{"location":"user-guide/en/cap/messaging/#retry","title":"Retry","text":"<p>Retrying plays an important role in the overall CAP architecture design, CAP retry messages that fail to send or fail to execute. There are several retry strategies used throughout the CAP design process.</p>"},{"location":"user-guide/en/cap/messaging/#send-retry","title":"Send retry","text":"<p>During the message sending process, when the broker crashes or the connection fails or an abnormality occurs, CAP will retry the sending. Retry 3 times for the first time, retry every minute after 4 minutes, and +1 retry. When the total number of retries reaches 50, CAP will stop retrying.</p> <p>You can adjust the total number of retries by setting FailedRetryCount in CapOptions.</p> <p>It will stop when the maximum number of times is reached. You can see the reason for the failure in Dashboard and choose whether to manually retry.</p>"},{"location":"user-guide/en/cap/messaging/#consumption-retry","title":"Consumption retry","text":"<p>The consumer method is executed when the Consumer receives the message and will retry when an exception occurs. This retry strategy is the same as the send retry.</p> <p>We introduced database-based distributed locks in version 7.1.0 to deal with the problem of concurrent data acquisition of database retries under multiple instances, you need to explicitly configure <code>UseStorageLock</code> option to true.</p>"},{"location":"user-guide/en/cap/messaging/#data-cleanup","title":"Data Cleanup","text":"<p>There is an <code>ExpiresAt</code> field in the database message table indicating the expiration time of the message. When the message is sent successfully, status will be changed to <code>Successed</code>, and <code>ExpiresAt</code> will be set to 1 day later. </p> <p>Consuming failure will change the message status to <code>Failed</code> and <code>ExpiresAt</code> will be set to 15 days later (You can use FailedMessageExpiredAfter configuration items to custom).</p> <p>By default, the data of the message in the table is deleted every 5 minutes to avoid performance degradation caused by too much data. The cleanup strategy <code>ExpiresAt</code> is performed when field is not empty and is less than the current time. </p> <p>That is to say, the message with the status Failed (by default they have been retried 50 times), if you do not have manual intervention for 15 days, it will also be cleaned up.</p> <p>You can use CollectorCleaningInterval configuration items to custom the interval time.</p>"},{"location":"user-guide/en/cap/serialization/","title":"Serialization","text":"<p>We provide the <code>ISerializer</code> interface to support serialization of messages. By default, json is used to serialize messages and store them in the database.</p>"},{"location":"user-guide/en/cap/serialization/#custom-serialization","title":"Custom Serialization","text":"<pre><code>public class YourSerializer: ISerializer\n{\nTask&lt;TransportMessage&gt; SerializeAsync(Message message)\n{\n\n}\n\nTask&lt;Message&gt; DeserializeAsync(TransportMessage transportMessage, Type valueType)\n{\n\n}\n}\n</code></pre> <p>Then register your implemented serializer in the container:</p> <pre><code>services.AddSingleton&lt;ISerializer, YourSerializer&gt;();\n\n// ---\nservices.AddCap \n</code></pre>"},{"location":"user-guide/en/cap/serialization/#message-adapter-removed-in-v30","title":"Message Adapter (removed in v3.0)","text":"<p>In heterogeneous systems, sometimes you need to communicate with other systems, but other systems use message objects that may be different from CAP's Wrapper Object. This time maybe you need to customize the message wapper.</p> <p>CAP provides the <code>IMessagePacker</code> interface for customizing the Wrapper Object. Custom MessagePacker usually packs and unpacks the <code>CapMessage</code> In this process you can add your own business objects.</p> <p>Usage :</p> <pre><code>class MyMessagePacker : IMessagePacker\n{\nprivate readonly IContentSerializer _serializer;\n\npublic DefaultMessagePacker(IContentSerializer serializer)\n{\n_serializer = serializer;\n}\n\npublic string Pack(CapMessage obj)\n{\nvar myStructure = new\n{\nId = obj.Id,\nBody = obj.Content,\nDate = obj.Timestamp,\nCallback = obj.CallbackName\n};\nreturn _serializer.Serialize(myStructure);\n}\n\npublic CapMessage UnPack(string packingMessage)\n{\nvar myStructure = _serializer.DeSerialize&lt;MyStructure&gt;(packingMessage);\n\nreturn new CapMessageDto\n{\nId = myStructure.Id,\nTimestamp = myStructure.Date,\nContent = myStructure.Body,\nCallbackName = myStructure.Callback\n};\n}\n}\n</code></pre> <p>Next, add the custom <code>MyMessagePacker</code> to the service.</p> <pre><code>services.AddCap(x =&gt;{  }).AddMessagePacker&lt;MyMessagePacker&gt;();\n</code></pre>"},{"location":"user-guide/en/cap/transactions/","title":"Transaction","text":""},{"location":"user-guide/en/cap/transactions/#distributed-transactions","title":"Distributed transactions?","text":"<p>CAP does not directly provide out-of-the-box MS DTC or 2PC-based distributed transactions, instead we provide a solution that can be used to solve problems encountered in distributed transactions.</p> <p>In a distributed environment, using 2PC or DTC-based distributed transactions can be very expensive due to the overhead involved in communication which affects performance. In addition, since distributed transactions based on 2PC or DTC are also subject to the CAP theorem, it will have to give up availability (A in CAP) when network partitioning occurs.</p> <p>A distributed transaction is a very complex process with a lot of moving parts that can fail. Also, if these parts run on different machines or even in different data centers, the process of committing a transaction could become very long and unreliable.</p> <p>This could seriously affect the user experience and overall system bandwidth. So one of the best ways to solve the problem of distributed transactions is to avoid them completely.1</p> <p>For the processing of distributed transactions, CAP uses the \"Eventual Consistency and Compensation\" scheme.</p>"},{"location":"user-guide/en/cap/transactions/#eventual-consistency-and-compensation-1","title":"Eventual Consistency and Compensation 1","text":"<p>By far, one of the most feasible models of handling consistency across microservices is eventual consistency.</p> <p>This model doesn\u2019t enforce distributed ACID transactions across microservices. Instead, it proposes to use some mechanisms of ensuring that the system would be eventually consistent at some point in the future.</p>"},{"location":"user-guide/en/cap/transactions/#a-case-for-eventual-consistency","title":"A Case for Eventual Consistency","text":"<p>For example, suppose we need to solve the following task:</p> <ul> <li>register a user profile  </li> <li>do some automated background check that the user can actually access the system</li> </ul> <p>Second task is to ensure, for example, that this user wasn\u2019t banned from our servers for some reason.</p> <p>But it could take time, and we\u2019d like to extract it to a separate microservice. It wouldn\u2019t be reasonable to keep the user waiting for so long just to know that he was registered successfully.</p> <p>One way to solve it would be with a message-driven approach including compensation. Let\u2019s consider the following architecture:</p> <ul> <li>the user microservice tasked with registering a user profile  </li> <li>the validation microservice tasked with doing a background check  </li> <li>the messaging platform that supports persistent queues  </li> </ul> <p>The messaging platform could ensure that the messages sent by the microservices are persisted. Then they would be delivered at a later time if the receiver wasn't currently available</p>"},{"location":"user-guide/en/cap/transactions/#best-case-scenario","title":"Best case scenario","text":"<p>In this architecture, best case scenario would be:</p> <ul> <li>the user microservice registers a user, saving information about him in its local database</li> <li>the user microservice marks this user with a flag. It could signify that this user hasn\u2019t yet been validated and doesn\u2019t have access to full system functionality</li> <li>a confirmation of registration is sent to the user with a warning that not all functionality of the system is accessible right away</li> <li>the user microservice sends a message to the validation microservice to do the background check of a user</li> <li>the validation microservice runs the background check and sends a message to the user microservice with the results of the check</li> <li>if the results are positive, the user microservice unblocks the user</li> <li>if the results are negative, the user microservice deletes the user account</li> </ul> <p>After we\u2019ve gone through all these steps, the system should be in a consistent state. However, for some period of time, user entity appeared to be in an incomplete state.</p> <p>The last step, when the user microservice removes the invalid account, is a compensation phase.</p>"},{"location":"user-guide/en/cap/transactions/#failure-scenarios","title":"Failure Scenarios","text":"<p>Now let\u2019s consider some failure scenarios:</p> <ul> <li>if the validation microservice is not accessible, then the messaging platform with its persistent queue functionality ensures that the validation microservice would receive this message at some later time</li> <li>suppose the messaging platform fails, then the user microservice tries to send the message again at some later time, for example, by scheduled batch-processing of all users that were not yet validated</li> <li>if the validation microservice receives the message, validates the user but can\u2019t send the answer back due to the messaging platform failure, the validation microservice also retries sending the message at some later time</li> <li>if one of the messages got lost, or some other failure happened, the user microservice finds all non-validated users by scheduled batch-processing and sends requests for validation again</li> </ul> <p>Even if some of the messages were issued multiple times, this wouldn\u2019t affect the consistency of the data in the microservices\u2019 databases.</p> <p>By carefully considering all possible failure scenarios, we can ensure that our system would satisfy the conditions of eventual consistency. At the same time, we wouldn\u2019t need to deal with the costly distributed transactions.</p> <p>But we have to be aware that ensuring eventual consistency is a complex task. It doesn\u2019t have a single solution for all cases.</p> <ol> <li> <p>This chapter is quoted from: https://www.baeldung.com/transactions-across-microservices \u21a9\u21a9</p> </li> </ol>"},{"location":"user-guide/en/getting-started/contributing/","title":"Contribution","text":"<p>One of the easiest ways to contribute is to participate in discussions and discuss issues. </p> <p>If you have any question or problems, please report them on the CAP repository:</p> <p> Report Issue  Active Issues </p>"},{"location":"user-guide/en/getting-started/contributing/#submitting-changes","title":"Submitting Changes","text":"<p>You can also contribute by submitting pull requests with code changes.</p> <p>Pull requests let you tell others about changes you've pushed to a repository on GitHub. Once a pull request is opened, you can discuss and review the potential changes with collaborators and add follow-up commits before the changes are merged into the repository.</p>"},{"location":"user-guide/en/getting-started/contributing/#additional-resources","title":"Additional Resources","text":"<ul> <li> <p>Filtering issues and pull requests</p> </li> <li> <p>Using search to filter issues and pull requests</p> </li> </ul>"},{"location":"user-guide/en/getting-started/introduction/","title":"Introduction","text":"<p>CAP is an EventBus and a solution for solving distributed transaction problems in microservices or SOA systems. It helps create a microservices system that is scalable, reliable, and easy to change.</p> <p>In Microsoft's eShopOnContainer microservices sample project, it is recommended to use CAP as the EventBus in the production environment.</p> <p>What is EventBus\uff1f</p> <p>An Eventbus is a mechanism that allows different components to communicate with each other without knowing about each other. A component can send an Event to the Eventbus without knowing who will pick it up or how many others will pick it up. Components can also listen to Events on an Eventbus, without knowing who sent the Events. That way, components can communicate without depending on each other. Also, it is very easy to substitute a component. As long as the new component understands events that are being sent and received, other components will never know about the substitution.</p> <p>Compared to other Services Bus or Event Bus, CAP has its own characteristics. It does not require users to implement or inherit any interface when sending messages or processing messages. It has very high flexibility. We have always believed that the appointment is greater than the configuration, so the CAP is very simple to use, very friendly to the novice, and lightweight.</p> <p>CAP is modular in design and highly scalable. You have many options to choose from, including message queues, storage, serialization, etc. Many elements of the system can be replaced with custom implementations.</p>"},{"location":"user-guide/en/getting-started/introduction/#related-videos","title":"Related videos","text":"<p>Video: bilibili Tutorial</p> <p>Video: Youtube Tutorial</p> <p>Video: Youtube Tutorial - @CodeOpinion </p> <p>Video: Tencent Tutorial</p>"},{"location":"user-guide/en/getting-started/introduction/#related-articles","title":"Related articles","text":"<p>Article: Introduction and how to use</p> <p>Article: New features in version 7.0</p> <p>Article: New features in version 6.0</p> <p>Article: New features in version 5.0</p> <p>Article: New features in version 3.0</p> <p>Article: New features in version 2.6</p> <p>Article: New features in version 2.5</p> <p>Article: New features in version 2.4</p> <p>Article: New features in version 2.3</p> <p>Article: .NET Core Community The first thousand-star project was born: CAP</p>"},{"location":"user-guide/en/getting-started/quick-start/","title":"Quick Start","text":"<p>Learn how to build a microservices event bus architecture using CAP, which offers advantages over direct integration of message queues, and what out-of-the-box features it provides.</p>"},{"location":"user-guide/en/getting-started/quick-start/#installation","title":"Installation","text":"<pre><code>PM&gt; Install-Package DotNetCore.CAP\n</code></pre>"},{"location":"user-guide/en/getting-started/quick-start/#integrated-in-aspnet-core","title":"Integrated in Asp.Net Core","text":"<p>For quick start, we use memory-based event storage and message transport.</p> <pre><code>PM&gt; Install-Package DotNetCore.CAP.InMemoryStorage\nPM&gt; Install-Package Savorboard.CAP.InMemoryMessageQueue\n</code></pre> <p>In <code>Startup.cs</code> \uff0cadd the following configuration:</p> <pre><code>public void ConfigureServices(IServiceCollection services)\n{\nservices.AddCap(x =&gt;\n{\nx.UseInMemoryStorage();\nx.UseInMemoryMessageQueue();\n});\n}\n</code></pre>"},{"location":"user-guide/en/getting-started/quick-start/#publish-message","title":"Publish Message","text":"<pre><code>public class PublishController : Controller\n{\n[Route(\"~/send\")]\npublic IActionResult SendMessage([FromServices]ICapPublisher capBus)\n{\ncapBus.Publish(\"test.show.time\", DateTime.Now);\n\nreturn Ok();\n}\n}\n</code></pre>"},{"location":"user-guide/en/getting-started/quick-start/#publish-delay-message","title":"Publish delay message","text":"<pre><code>public class PublishController : Controller\n{\n[Route(\"~/send/delay\")]\npublic IActionResult SendDelayMessage([FromServices]ICapPublisher capBus)\n{\ncapBus.PublishDelay(TimeSpan.FromSeconds(100),\"test.show.time\", DateTime.Now);\n\nreturn Ok();\n}\n}\n</code></pre>"},{"location":"user-guide/en/getting-started/quick-start/#publish-with-extra-header","title":"Publish with extra header","text":"<pre><code>var header = new Dictionary&lt;string, string&gt;()\n{\n[\"my.header.first\"] = \"first\",\n[\"my.header.second\"] = \"second\"\n};\n\ncapBus.Publish(\"test.show.time\", DateTime.Now, header);\n</code></pre>"},{"location":"user-guide/en/getting-started/quick-start/#process-message","title":"Process Message","text":"<pre><code>public class ConsumerController : Controller\n{\n[NonAction]\n[CapSubscribe(\"test.show.time\")]\npublic void ReceiveMessage(DateTime time)\n{\nConsole.WriteLine(\"message time is:\" + time);\n}\n}\n</code></pre>"},{"location":"user-guide/en/getting-started/quick-start/#process-with-extra-header","title":"Process with extra header","text":"<pre><code>[CapSubscribe(\"test.show.time\")]\npublic void ReceiveMessage(DateTime time, [FromCap]CapHeader header)\n{\nConsole.WriteLine(\"message time is:\" + time);\nConsole.WriteLine(\"message firset header :\" + header[\"my.header.first\"]);\nConsole.WriteLine(\"message second header :\" + header[\"my.header.second\"]);\n}\n</code></pre>"},{"location":"user-guide/en/getting-started/quick-start/#summary","title":"Summary","text":"<p>One of the most powerful advantages of asynchronous messaging over direct integrated message queues is reliability, where failures in one part of the system do not propagate or cause the entire system to crash. Messages are stored inside the CAP to ensure the reliability of the message, and strategies such as retry are used to achieve the final consistency of data between services.</p>"},{"location":"user-guide/en/monitoring/consul/","title":"Consul","text":"<p>Consul is a distributed service mesh to connect, secure, and configure services across any runtime platform and public or private cloud.</p>"},{"location":"user-guide/en/monitoring/consul/#consul-configuration-for-dashboard","title":"Consul Configuration for dashboard","text":"<p>CAP's Dashboard uses Consul as a service discovery to get the data of other nodes, and you can switch to the Servers page to see other nodes.</p> <p></p> <p>Click the <code>Switch</code> button to switch to the target node, CAP will use a proxy to get the data of the node you switched to.</p> <p>The following is a configuration example, you need to configure them on each node.</p> <pre><code>services.AddCap(x =&gt;\n{\nx.UseMySql(Configuration.GetValue&lt;string&gt;(\"ConnectionString\"));\nx.UseRabbitMQ(\"localhost\");\nx.UseDashboard();\nx.UseDiscovery(_ =&gt;\n{\n_.DiscoveryServerHostName = \"localhost\";\n_.DiscoveryServerPort = 8500;\n_.CurrentNodeHostName = Configuration.GetValue&lt;string&gt;(\"ASPNETCORE_HOSTNAME\");\n_.CurrentNodePort = Configuration.GetValue&lt;int&gt;(\"ASPNETCORE_PORT\");\n_.NodeId = Configuration.GetValue&lt;string&gt;(\"NodeId\");\n_.NodeName = Configuration.GetValue&lt;string&gt;(\"NodeName\");\n});\n});\n</code></pre> <p>Consul 1.6.2:</p> <pre><code>consul agent -dev\n</code></pre> <p>Windows 10, ASP.NET Core 3.1:</p> <pre><code>set ASPNETCORE_HOSTNAME=localhost&amp;&amp; set ASPNETCORE_PORT=5001&amp;&amp; dotnet run --urls=http://localhost:5001 NodeId=1 NodeName=CAP-1 ConnectionString=\"Server=localhost;Database=aaa;UserId=xxx;Password=xxx;\"\nset ASPNETCORE_HOSTNAME=localhost&amp;&amp; set ASPNETCORE_PORT=5002&amp;&amp; dotnet run --urls=http://localhost:5002 NodeId=2 NodeName=CAP-2 ConnectionString=\"Server=localhost;Database=bbb;UserId=xxx;Password=xxx;\"\n</code></pre>"},{"location":"user-guide/en/monitoring/dashboard/","title":"Dashboard","text":"<p>CAP provides a Dashboard for viewing messages, and features provided by Dashboard make it easy to view and manage messages.</p> <p>Usage Limit</p> <p>The Dashboard is only supported for use in ASP.NET Core, Not supported for console application</p>"},{"location":"user-guide/en/monitoring/dashboard/#enable-dashboard","title":"Enable Dashboard","text":"<p>By default, Dashboard middleware will not be launched. To enable Dashboard functionality you need to add the following code to your configuration:</p> <pre><code>services.AddCap(x =&gt;\n{\n//...\n\n// Register Dashboard\nx.UseDashboard();\n});\n</code></pre> <p>By default, you can open the Dashboard by visiting the url <code>http://localhost:xxx/cap</code>.</p>"},{"location":"user-guide/en/monitoring/dashboard/#dashboard-configuration","title":"Dashboard Configuration","text":"<ul> <li>PathMatch</li> </ul> <p>Default \uff1a'/cap'</p> <p>You can change the path of the Dashboard by modifying this configuration option.</p> <ul> <li>StatsPollingInterval</li> </ul> <p>Default: 2000ms</p> <p>This configuration option is used to configure the Dashboard front end to get the polling time of the status interface (/stats).</p> <ul> <li>UseAuth </li> </ul> <p>Default\uff1afalse</p> <p>Enable authentication on dashboard request.</p> <ul> <li>DefaultAuthenticationScheme </li> </ul> <p>Default scheme used for authentication. If no scheme is set, the DefaultScheme set up in AddAuthentication will be used.</p> <ul> <li>UseChallengeOnAuth</li> </ul> <p>Default\uff1afalse</p> <p>Enable authentication challenge on dashboard request.</p> <ul> <li>DefaultChallengeScheme </li> </ul> <p>Default scheme used for authentication challenge. If no scheme is set, the DefaultChallengeScheme set up in AddAuthentication will be used.</p>"},{"location":"user-guide/en/monitoring/dashboard/#custom-authentication","title":"Custom authentication","text":"<p>From version 5.1.0, Dashboard authorization uses ASP.NET Core style by default and no longer provides custom authorization filters.</p> <p>During Dashabord authentication, the value will be taken from <code>HttpContext.User?.Identity?.IsAuthenticated</code>. If it is not available, the authentication will fail and the <code>DefaultChallengeScheme</code> will be called (if configured).</p> <p>You can view the usage details in the sample project <code>Sample.Dashboard.Auth</code>.</p> <pre><code>services\n.AddAuthorization()\n.AddAuthentication(options =&gt;\n{\noptions.DefaultScheme =  CookieAuthenticationDefaults.AuthenticationScheme;\noptions.DefaultChallengeScheme = OpenIdConnectDefaults.AuthenticationScheme;\n})\n.AddCookie()\n.AddOpenIdConnect(options =&gt;\n{\noptions.Authority = \"https://demo.duendesoftware.com/\";\noptions.ClientId = \"interactive.confidential\";\noptions.ClientSecret = \"secret\";\noptions.ResponseType = \"code\";\noptions.UsePkce = true;\n\noptions.Scope.Clear();\noptions.Scope.Add(\"openid\");\noptions.Scope.Add(\"profile\");\n})\n</code></pre> <p>configuration:</p> <pre><code>services.AddCap(cap =&gt;\n{\ncap.UseDashboard(d =&gt;\n{\nd.UseChallengeOnAuth = true;\nd.DefaultChallengeScheme = OpenIdConnectDefaults.AuthenticationScheme;\n});\n}\n</code></pre>"},{"location":"user-guide/en/monitoring/diagnostics/","title":"Diagnostics","text":"<p>Diagnostics provides a set of features that make it easy for us to document critical operations that occurs during the application's operation, their execution time, etc., allowing administrators to find the root cause of problems, especially in production environments.</p>"},{"location":"user-guide/en/monitoring/diagnostics/#tracing","title":"Tracing","text":"<p>The CAP provides support for <code>DiagnosticSource</code> with a listener name of <code>CapDiagnosticListener</code>.</p> <p>Diagnostics provides tracing event information as follows:</p> <ul> <li>Before the message is persisted</li> <li>After the message is persisted</li> <li>Message persistence exception</li> <li>Before the message is sent to MQ</li> <li>After the message is sent to MQ</li> <li>The message sends an exception to MQ.</li> <li>Messages saved from MQ consumption before saving</li> <li>After the message is saved from MQ consumption</li> <li>Before the subscriber method is executed</li> <li>After the subscriber method is executed</li> <li>Subscriber method execution exception</li> </ul> <p>Related objects, you can find at the <code>DotNetCore.CAP.Diagnostics</code> namespace.</p>"},{"location":"user-guide/en/monitoring/diagnostics/#tracing-with-apache-skywalking","title":"Tracing with Apache Skywalking","text":"<p>Skywalking's C# client provides support for CAP Diagnostics. You can use SkyAPM-dotnet to tracking.</p> <p>Try to read the README to integrate it in your project.</p> <p>Example tracking image :</p> <p></p> <p></p>"},{"location":"user-guide/en/monitoring/diagnostics/#others-apm-support","title":"Others APM support","text":"<p>There is currently no support for APMs other than Skywalking, and if you would like to support CAP diagnostic events in other APM, you can refer to the code here to implement it:</p> <p>At present, apart from Skywalking, we have not provided support for other APMs. If you need it, you can refer the code here to implementation, and we also welcome the Pull Request.</p> <p>https://github.com/SkyAPM/SkyAPM-dotnet/tree/master/src/SkyApm.Diagnostics.CAP</p>"},{"location":"user-guide/en/monitoring/diagnostics/#metrics","title":"Metrics","text":"<p>Metrics are numerical measurements reported over time, most often used to monitor the health of an application and generate alerts. For example, a web service might track how many requests it receives each second, how many milliseconds it took to respond, and how many of the responses sent an error back to the user.</p> <p>CAP 7.0 is support for <code>EventSource</code>, and the counters name is <code>DotNetCore.CAP.EventCounter</code>.</p> <p>CAP provides the following metrics:</p> <ul> <li>Publish rate pre seconds</li> <li>Consume rate pre seconds</li> <li>Invoke Subscriber rate pre seconds</li> <li>Subscriber elpased time mean pre seconds </li> </ul>"},{"location":"user-guide/en/monitoring/diagnostics/#monitor-with-dotnet-counters","title":"Monitor with dotnet-counters","text":"<p>dotnet-counters is a performance monitoring tool for ad-hoc health monitoring and first-level performance investigation. It can observe performance counter values that are published via the EventCounter API or the Meter API. </p> <p>Use the following commands to monitor metrics in CAP:</p> <pre><code>dotnet-counters ps\ndotnet-counters monitor --process-id=25496 --counters=DotNetCore.CAP.EventCounter\n</code></pre> <p>process-id\uff1a The ID of the CAP process to collect counter data from.</p> <p></p>"},{"location":"user-guide/en/monitoring/diagnostics/#monitor-with-dashboard","title":"Monitor with dashboard","text":"<p>You can configure <code>x.UseDashboard()</code> to open the dashboard to view Metrics graph charts.</p> <p></p> <p>In the Realtime Metric Graph, the time axis will scroll in real time over time so that you can see the rate of publishing and consuming messages per second, And the consumer execution time is \"dotted\" on the Y1 axis (Y0 axis is the rates, and the Y1 axis is the execution elpsed time).</p>"},{"location":"user-guide/en/monitoring/opentelemetry/","title":"OpenTelemetry","text":"<p>https://opentelemetry.io/</p> <p>OpenTelemetry is a collection of tools, APIs, and SDKs. Use it to instrument, generate, collect, and export telemetry data (metrics, logs, and traces) to help you analyze your software\u2019s performance and behavior.</p>"},{"location":"user-guide/en/monitoring/opentelemetry/#integration","title":"Integration","text":"<p>You can find it here about how to use OpenTelemetry in console applications or ASP.NET Core, at here we mainly describe how to tracing CAP data to OpenTelemetry.</p>"},{"location":"user-guide/en/monitoring/opentelemetry/#configuration","title":"Configuration","text":"<p>Install the CAP OpenTelemetry package into the project.</p> <pre><code>dotnet add package DotNetCore.Cap.OpenTelemetry\n</code></pre> <p>The OpenTelemetry data comes from diagnostics, add the instrumentation of CAP to the configuration of OpenTelemetry.</p> <pre><code>services.AddOpenTelemetryTracing((builder) =&gt; builder\n.AddAspNetCoreInstrumentation()\n.AddCapInstrumentation()    // &lt;-- Add this line\n.AddZipkinExporter()\n);\n</code></pre> <p>Here is a diagram of CAP's tracking data in Zipkin:</p> <p></p>"},{"location":"user-guide/en/samples/eshoponcontainers/","title":"eShopOnContainers","text":"<p>eShopOnContainers is a sample application written in C# running on .NET Core using a microservice architecture, Domain Driven Design.</p> <p>.NET Core reference application, powered by Microsoft, based on a simplified microservices architecture and Docker containers.</p> <p>This reference application is cross-platform at the server and client side, thanks to .NET Core services capable of running on Linux or Windows containers depending on your Docker host, and to Xamarin for mobile apps running on Android, iOS or Windows/UWP plus any browser for the client web apps.</p> <p>The architecture proposes a microservice oriented architecture implementation with multiple autonomous microservices (each one owning its own data/db) and implementing different approaches within each microservice (simple CRUD vs. DDD/CQRS patterns) using Http as the communication protocol between the client apps and the microservices and supports asynchronous communication for data updates propagation across multiple services based on Integration Events and an Event Bus (a light message broker, to choose between RabbitMQ or Azure Service Bus, underneath) plus other features defined at the roadmap.</p>"},{"location":"user-guide/en/samples/eshoponcontainers/#eshoponcontainers-with-cap","title":"eShopOnContainers with CAP","text":"<p>You can see how to use caps in eShopOnContainers at the Github repository.</p> <p>https://github.com/yang-xiaodong/eShopOnContainers</p>"},{"location":"user-guide/en/samples/faq/","title":"FAQ","text":"<p>Any IM group(e.g Tencent QQ group) to learn and chat about CAP?</p> <p>None of that. Better than wasting much time in IM group, I hope developers could be capable of independent thinking more, and solve problems yourselves with referenced documents, even create issues or send emails when errors are remaining present.</p> <p>Does it require different databases, one each for producer and consumer in CAP?</p> <p>No difference necessary, a recommendation is to use a dedicated database for each program.</p> <p>Otherwise, look at Q&amp;A below.</p> <p>How to use the same database for different applications?</p> <p>Define a table prefix name in <code>ConfigureServices</code> method.</p> <p>Code example\uff1a</p> <pre><code>public void ConfigureServices(IServiceCollection services)\n{\nservices.AddCap(x =&gt;\n{\nx.UseKafka(\"\");\nx.UseMySql(opt =&gt;\n{\nopt.ConnectionString = \"connection string\";\nopt.TableNamePrefix = \"appone\"; // different table name prefix here\n});\n});\n}\n</code></pre> <p>Can CAP not use the database as event storage? I just want to send the message</p> <p>Not yet.</p> <p>The purpose of CAP is that ensure consistency principle right in microservice or SOA architectures. The solution is based on ACID features of database, there is no sense about a single client wapper of message queue without database.</p> <p>If the consumer is abnormal, can I roll back the database executed sql that the producer has executed?</p> <p>Can't roll back, CAP is the ultimate consistency solution.</p> <p>You can imagine your scenario is to call a third party payment. If you are doing a third-party payment operation, after calling Alipay's interface successfully, and your own code is wrong, will Alipay roll back? If you don't roll back, what should you do? The same is true here.</p>"},{"location":"user-guide/en/samples/github/","title":"Github Samples","text":"<p>You can find the sample code at the Github repository:</p> <p>https://github.com/dotnetcore/CAP/tree/master/samples</p>"},{"location":"user-guide/en/storage/general/","title":"General","text":"<p>CAP needs to use storage media with persistence capabilities to store event messages in databases or other NoSql facilities. CAP uses this approach to deal with loss of messages in all environments or network anomalies. Reliability of messages is the cornerstone of distributed transactions, so messages cannot be lost under any circumstances.</p>"},{"location":"user-guide/en/storage/general/#persistence","title":"Persistence","text":""},{"location":"user-guide/en/storage/general/#before-sent","title":"Before sent","text":"<p>Before message enters the message queue, CAP uses the local database table to persist the message, which ensures that the message is not lost when the message queue is abnormal or a network error occurs.</p> <p>To ensure the reliability of this mechanism, CAP uses the same database transactions as the business code to ensure that business operations and CAP messages are consistent in the persistence process. That is to say, in the process of message persistence, the database will be rolled back when any one of the exceptions occurs.</p>"},{"location":"user-guide/en/storage/general/#after-sent","title":"After sent","text":"<p>After the message enters the message queue, CAP will start the persistence function of the message queue. We need to explain how CAP message is persisted in RabbitMQ and Kafka.</p> <p>For message persistence in RabbitMQ, CAP uses a consumer queue with message persistence, but there may be exceptions here.</p> <p>Ready for production?</p> <p>By default, queues registered by CAP in RabbitMQ are persistent. When used in a production environment, we recommend that you start all consumers once to create the queues with persistence, which ensures that all queues are created before the message is sent.</p> <p>Since Kafka is born with message persistence using files, Kafka will ensure that messages are properly persisted without loss after the message enters Kafka.</p>"},{"location":"user-guide/en/storage/general/#storage","title":"Storage","text":""},{"location":"user-guide/en/storage/general/#supported-storages","title":"Supported storages","text":"<p>CAP supports the following types of transaction-enabled databases for storage:</p> <ul> <li>SQL Server</li> <li>MySQL</li> <li>PostgreSql</li> <li>MongoDB</li> <li>In-Memory Storage</li> </ul> <p>After CAP is started, two tables are generated in used storage, by default the name is <code>Cap.Published</code> and <code>Cap.Received</code>.</p>"},{"location":"user-guide/en/storage/general/#storage-data-structure","title":"Storage Data Structure","text":"<p>Table structure of Published :</p> NAME DESCRIPTION TYPE Id Message Id int Version Message Version string Name Topic Name string Content Json Content string Added Added Time DateTime ExpiresAt Expire time DateTime Retries Retry times int StatusName Status Name string <p>Table structure of Received :</p> NAME DESCRIPTION TYPE Id Message Id int Version Message Version string Name Topic Name string Group Group Name string Content Json Content string Added Added Time DateTime ExpiresAt Expire time DateTime Retries Retry times int StatusName Status Name string <p>Table structure of Lock (Optional):</p> NAME DESCRIPTION TYPE Key Lock Id string Instance Acquired instance of lock string LastLockTime Last acquired lock time DateTime"},{"location":"user-guide/en/storage/general/#wapper-object","title":"Wapper Object","text":"<p>When CAP sends a message, it will store original message object in a second package in the <code>Content</code> field. </p> <p>The following is the Wapper Object data structure of Content field.</p> NAME DESCRIPTION TYPE Id Message Id string Timestamp Message created time string Content Message content string CallbackName Consumer callback topic name string <p>The <code>Id</code> field is generate using the mongo objectid algorithm.</p>"},{"location":"user-guide/en/storage/general/#community-supported-extensions","title":"Community-supported extensions","text":"<p>Thanks to the community for supporting CAP, the following is the implementation of community-supported storage</p> <ul> <li> <p>SQLite (@colinin) \uff1ahttps://github.com/colinin/DotNetCore.CAP.Sqlite </p> </li> <li> <p>LiteDB (@maikebing) \uff1ahttps://github.com/maikebing/CAP.Extensions</p> </li> <li> <p>SQLite &amp; Oracle (@cocosip) \uff1ahttps://github.com/cocosip/CAP-Extensions </p> </li> </ul>"},{"location":"user-guide/en/storage/in-memory-storage/","title":"In-Memory Storage","text":"<p>In-memory storage is often used in development and test environments, and if you use memory-based storage you lose the reliability of local transaction messages.</p>"},{"location":"user-guide/en/storage/in-memory-storage/#configuration","title":"Configuration","text":"<p>To use in-memory storage, you need to install following package from NuGet:</p> <pre><code>PM&gt; Install-Package DotNetCore.CAP.InMemoryStorage\n</code></pre> <p>Next, add configuration items to the <code>ConfigureServices</code> method of <code>Startup.cs</code>.</p> <pre><code>public void ConfigureServices(IServiceCollection services)\n{\n// ...\n\nservices.AddCap(x =&gt;\n{\nx.UseInMemoryStorage();\n// x.UseXXX ...\n});\n}\n</code></pre> <p>CAP will clean every 5 minutes Successful messages in memory.</p>"},{"location":"user-guide/en/storage/in-memory-storage/#publish-with-transaction","title":"Publish with transaction","text":"<p>In-Memory Storage does not support Transaction mode to send messages.</p>"},{"location":"user-guide/en/storage/mongodb/","title":"MongoDB","text":"<p>MongoDB is a cross-platform document-oriented database program. Classified as a NoSQL database program, MongoDB uses JSON-like documents with schema.</p> <p>CAP supports MongoDB since version 2.3 .</p> <p>MongoDB supports ACID transactions since version 4.0, so CAP only supports MongoDB above 4.0, and MongoDB needs to be deployed as a cluster, because MongoDB's ACID transaction requires a cluster to be used.</p> <p>For a quick development of the MongoDB 4.0+ cluster for the development environment, you can refer to this article.</p>"},{"location":"user-guide/en/storage/mongodb/#configuration","title":"Configuration","text":"<p>To use MongoDB storage, you need to install the following package from NuGet:</p> <pre><code>PM&gt; Install-Package DotNetCore.CAP.MongoDB\n</code></pre> <p>Next, add configuration items to the <code>ConfigureServices</code> method of <code>Startup.cs</code>.</p> <pre><code>public void ConfigureServices(IServiceCollection services)\n{\n// ...\n\nservices.AddCap(x =&gt;\n{\nx.UseMongoDB(opt=&gt;{\n//MongoDBOptions\n});\n// x.UseXXX ...\n});\n}\n</code></pre>"},{"location":"user-guide/en/storage/mongodb/#mongodb-options","title":"MongoDB Options","text":"NAME DESCRIPTION TYPE DEFAULT DatabaseName Database name string cap DatabaseConnection Database connection string string mongodb://localhost:27017 ReceivedCollection Database received message collection name string cap.received PublishedCollection Database published message collection name string cap.published"},{"location":"user-guide/en/storage/mongodb/#publish-with-transaction","title":"Publish with transaction","text":"<p>The following example shows how to leverage CAP and MongoDB for local transaction integration.</p> <pre><code>//NOTE: Before your test, your need to create database and collection at first.\n//      Mongo can't create databases and collections in transactions automatic, \n//      so you need to create them separately, simulating a record insert \n//      will automatically create.\n\n// var mycollection = _client.GetDatabase(\"test\")\n//          .GetCollection&lt;BsonDocument&gt;(\"test.collection\");\n// mycollection.InsertOne(new BsonDocument { { \"test\", \"test\" } });\n\nusing (var session = _client.StartTransaction(_capBus, autoCommit: false))\n{\nvar collection = _client.GetDatabase(\"test\")\n.GetCollection&lt;BsonDocument&gt;(\"test.collection\");\n\ncollection.InsertOne(session, new BsonDocument { { \"hello\", \"world\" } });\n\n_capBus.Publish(\"sample.rabbitmq.mongodb\", DateTime.Now);\n\nsession.CommitTransaction();\n}\n</code></pre>"},{"location":"user-guide/en/storage/mysql/","title":"MySQL","text":"<p>MySQL is an open-source relational database management system. CAP supports MySQL database. </p>"},{"location":"user-guide/en/storage/mysql/#configuration","title":"Configuration","text":"<p>To use MySQL storage, you need to install the following package from NuGet:</p> <pre><code>PM&gt; Install-Package DotNetCore.CAP.MySql\n</code></pre> <p>Next, add configuration items to the <code>ConfigureServices</code> method of <code>Startup.cs</code>.</p> <pre><code>public void ConfigureServices(IServiceCollection services)\n{\n// ...\n\nservices.AddCap(x =&gt;\n{\nx.UseMySql(opt=&gt;{\n//MySqlOptions\n});\n// x.UseXXX ...\n});\n}\n</code></pre>"},{"location":"user-guide/en/storage/mysql/#mysqloptions","title":"MySqlOptions","text":"NAME DESCRIPTION TYPE DEFAULT TableNamePrefix CAP table name prefix string cap ConnectionString Database connection string string null"},{"location":"user-guide/en/storage/mysql/#publish-with-transaction","title":"Publish with transaction","text":""},{"location":"user-guide/en/storage/mysql/#adonet-with-transaction","title":"ADO.NET with transaction","text":"<pre><code>private readonly ICapPublisher _capBus;\n\nusing (var connection = new MySqlConnection(AppDbContext.ConnectionString))\n{\nusing (var transaction = connection.BeginTransaction(_capBus, autoCommit: false))\n{\n//your business code\nconnection.Execute(\"insert into test(name) values('test')\", transaction: (IDbTransaction)transaction.DbTransaction);\n\n_capBus.Publish(\"sample.rabbitmq.mysql\", DateTime.Now);\n\ntransaction.Commit();\n}\n}\n</code></pre>"},{"location":"user-guide/en/storage/mysql/#entityframework-with-transaction","title":"EntityFramework with transaction","text":"<pre><code>private readonly ICapPublisher _capBus;\n\nusing (var trans = dbContext.Database.BeginTransaction(_capBus, autoCommit: false))\n{\ndbContext.Persons.Add(new Person() { Name = \"ef.transaction\" });\n\n_capBus.Publish(\"sample.rabbitmq.mysql\", DateTime.Now);\n\ndbContext.SaveChanges();\ntrans.Commit();\n}\n</code></pre>"},{"location":"user-guide/en/storage/postgresql/","title":"Postgre SQL","text":"<p>PostgreSQL is an open-source relational database management system. CAP supports PostgreSQL database. </p>"},{"location":"user-guide/en/storage/postgresql/#configuration","title":"Configuration","text":"<p>To use PostgreSQL storage, you need to install the following package from NuGet:</p> <pre><code>PM&gt; Install-Package DotNetCore.CAP.PostgreSql\n</code></pre> <p>Next, add configuration items to the <code>ConfigureServices</code> method of <code>Startup.cs</code>.</p> <pre><code>public void ConfigureServices(IServiceCollection services)\n{\n// ...\n\nservices.AddCap(x =&gt;\n{\nx.UsePostgreSql(opt=&gt;{\n//PostgreSqlOptions\n}); // x.UseXXX ...\n});\n}\n</code></pre>"},{"location":"user-guide/en/storage/postgresql/#postgresqloptions","title":"PostgreSqlOptions","text":"NAME DESCRIPTION TYPE DEFAULT Schema Database schema string cap ConnectionString Database connection string string"},{"location":"user-guide/en/storage/postgresql/#publish-with-transaction","title":"Publish with transaction","text":""},{"location":"user-guide/en/storage/postgresql/#adonet-with-transaction","title":"ADO.NET with transaction","text":"<pre><code>private readonly ICapPublisher _capBus;\n\nusing (var connection = new NpgsqlConnection(\"ConnectionString\"))\n{\nusing (var transaction = connection.BeginTransaction(_capBus, autoCommit: false))\n{\n//your business code\nconnection.Execute(\"insert into test(name) values('test')\", transaction: (IDbTransaction)transaction.DbTransaction);\n\n_capBus.Publish(\"sample.rabbitmq.mysql\", DateTime.Now);\n\ntransaction.Commit();\n}\n}\n</code></pre>"},{"location":"user-guide/en/storage/postgresql/#entityframework-with-transaction","title":"EntityFramework with transaction","text":"<pre><code>private readonly ICapPublisher _capBus;\n\nusing (var trans = dbContext.Database.BeginTransaction(_capBus, autoCommit: false))\n{\ndbContext.Persons.Add(new Person() { Name = \"ef.transaction\" });\n\n_capBus.Publish(\"sample.rabbitmq.mysql\", DateTime.Now);\n\ndbContext.SaveChanges();\ntrans.Commit();\n}\n</code></pre>"},{"location":"user-guide/en/storage/sqlserver/","title":"SQL Server","text":"<p>SQL Server is a relational database management system developed by Microsoft. CAP supports SQL Server database. </p> <p>Warning</p> <p>We currently use <code>Microsoft.Data.SqlClient</code> as the database driver, which is the future of SQL Server drivers, and we have abandoned <code>System.Data.SqlClient</code>, we suggest that you switch to.</p>"},{"location":"user-guide/en/storage/sqlserver/#configuration","title":"Configuration","text":"<p>To use SQL Server storage, you need to install the following package from NuGet:</p> <pre><code>PM&gt; Install-Package DotNetCore.CAP.SqlServer\n</code></pre> <p>Next, add configuration items to the <code>ConfigureServices</code> method of <code>Startup.cs</code>.</p> <pre><code>public void ConfigureServices(IServiceCollection services)\n{\n// ...\n\nservices.AddCap(x =&gt;\n{\nx.UseSqlServer(opt=&gt;{\n//SqlServerOptions\n}); // x.UseXXX ...\n});\n}\n</code></pre>"},{"location":"user-guide/en/storage/sqlserver/#sqlserveroptions","title":"SqlServerOptions","text":"NAME DESCRIPTION TYPE DEFAULT Schema Database schema string Cap ConnectionString Database connection string string"},{"location":"user-guide/en/storage/sqlserver/#publish-with-transaction","title":"Publish with transaction","text":""},{"location":"user-guide/en/storage/sqlserver/#adonet-with-transaction","title":"ADO.NET with transaction","text":"<pre><code>private readonly ICapPublisher _capBus;\n\nusing (var connection = new SqlConnection(\"ConnectionString\"))\n{\nusing (var transaction = connection.BeginTransaction(_capBus, autoCommit: false))\n{\n//your business code\nconnection.Execute(\"insert into test(name) values('test')\", transaction: (IDbTransaction)transaction.DbTransaction);\n\n_capBus.Publish(\"sample.rabbitmq.mysql\", DateTime.Now);\n\ntransaction.Commit();\n}\n}\n</code></pre>"},{"location":"user-guide/en/storage/sqlserver/#entityframework-with-transaction","title":"EntityFramework with transaction","text":"<pre><code>private readonly ICapPublisher _capBus;\n\nusing (var trans = dbContext.Database.BeginTransaction(_capBus, autoCommit: false))\n{\ndbContext.Persons.Add(new Person() { Name = \"ef.transaction\" });\n\n_capBus.Publish(\"sample.rabbitmq.mysql\", DateTime.Now);\n\ndbContext.SaveChanges();\ntrans.Commit();\n}\n</code></pre>"},{"location":"user-guide/en/transport/aws-sqs/","title":"Amazon SQS","text":"<p>AWS SQS is a fully managed message queuing service that enables you to decouple and scale microservices, distributed systems, and serverless applications.</p> <p>AWS SNS is a highly available, durable, secure, fully managed pub/sub messaging service that enables you to decouple microservices, distributed systems, and serverless applications.</p>"},{"location":"user-guide/en/transport/aws-sqs/#how-cap-uses-aws-sns-and-sqs","title":"How CAP uses AWS SNS and SQS","text":""},{"location":"user-guide/en/transport/aws-sqs/#sns","title":"SNS","text":"<p>Because CAP works based on the topic pattern, it needs to use AWS SNS, which simplifies the publish and subscribe architecture of messages.</p> <p>When CAP startups, all subscription names will be registered as SNS topics, and you will see a list of all registered topics in the management console.</p> <p>SNS does not support use of symbols such as <code>.</code> <code>:</code> as the name of the topic, so we replaced it. We replaced <code>.</code> with <code>-</code> and <code>:</code> with <code>_</code></p> <p>Precautions</p> <p>Amazon SNS currently allows maximum size of published messages to be 256KB</p> <p>For example, you have the following two subscriber methods in your current project</p> <p><pre><code>[CapSubscribe(\"sample.sns.foo\")]\npublic void TestFoo(DateTime value)\n{\n}\n\n[CapSubscribe(\"sample.sns.bar\")]\npublic void TestBar(DateTime value)\n{\n}\n</code></pre> After CAP startups, you will see in SNS management console:</p> <p></p>"},{"location":"user-guide/en/transport/aws-sqs/#sqs","title":"SQS","text":"<p>For each consumer group, CAP will create a corresponding SQS queue, the name of the queue is the name of the <code>DefaultGroup</code> in the configuration options, and the queue type is Standard.</p> <p>The SQS queue will subscribe to Topic in SNS, as shown below:</p> <p></p> <p>Precautions</p> <p>Due to the limitation of AWS SNS, when you remove the subscription method, CAP will not delete topics or queues on AWS SNS or SQS, you need to delete them manually.</p>"},{"location":"user-guide/en/transport/aws-sqs/#configuration","title":"Configuration","text":"<p>To use AWS SQS as the transport, you need to install the packages from NuGet:</p> <pre><code>Install-Package DotNetCore.CAP.AmazonSQS\n</code></pre> <p>Next, add configuration items to the <code>ConfigureServices</code> method of <code>Startup.cs</code>:</p> <pre><code>public void ConfigureServices(IServiceCollection services)\n{\n// ...\n\nservices.AddCap(x =&gt;\n{\nx.UseAmazonSQS(opt=&gt;\n{\n//AmazonSQSOptions\n});\n// x.UseXXX ...\n});\n}\n</code></pre>"},{"location":"user-guide/en/transport/aws-sqs/#amazonsqs-options","title":"AmazonSQS Options","text":"<p>The SQS configuration parameters provided directly by the CAP:</p> NAME DESCRIPTION TYPE DEFAULT Region AWS Region Amazon.RegionEndpoint Credentials AWS AK SK Information Amazon.Runtime.AWSCredentials <p>If your project runs in AWS EC2, you don't need to set Credentials, you can directly apply IAM policy for EC2.</p> <p>Credentials requires the SNS,SQS IAM policy.</p>"},{"location":"user-guide/en/transport/azure-service-bus/","title":"Azure Service Bus","text":"<p>Microsoft Azure Service Bus is a fully managed enterprise integration message broker. Service Bus is most commonly used to decouple applications and services from each other, and is a reliable and secure platform for asynchronous data and state transfer.</p> <p>Azure services can be used in CAP as a message transporter.</p>"},{"location":"user-guide/en/transport/azure-service-bus/#configuration","title":"Configuration","text":"<p>Requirement</p> <p>For the Service Bus pricing layer, CAP requires \"standard\" or \"advanced\" to support Topic functionality.</p> <p>To use Azure Service Bus as a message transport, you need to install the following package from NuGet:</p> <pre><code>PM&gt; Install-Package DotNetCore.CAP.AzureServiceBus\n</code></pre> <p>Next, add configuration items to the <code>ConfigureServices</code> method of <code>Startup.cs</code>:</p> <pre><code>public void ConfigureServices(IServiceCollection services)\n{\n// ...\n\nservices.AddCap(x =&gt;\n{\nx.UseAzureServiceBus(opt=&gt;\n{\n//AzureServiceBusOptions\n});\n// x.UseXXX ...\n});\n}\n</code></pre>"},{"location":"user-guide/en/transport/azure-service-bus/#azureservicebus-options","title":"AzureServiceBus Options","text":"<p>The AzureServiceBus configuration options provided directly by the CAP:</p> NAME DESCRIPTION TYPE DEFAULT ConnectionString Endpoint address string EnableSessions Enable Service bus sessions bool false TopicPath Topic entity path string cap ManagementTokenProvider Token provider ITokenProvider null AutoCompleteMessages Gets a value that indicates whether the processor should automatically complete messages after the message handler has completed processing bool false CustomHeaders Adds custom and/or mandatory Headers for incoming messages from heterogeneous systems. <code>Func&lt;Message, List&lt;KeyValuePair&lt;string, string&gt;&gt;&gt;?</code> null Namespace Namespace of Servicebus , Needs to be set when using with TokenCredential Property string null SQLFilters Custom SQL Filters by name and expression on Topic Subscribtion List&gt; null"},{"location":"user-guide/en/transport/azure-service-bus/#sessions","title":"Sessions","text":"<p>When sessions are enabled (see <code>EnableSessions</code> option above), every message sent will have a session id. To control the session id, include an extra header with name <code>AzureServiceBusHeaders.SessionId</code> when publishing events:</p> <pre><code>ICapPublisher capBus = ...;\nstring yourEventName = ...;\nYourEventType yourEvent = ...;\n\nDictionary&lt;string, string&gt; extraHeaders = new Dictionary&lt;string, string&gt;();\nextraHeaders.Add(AzureServiceBusHeaders.SessionId, &lt;your-session-id&gt;);\n\ncapBus.Publish(yourEventName, yourEvent, extraHeaders);\n</code></pre> <p>If no session id header is present, the message id will be used as the session id.</p>"},{"location":"user-guide/en/transport/azure-service-bus/#heterogeneous-systems","title":"Heterogeneous Systems","text":"<p>Sometimes you might want to listen to a message that was published by an external system. In this case, you need to add a set of two mandatory headers for CAP compatibility as shown below.</p> <pre><code>c.UseAzureServiceBus(asb =&gt;\n{\nasb.ConnectionString = ...\nasb.CustomHeaders = message =&gt; new List&lt;KeyValuePair&lt;string, string&gt;&gt;()\n{\nnew(DotNetCore.CAP.Messages.Headers.MessageId,\nSnowflakeId.Default().NextId().ToString()),\nnew(DotNetCore.CAP.Messages.Headers.MessageName, message.Label)\n};\n});\n</code></pre>"},{"location":"user-guide/en/transport/azure-service-bus/#sql-filters","title":"SQL Filters","text":"<p>You can set SQL filters on subscribtion level to get desired messages and not to have custom logic on business side. More about Azure Service Bus SQL FILTERS - Link</p> <p>SQLFilters is List Of KeyValuePair , Key is filter name and Value SQL Expression. <pre><code>c.UseAzureServiceBus(asb =&gt;\n{\nasb.ConnectionString = ...\nasb.SQLFilters = new List&lt;KeyValuePair&lt;string, string&gt;&gt; {\n\nnew KeyValuePair&lt;string,string&gt;(\"IOTFilter\",\"FromIOTHub='true'\"),//The message will be handled if ApplicationProperties contains IOTFilter and value is true\nnew KeyValuePair&lt;string,string&gt;(\"SequenceFilter\",\"sys.enqueuedSequenceNumber &gt;= 300\")\n};\n});\n</code></pre>"},{"location":"user-guide/en/transport/general/","title":"Transports","text":"<p>Transports move data from one place to another \u2013 between acquisition programs and pipelines, between pipelines and the entity database, and even between pipelines and external systems.</p>"},{"location":"user-guide/en/transport/general/#supported-transports","title":"Supported transports","text":"<p>CAP supports several transport methods:</p> <ul> <li>RabbitMQ</li> <li>Kafka</li> <li>Azure Service Bus</li> <li>Amazon SQS</li> <li>NATS</li> <li>In-Memory Queue</li> <li>Redis Streams</li> <li>Apache Pulsar</li> </ul>"},{"location":"user-guide/en/transport/general/#how-to-select-a-transport","title":"How to select a transport","text":"\ud83c\udff3\u200d\ud83c\udf08 RabbitMQ Kafka Azure Service Bus In-Memory Positioning Reliable message transmission Real time data processing Cloud In-Memory, testing Distributed \u2714 \u2714 \u2714 \u274c Persistence \u2714 \u2714 \u2714 \u274c Performance Medium High Medium High <p><code>Azure Service Bus</code> vs <code>RabbitMQ</code> : http://geekswithblogs.net/michaelstephenson/archive/2012/08/12/150399.aspx</p> <p><code>Kafka</code> vs <code>RabbitMQ</code> :  https://stackoverflow.com/questions/42151544/is-there-any-reason-to-use-rabbitmq-over-kafka</p>"},{"location":"user-guide/en/transport/general/#community-supported-transport-extensions","title":"Community-supported transport extensions","text":"<p>Thanks to the community for supporting CAP, the following is the implementation of community-supported transport</p> <ul> <li> <p>ActiveMQ (@Lukas Zhang): https://github.com/lukazh</p> </li> <li> <p>RedisMQ  (@\u6728\u6728) https://github.com/difudotnet/CAP.RedisMQ.Extensions</p> </li> <li> <p>ZeroMQ (@maikebing)\uff1a https://github.com/maikebing/CAP.Extensions</p> </li> <li> <p>MQTT (@john jiang): https://github.com/jinzaz/jinzaz.CAP.MQTT</p> </li> </ul>"},{"location":"user-guide/en/transport/in-memory-queue/","title":"In-Memory Queue","text":"<p>In Memory Queue is a memory-based message queue provided by Community.</p>"},{"location":"user-guide/en/transport/in-memory-queue/#configuration","title":"Configuration","text":"<p>To use In Memory Queue as a message transporter, you need to install the following package from NuGet:</p> <pre><code>PM&gt; Install-Package Savorboard.CAP.InMemoryMessageQueue\n</code></pre> <p>Next, add configuration options to the <code>ConfigureServices</code> method of <code>Startup.cs</code>:</p> <pre><code>public void ConfigureServices(IServiceCollection services)\n{\n// ...\n\nservices.AddCap(x =&gt;\n{\nx.UseInMemoryMessageQueue();\n// x.UseXXX ...\n});\n}\n</code></pre>"},{"location":"user-guide/en/transport/kafka/","title":"Apache Kafka\u00ae","text":"<p>Apache Kafka\u00ae  is an open-source stream-processing software platform developed by LinkedIn and donated to the Apache Software Foundation, written in Scala and Java.</p> <p>Kafka\u00ae can be used in CAP as a message transporter. </p>"},{"location":"user-guide/en/transport/kafka/#configuration","title":"Configuration","text":"<p>To use Kafka transporter, you need to install the following package from NuGet:</p> <pre><code>PM&gt; Install-Package DotNetCore.CAP.Kafka\n</code></pre> <p>Then you can add configuration items to the <code>ConfigureServices</code> method of <code>Startup.cs</code>.</p> <pre><code>public void ConfigureServices(IServiceCollection services)\n{\n// ...\n\nservices.AddCap(x =&gt;\n{\nx.UseKafka(opt=&gt;{\n//KafkaOptions\n});\n// x.UseXXX ...\n});\n}\n</code></pre>"},{"location":"user-guide/en/transport/kafka/#kafka-options","title":"Kafka Options","text":"<p>The Kafka configuration parameters provided directly by the CAP:</p> NAME DESCRIPTION TYPE DEFAULT Servers Broker server address string ConnectionPoolSize connection pool size int 10 CustomHeaders Custom subscribe headers Func&lt;&gt; N/A"},{"location":"user-guide/en/transport/kafka/#customheaders-options","title":"CustomHeaders Options","text":"<p>When the message sent from a heterogeneous system, because of the CAP needs to define additional headers, so an exception will occur at this time. By providing this parameter to set the custom headersn to make the subscriber works.</p> <p>You can find the description of heterogeneous system integration here.</p> <p>Sometimes, if you want to get additional context information from Broker, you can also add it through this option. For example, add information such as Offset or Partition.</p> <p>Example\uff1a</p> <pre><code>x.UseKafka(opt =&gt;\n{\n//...\n\nopt.CustomHeaders = kafkaResult =&gt; new List&lt;KeyValuePair&lt;string, string&gt;&gt;\n{\nnew KeyValuePair&lt;string, string&gt;(\"my.kafka.offset\", kafkaResult.Offset.ToString()),\nnew KeyValuePair&lt;string, string&gt;(\"my.kafka.partition\", kafkaResult.Partition.ToString())\n};\n});\n</code></pre> <p>Then you can get the header you added by this way:</p> <pre><code>[CapSubscribe(\"sample.kafka.postgrsql\")]\npublic void HeadersTest(DateTime value, [FromCap]CapHeader header)\n{\nvar offset = header[\"my.kafka.offset\"];\nvar partition = header[\"my.kafka.partition\"];\n}\n</code></pre>"},{"location":"user-guide/en/transport/kafka/#kafka-mainconfig-options","title":"Kafka MainConfig Options","text":"<p>If you need more native Kakfa related configuration options, you can set them in the <code>MainConfig</code> configuration option:</p> <pre><code>services.AddCap(capOptions =&gt; {\ncapOptions.UseKafka(kafkaOption=&gt;\n{\n// kafka options.\n// kafkaOptions.MainConfig.Add(\"\", \"\");\n});\n});\n</code></pre> <p><code>MainConfig</code> is a configuration dictionary, you can find a list of supported configuration options through the following link.</p> <p>https://github.com/edenhill/librdkafka/blob/master/CONFIGURATION.md</p>"},{"location":"user-guide/en/transport/nats/","title":"NATS","text":"<p>NATS is a simple, secure and performant communications system for digital systems, services and devices. NATS is part of the Cloud Native Computing Foundation (CNCF).</p> <p>Warning</p> <p>Versions of CAP below 5.2.0 are implement based on Request/Response mode, and now we are based on JetStream implementation. see https://github.com/dotnetcore/CAP/issues/983 for more information.</p>"},{"location":"user-guide/en/transport/nats/#configuration","title":"Configuration","text":"<p>To use NATS transporter, you need to install the following package from NuGet:</p> <pre><code>PM&gt; Install-Package DotNetCore.CAP.NATS\n</code></pre> <p>Then you can add configuration items to the <code>ConfigureServices</code> method of <code>Startup.cs</code>.</p> <pre><code>public void ConfigureServices(IServiceCollection services)\n{\nservices.AddCap(capOptions =&gt;\n{\ncapOptions.UseNATS(natsOptions=&gt;{\n//NATS Options\n});\n});\n}\n</code></pre>"},{"location":"user-guide/en/transport/nats/#nats-options","title":"NATS Options","text":"<p>NATS configuration parameters provided directly by the CAP:</p> NAME DESCRIPTION TYPE DEFAULT Options NATS client configuration Options Options Servers Server url/urls used to connect to the NATs server. string NULL ConnectionPoolSize number of connections pool uint 10"},{"location":"user-guide/en/transport/nats/#nats-configurationoptions","title":"NATS ConfigurationOptions","text":"<p>If you need more native NATS related configuration options, you can set them in the <code>Options</code> option:</p> <pre><code>services.AddCap(capOptions =&gt; {\ncapOptions.UseNATS(natsOptions=&gt;\n{\n// NATS options.\nnatsOptions.Options.Url=\"\";\n});\n});\n</code></pre> <p><code>Options</code> is a NATS.Client ConfigurationOptions , you can find more details through this link</p>"},{"location":"user-guide/en/transport/pulsar/","title":"Apache Pulsar","text":"<p>Apache Pulsar is a cloud-native, distributed messaging and streaming platform originally created at Yahoo! and now a top-level Apache Software Foundation project.</p> <p>Pulsar can be used in CAP as a message transporter. </p>"},{"location":"user-guide/en/transport/pulsar/#configuration","title":"Configuration","text":"<p>To use Pulsar transporter, you need to install the following package from NuGet:</p> <pre><code>PM&gt; Install-Package DotNetCore.CAP.Pulsar\n</code></pre> <p>Then you can add configuration items to the <code>ConfigureServices</code> method of <code>Startup.cs</code>.</p> <pre><code>public void ConfigureServices(IServiceCollection services)\n{\n// ...\n\nservices.AddCap(x =&gt;\n{\nx.UsePulsar(opt =&gt; {\n//Pulsar options\n});\n// x.UseXXX ...\n});\n}\n</code></pre>"},{"location":"user-guide/en/transport/pulsar/#pulsar-options","title":"Pulsar Options","text":"<p>The Pulsar configuration parameters provided directly by the CAP:</p> NAME DESCRIPTION TYPE DEFAULT ServiceUrl Broker server address string TlsOptions Tls configuration object"},{"location":"user-guide/en/transport/rabbitmq/","title":"RabbitMQ","text":"<p>RabbitMQ is an open-source message-broker software that originally implemented the Advanced Message Queuing Protocol and has since been extended with a plug-in architecture to support Streaming Text Oriented Messaging Protocol, Message Queuing Telemetry Transport, and other protocols.</p> <p>RabbitMQ can be used in CAP as a message transporter. </p>"},{"location":"user-guide/en/transport/rabbitmq/#configuration","title":"Configuration","text":"<p>To use RabbitMQ transporter, you need to install the following package from NuGet:</p> <pre><code>PM&gt; Install-Package DotNetCore.CAP.RabbitMQ\n</code></pre> <p>Next, add configuration items to the <code>ConfigureServices</code> method of <code>Startup.cs</code>.</p> <pre><code>public void ConfigureServices(IServiceCollection services)\n{\n// ...\n\nservices.AddCap(x =&gt;\n{\nx.UseRabbitMQ(opt=&gt;\n{\n//RabbitMQOptions\n});\n// x.UseXXX ...\n});\n}\n</code></pre>"},{"location":"user-guide/en/transport/rabbitmq/#rabbitmq-options","title":"RabbitMQ Options","text":"<p>The RabbitMQ configuration parameters provided directly by CAP:</p> NAME DESCRIPTION TYPE DEFAULT HostName Broker host address string localhost UserName Broker user name string guest Password Broker password string guest VirtualHost Broker virtual host string / Port Port int -1 ExchangeName Default exchange name string cap.default.topic QueueArguments Extra queue <code>x-arguments</code> QueueArgumentsOptions N/A ConnectionFactoryOptions RabbitMQClient native connection options ConnectionFactory N/A CustomHeaders Custom subscribe headers See the blow N/A PublishConfirms Enable publish confirms bool false BasicQosOptions Specify Qos of message prefetch BasicQos N/A"},{"location":"user-guide/en/transport/rabbitmq/#connectionfactory-option","title":"ConnectionFactory Option","text":"<p>If you need more native <code>ConnectionFactory</code> configuration options, you can set it by 'ConnectionFactoryOptions' option:</p> <pre><code>services.AddCap(x =&gt;\n{\nx.UseRabbitMQ(o =&gt;\n{\no.HostName = \"localhost\";\no.ConnectionFactoryOptions = opt =&gt; { //rabbitmq client ConnectionFactory config\n};\n});\n});\n</code></pre>"},{"location":"user-guide/en/transport/rabbitmq/#customheaders-option","title":"CustomHeaders Option","text":"<p>When the message sent from the RabbitMQ management console or a heterogeneous system, because of the CAP needs to define additional headers, so an exception will occur at this time. By providing this parameter to set the custom headersn to make the subscriber works.</p> <p>You can find the description of Header Information here.</p> <p>Example\uff1a</p> <pre><code>x.UseRabbitMQ(aa =&gt;\n{\naa.CustomHeaders = e =&gt; new List&lt;KeyValuePair&lt;string, string&gt;&gt;\n{\nnew KeyValuePair&lt;string, string&gt;(Headers.MessageId, SnowflakeId.Default().NextId().ToString()),\nnew KeyValuePair&lt;string, string&gt;(Headers.MessageName, e.RoutingKey),\n};\n});\n</code></pre>"},{"location":"user-guide/en/transport/rabbitmq/#how-to-connect-cluster","title":"How to connect cluster","text":"<p>using comma split connection string, like this:</p> <pre><code>x=&gt; x.UseRabbitMQ(\"localhost:5672,localhost:5673,localhost:5674\")\n</code></pre>"},{"location":"user-guide/en/transport/redis-streams/","title":"Redis Streams","text":"<p>Redis is an open source (BSD licensed), in-memory data structure store, used as a database, cache, and message broker.</p> <p>Redis Stream is a new data type introduced with Redis 5.0, which models a log data structure in a more abstract way with an append only data structure.</p> <p>Redis Streams can be used in CAP as a message transporter. </p>"},{"location":"user-guide/en/transport/redis-streams/#configuration","title":"Configuration","text":"<p>To use Redis Streams transporter, you need to install the following package from NuGet:</p> <pre><code>PM&gt; Install-Package DotNetCore.CAP.RedisStreams\n</code></pre> <p>Then you can add configuration items to the <code>ConfigureServices</code> method of <code>Startup.cs</code>.</p> <pre><code>public void ConfigureServices(IServiceCollection services)\n{\nservices.AddCap(capOptions =&gt;\n{\ncapOptions.UseRedis(redisOptions=&gt;{\n//redisOptions\n});\n});\n}\n</code></pre>"},{"location":"user-guide/en/transport/redis-streams/#redis-streams-options","title":"Redis Streams Options","text":"<p>Redis configuration parameters provided directly by the CAP:</p> NAME DESCRIPTION TYPE DEFAULT Configuration redis connection configuration (StackExchange.Redis) ConfigurationOptions ConfigurationOptions StreamEntriesCount number of entries returned from a stream while reading uint 10 ConnectionPoolSize number of connections pool uint 10"},{"location":"user-guide/en/transport/redis-streams/#redis-configuration-options","title":"Redis Configuration Options","text":"<p>If you need more native Redis related configuration options, you can set them in the <code>Configuration</code> option:</p> <pre><code>services.AddCap(capOptions =&gt; {\ncapOptions.UseRedis(redisOptions=&gt;\n{\n// redis options.\nredisOptions.Configuration.EndPoints.Add(IPAddress.Loopback, 0);\n});\n});\n</code></pre> <p><code>Configuration</code> is a StackExchange.Redis ConfigurationOptions , you can find more details through this link</p>"},{"location":"user-guide/en/transport/redis-streams/#streams-cleanup-notes","title":"Streams Cleanup Notes","text":"<p>Since redis streams does not have the feature of deletes all messages that already acknowledged by all groups issue , so you need to consider if using a script to perform the deletion regularly.</p>"},{"location":"user-guide/zh/cap/configuration/","title":"\u914d\u7f6e","text":"<p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u4f60\u5728\u5411IoC\u5bb9\u5668\u4e2d\u6ce8\u518cCAP\u670d\u52a1\u7684\u65f6\u5019\u6307\u5b9a\u914d\u7f6e\u3002</p> <pre><code>services.AddCap(config=&gt; {\n// config.XXX \n});\n</code></pre> <p>\u5176\u4e2d <code>services</code> \u4ee3\u8868\u7684\u662f <code>IServiceCollection</code> \u63a5\u53e3\u5bf9\u8c61\uff0c\u5b83\u4f4d\u4e8e <code>Microsoft.Extensions.DependencyInjection</code> \u4e0b\u9762\u3002 </p> <p>\u5982\u679c\u4f60\u4e0d\u60f3\u4f7f\u7528\u5fae\u8f6f\u7684IoC\u5bb9\u5668\uff0c\u90a3\u4e48\u4f60\u53ef\u4ee5\u67e5\u770b ASP.NET Core \u8fd9\u91cc\u7684\u6587\u6863 \u6765\u4e86\u89e3\u5982\u4f55\u66ff\u6362\u9ed8\u8ba4\u7684\u5bb9\u5668\u5b9e\u73b0\u3002</p>"},{"location":"user-guide/zh/cap/configuration/#_2","title":"\u4ec0\u4e48\u662f\u6700\u4f4e\u914d\u7f6e\uff1f","text":"<p>\u6700\u7b80\u5355\u7684\u56de\u7b54\u5c31\u662f\uff0c\u81f3\u5c11\u4f60\u8981\u914d\u7f6e\u4e00\u4e2a\u6d88\u606f\u961f\u5217\u548c\u4e00\u4e2a\u4e8b\u4ef6\u5b58\u50a8\uff0c\u5982\u679c\u4f60\u60f3\u5feb\u901f\u5f00\u59cb\u4f60\u53ef\u4ee5\u4f7f\u7528\u4e0b\u9762\u7684\u914d\u7f6e\uff1a</p> <pre><code>services.AddCap(config =&gt; {\nconfig.UseInMemoryMessageQueue();\nconfig.UseInMemoryStorage();\n});\n</code></pre> <p>\u6709\u5173\u5177\u4f53\u7684\u6d88\u606f\u961f\u5217\u7684\u914d\u7f6e\u548c\u5b58\u50a8\u7684\u914d\u7f6e\uff0c\u4f60\u53ef\u4ee5\u67e5\u770b Transports \u7ae0\u8282\u548c Persistent \u7ae0\u8282\u4e2d\u5177\u4f53\u7ec4\u4ef6\u63d0\u4f9b\u7684\u914d\u7f6e\u9879\u3002</p>"},{"location":"user-guide/zh/cap/configuration/#cap","title":"CAP \u4e2d\u7684\u81ea\u5b9a\u4e49\u914d\u7f6e","text":"<p>\u5728 <code>AddCap</code> \u4e2d <code>CapOptions</code> \u5bf9\u8c61\u662f\u7528\u6765\u5b58\u50a8\u914d\u7f6e\u76f8\u5173\u4fe1\u606f\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u5b83\u4eec\u90fd\u5177\u6709\u4e00\u4e9b\u9ed8\u8ba4\u503c\uff0c\u6709\u4e9b\u65f6\u5019\u4f60\u53ef\u80fd\u9700\u8981\u81ea\u5b9a\u4e49\u3002</p>"},{"location":"user-guide/zh/cap/configuration/#defaultgroupname","title":"DefaultGroupName","text":"<p>\u9ed8\u8ba4\u503c\uff1acap.queue.{\u7a0b\u5e8f\u96c6\u540d\u79f0}</p> <p>\u9ed8\u8ba4\u7684\u6d88\u8d39\u8005\u7ec4\u7684\u540d\u5b57\uff0c\u5728\u4e0d\u540c\u7684 Transports \u4e2d\u5bf9\u5e94\u4e0d\u540c\u7684\u540d\u5b57\uff0c\u53ef\u4ee5\u901a\u8fc7\u81ea\u5b9a\u4e49\u6b64\u503c\u6765\u81ea\u5b9a\u4e49\u4e0d\u540c Transports \u4e2d\u7684\u540d\u5b57\uff0c\u4ee5\u4fbf\u4e8e\u67e5\u770b\u3002</p> <p>Mapping</p> <p>\u5728 RabbitMQ \u4e2d\u6620\u5c04\u5230 Queue Names\u3002 \u5728 Apache Kafka \u4e2d\u6620\u5c04\u5230 Consumer Group Id\u3002 \u5728 Azure Service Bus \u4e2d\u6620\u5c04\u5230 Subscription Name\u3002 \u5728 NATS \u4e2d\u6620\u5c04\u5230 Queue Group Name. \u5728 Redis Streams \u4e2d\u6620\u5c04\u5230 Consumer Group.</p>"},{"location":"user-guide/zh/cap/configuration/#groupnameprefix","title":"GroupNamePrefix","text":"<p>\u9ed8\u8ba4\u503c\uff1aNull</p> <p>\u4e3a\u8ba2\u9605 Group \u7edf\u4e00\u6dfb\u52a0\u524d\u7f00\u3002 https://github.com/dotnetcore/CAP/pull/780</p>"},{"location":"user-guide/zh/cap/configuration/#topicnameprefix","title":"TopicNamePrefix","text":"<p>\u9ed8\u8ba4\u503c\uff1a Null</p> <p>\u4e3a Topic \u7edf\u4e00\u6dfb\u52a0\u524d\u7f00\u3002 https://github.com/dotnetcore/CAP/pull/780</p>"},{"location":"user-guide/zh/cap/configuration/#version","title":"Version","text":"<p>\u9ed8\u8ba4\u503c\uff1av1</p> <p>\u8fd9\u662f\u5728CAP v2.4 \u7248\u672c\u4e2d\u5f15\u5165\u7684\u65b0\u914d\u7f6e\u9879\uff0c\u7528\u4e8e\u7ed9\u6d88\u606f\u6307\u5b9a\u7248\u672c\u6765\u9694\u79bb\u4e0d\u540c\u7248\u672c\u670d\u52a1\u7684\u6d88\u606f\uff0c\u5e38\u7528\u4e8eA/B\u6d4b\u8bd5\u6216\u8005\u591a\u670d\u52a1\u7248\u672c\u7684\u573a\u666f\u3002\u4ee5\u4e0b\u662f\u5176\u5e94\u7528\u573a\u666f\uff1a</p> <p>\u4e1a\u52a1\u5feb\u901f\u8fed\u4ee3\uff0c\u9700\u8981\u5411\u524d\u517c\u5bb9</p> <p>\u7531\u4e8e\u4e1a\u52a1\u7684\u5feb\u901f\u8fed\u4ee3\uff0c\u5728\u5404\u4e2a\u670d\u52a1\u96c6\u6210\u7684\u8fc7\u7a0b\u4e2d\uff0c\u6d88\u606f\u7684\u6570\u636e\u7ed3\u6784\u5e76\u4e0d\u662f\u56fa\u5b9a\u4e0d\u53d8\u7684\uff0c\u6709\u4e9b\u65f6\u5019\u6211\u4eec\u4e3a\u4e86\u9002\u5e94\u65b0\u5f15\u5165\u7684\u9700\u6c42\uff0c\u4f1a\u6dfb\u52a0\u6216\u8005\u4fee\u6539\u4e00\u4e9b\u6570\u636e\u7ed3\u6784\u3002\u5982\u679c\u4f60\u662f\u4e00\u5957\u5168\u65b0\u7684\u7cfb\u7edf\u8fd9\u6ca1\u6709\u4ec0\u4e48\u95ee\u9898\uff0c\u4f46\u662f\u5982\u679c\u4f60\u7684\u7cfb\u7edf\u5df2\u7ecf\u90e8\u7f72\u5230\u751f\u4ea7\u73af\u5883\u4e86\u5e76\u4e14\u6b63\u5728\u670d\u52a1\u5ba2\u6237\uff0c\u8fd9\u5c31\u4f1a\u5bfc\u81f4\u65b0\u7684\u529f\u80fd\u5728\u4e0a\u7ebf\u7684\u65f6\u5019\u548c\u65e7\u7684\u6570\u636e\u7ed3\u6784\u53d1\u751f\u4e0d\u517c\u5bb9\uff0c\u90a3\u4e48\u8fd9\u4e9b\u6539\u53d8\u53ef\u80fd\u4f1a\u5bfc\u81f4\u51fa\u73b0\u4e25\u91cd\u7684\u95ee\u9898\uff0c\u8981\u60f3\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u53ea\u80fd\u628a\u6d88\u606f\u961f\u5217\u548c\u6301\u4e45\u5316\u7684\u6d88\u606f\u5168\u90e8\u6e05\u7a7a\uff0c\u7136\u540e\u624d\u80fd\u542f\u52a8\u5e94\u7528\u7a0b\u5e8f\uff0c\u8fd9\u5bf9\u4e8e\u751f\u4ea7\u73af\u5883\u6765\u8bf4\u663e\u7136\u662f\u81f4\u547d\u7684\u3002</p> <p>\u591a\u4e2a\u7248\u672c\u7684\u670d\u52a1\u7aef</p> <p>\u6709\u4e9b\u65f6\u5019\uff0cApp\u7684\u670d\u52a1\u7aef\u9700\u8981\u63d0\u4f9b\u591a\u5957\u63a5\u53e3\uff0c\u6765\u652f\u6301\u4e0d\u540c\u7248\u672c\u7684App\uff0c\u8fd9\u4e9b\u4e0d\u540c\u7248\u672c\u7684App\u76f8\u540c\u7684\u63a5\u53e3\u548c\u670d\u52a1\u7aef\u4ea4\u4e92\u7684\u6570\u636e\u7ed3\u6784\u53ef\u80fd\u662f\u4e0d\u4e00\u6837\u7684\uff0c\u6240\u4ee5\u901a\u5e38\u60c5\u51b5\u4e0b\u670d\u52a1\u7aef\u63d0\u4f9b\u4e0d\u7528\u7684\u8def\u7531\u5730\u5740\u6765\u9002\u914d\u4e0d\u540c\u7248\u672c\u7684App\u8c03\u7528\u3002</p> <p>\u4e0d\u540c\u5b9e\u4f8b\uff0c\u4f7f\u7528\u76f8\u540c\u7684\u6301\u4e45\u5316\u8868/\u96c6\u5408</p> <p>\u5e0c\u671b\u591a\u4e2a\u4e0d\u540c\u5b9e\u4f8b\u7684\u7a0b\u5e8f\u53ef\u4ee5\u516c\u7528\u76f8\u540c\u7684\u6570\u636e\u5e93\uff0c\u5728 2.4 \u4e4b\u524d\u7684\u7248\u672c\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u6307\u5b9a\u4e0d\u540c\u7684\u8868\u540d\u6765\u9694\u79bb\u4e0d\u540c\u5b9e\u4f8b\u7684\u6570\u636e\u5e93\u8868\uff0c\u5373\u5728CAP\u914d\u7f6e\u7684\u65f6\u5019\u901a\u8fc7\u914d\u7f6e\u4e0d\u540c\u7684\u8868\u540d\u524d\u7f00\u6765\u5b9e\u73b0\u3002</p> <p>\u67e5\u770b\u535a\u5ba2\u6765\u4e86\u89e3\u66f4\u591a\u5173\u4e8e Version \u7684\u4fe1\u606f\uff1a https://www.cnblogs.com/savorboard/p/cap-2-4.html</p>"},{"location":"user-guide/zh/cap/configuration/#failedretryinterval","title":"FailedRetryInterval","text":"<p>\u9ed8\u8ba4\u503c\uff1a60 \u79d2</p> <p>\u5728\u6d88\u606f\u53d1\u9001\u7684\u65f6\u5019\uff0c\u5982\u679c\u53d1\u9001\u5931\u8d25\uff0cCAP\u5c06\u4f1a\u5bf9\u6d88\u606f\u8fdb\u884c\u91cd\u8bd5\uff0c\u6b64\u914d\u7f6e\u9879\u7528\u6765\u914d\u7f6e\u6bcf\u6b21\u91cd\u8bd5\u7684\u95f4\u9694\u65f6\u95f4\u3002</p> <p>\u5728\u6d88\u606f\u6d88\u8d39\u7684\u8fc7\u7a0b\u4e2d\uff0c\u5982\u679c\u6d88\u8d39\u5931\u8d25\uff0cCAP\u5c06\u4f1a\u5bf9\u6d88\u606f\u8fdb\u884c\u91cd\u8bd5\u6d88\u8d39\uff0c\u6b64\u914d\u7f6e\u9879\u7528\u6765\u914d\u7f6e\u6bcf\u6b21\u91cd\u8bd5\u7684\u95f4\u9694\u65f6\u95f4\u3002</p> <p>\u91cd\u8bd5 &amp; \u95f4\u9694</p> <p>\u5728\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u91cd\u8bd5\u5c06\u5728\u53d1\u9001\u548c\u6d88\u8d39\u6d88\u606f\u5931\u8d25\u7684 4\u5206\u949f\u540e \u5f00\u59cb\uff0c\u8fd9\u662f\u4e3a\u4e86\u907f\u514d\u8bbe\u7f6e\u6d88\u606f\u72b6\u6001\u5ef6\u8fdf\u5bfc\u81f4\u53ef\u80fd\u51fa\u73b0\u7684\u95ee\u9898\u3002 \u53d1\u9001\u548c\u6d88\u8d39\u6d88\u606f\u7684\u8fc7\u7a0b\u4e2d\u5931\u8d25\u4f1a\u7acb\u5373\u91cd\u8bd5 3 \u6b21\uff0c\u5728 3 \u6b21\u4ee5\u540e\u5c06\u8fdb\u5165\u91cd\u8bd5\u8f6e\u8be2\uff0c\u6b64\u65f6 FailedRetryInterval \u914d\u7f6e\u624d\u4f1a\u751f\u6548\u3002</p> <p>\u591a\u5b9e\u4f8b\u5e76\u53d1\u91cd\u8bd5</p> <p>\u6211\u4eec\u57287.1.0\u7248\u672c\u4e2d\u5f15\u5165\u4e86\u57fa\u4e8e\u6570\u636e\u5e93\u7684\u5206\u5e03\u5f0f\u9501\u4ee5\u5e94\u5bf9\u5728\u591a\u4e2a\u5b9e\u4f8b\u4e0b\u5bf9\u6570\u636e\u5e93\u91cd\u8bd5\u7684\u5e76\u53d1\u6570\u636e\u83b7\u53d6\u95ee\u9898\uff0c\u4f60\u9700\u8981\u663e\u5f0f\u914d\u7f6e <code>UseStorageLock</code> \u4e3a true\u3002</p>"},{"location":"user-guide/zh/cap/configuration/#usestoragelock","title":"UseStorageLock","text":"<p>\u9ed8\u8ba4\u503c: false</p> <p>\u5982\u679c\u8bbe\u7f6e\u4e3atrue\uff0c\u6211\u4eec\u5c06\u4f7f\u7528\u57fa\u4e8e\u6570\u636e\u5e93\u7684\u5206\u5e03\u5f0f\u9501\u4ee5\u5e94\u5bf9\u91cd\u8bd5\u8fdb\u7a0b\u5728\u591a\u4e2a\u5b9e\u4f8b\u4e0b\u5bf9\u6570\u636e\u5e93\u6570\u636e\u7684\u5e76\u53d1\u83b7\u53d6\u95ee\u9898\u3002\u8fd9\u5c06\u4f1a\u5728\u6570\u636e\u5e93\u751f\u6210 cap.lock \u8868\u3002</p>"},{"location":"user-guide/zh/cap/configuration/#consumerthreadcount","title":"ConsumerThreadCount","text":"<p>\u9ed8\u8ba4\u503c\uff1a1</p> <p>\u6d88\u8d39\u8005\u7ebf\u7a0b\u5e76\u884c\u5904\u7406\u6d88\u606f\u7684\u7ebf\u7a0b\u6570\uff0c\u5f53\u8fd9\u4e2a\u503c\u5927\u4e8e1\u65f6\uff0c\u5c06\u4e0d\u80fd\u4fdd\u8bc1\u6d88\u606f\u6267\u884c\u7684\u987a\u5e8f\u3002</p>"},{"location":"user-guide/zh/cap/configuration/#collectorcleaninginterval","title":"CollectorCleaningInterval","text":"<p>\u9ed8\u8ba4\u503c\uff1a300 \u79d2</p> <p>\u6536\u96c6\u5668\u5220\u9664\u5df2\u7ecf\u8fc7\u671f\u6d88\u606f\u7684\u65f6\u95f4\u95f4\u9694\u3002</p>"},{"location":"user-guide/zh/cap/configuration/#failedretrycount","title":"FailedRetryCount","text":"<p>\u9ed8\u8ba4\u503c\uff1a50</p> <p>\u91cd\u8bd5\u7684\u6700\u5927\u6b21\u6570\u3002\u5f53\u8fbe\u5230\u6b64\u8bbe\u7f6e\u503c\u65f6\uff0c\u5c06\u4e0d\u4f1a\u518d\u7ee7\u7eed\u91cd\u8bd5\uff0c\u901a\u8fc7\u6539\u53d8\u6b64\u53c2\u6570\u6765\u8bbe\u7f6e\u91cd\u8bd5\u7684\u6700\u5927\u6b21\u6570\u3002</p>"},{"location":"user-guide/zh/cap/configuration/#failedthresholdcallback","title":"FailedThresholdCallback","text":"<p>\u9ed8\u8ba4\u503c\uff1aNULL</p> <p>\u7c7b\u578b\uff1a<code>Action&lt;FailedInfo&gt;</code></p> <p>\u91cd\u8bd5\u9608\u503c\u7684\u5931\u8d25\u56de\u8c03\u3002\u5f53\u91cd\u8bd5\u8fbe\u5230 FailedRetryCount \u8bbe\u7f6e\u7684\u503c\u7684\u65f6\u5019\uff0c\u5c06\u8c03\u7528\u6b64 Action \u56de\u8c03\uff0c\u4f60\u53ef\u4ee5\u901a\u8fc7\u6307\u5b9a\u6b64\u56de\u8c03\u6765\u63a5\u6536\u5931\u8d25\u8fbe\u5230\u6700\u5927\u7684\u901a\u77e5\uff0c\u4ee5\u505a\u51fa\u4eba\u5de5\u4ecb\u5165\u3002\u4f8b\u5982\u53d1\u9001\u90ae\u4ef6\u6216\u8005\u77ed\u4fe1\u3002</p>"},{"location":"user-guide/zh/cap/configuration/#succeedmessageexpiredafter","title":"SucceedMessageExpiredAfter","text":"<p>\u9ed8\u8ba4\u503c\uff1a24*3600 \u79d2\uff081\u5929\u540e\uff09</p> <p>\u6210\u529f\u6d88\u606f\u7684\u8fc7\u671f\u65f6\u95f4\uff08\u79d2\uff09\u3002 \u5f53\u6d88\u606f\u53d1\u9001\u6216\u8005\u6d88\u8d39\u6210\u529f\u65f6\u5019\uff0c\u5728\u65f6\u95f4\u8fbe\u5230 <code>SucceedMessageExpiredAfter</code> \u79d2\u65f6\u5019\u5c06\u4f1a\u4ece Persistent \u4e2d\u5220\u9664\uff0c\u4f60\u53ef\u4ee5\u901a\u8fc7\u6307\u5b9a\u6b64\u503c\u6765\u8bbe\u7f6e\u8fc7\u671f\u7684\u65f6\u95f4\u3002</p>"},{"location":"user-guide/zh/cap/configuration/#failedmessageexpiredafter","title":"FailedMessageExpiredAfter","text":"<p>\u9ed8\u8ba4\u503c\uff1a15*24*3600 \u79d2\uff0815\u5929\u540e\uff09</p> <p>\u5931\u8d25\u6d88\u606f\u7684\u8fc7\u671f\u65f6\u95f4\uff08\u79d2\uff09\u3002 \u5f53\u6d88\u606f\u53d1\u9001\u6216\u8005\u6d88\u8d39\u5931\u8d25\u65f6\u5019\uff0c\u5728\u65f6\u95f4\u8fbe\u5230 <code>FailedMessageExpiredAfter</code> \u79d2\u65f6\u5019\u5c06\u4f1a\u4ece Persistent \u4e2d\u5220\u9664\uff0c\u4f60\u53ef\u4ee5\u901a\u8fc7\u6307\u5b9a\u6b64\u503c\u6765\u8bbe\u7f6e\u8fc7\u671f\u7684\u65f6\u95f4\u3002</p>"},{"location":"user-guide/zh/cap/configuration/#usedispatchingpergroup","title":"UseDispatchingPerGroup","text":"<p>\u9ed8\u8ba4\u503c: false</p> <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cCAP\u4f1a\u5c06\u6240\u6709\u6d88\u8d39\u8005\u7ec4\u7684\u6d88\u606f\u90fd\u5148\u653e\u7f6e\u5230\u5185\u5b58\u540c\u4e00\u4e2aChannel\u4e2d\uff0c\u7136\u540e\u7ebf\u6027\u5904\u7406\u3002 \u5982\u679c\u8bbe\u7f6e\u4e3a true\uff0c\u5219\u6bcf\u4e2a\u6d88\u8d39\u8005\u7ec4\u90fd\u4f1a\u6839\u636e <code>ConsumerThreadCount</code> \u8bbe\u7f6e\u7684\u503c\u521b\u5efa\u5355\u72ec\u7684\u7ebf\u7a0b\u8fdb\u884c\u5904\u7406\u3002</p> <p>\u5982\u679c\u6b64\u8bbe\u7f6e\u9879\u76ee\u4e3a true\uff0c\u5219 EnableConsumerPrefetch \u8bbe\u7f6e\u9879\u65e0\u6548</p>"},{"location":"user-guide/zh/cap/configuration/#enableconsumerprefetch","title":"EnableConsumerPrefetch","text":"<p>\u9ed8\u8ba4\u503c: false\uff0c \u5728 7.0 \u7248\u672c\u4e4b\u524d\u9ed8\u8ba4\u884c\u4e3a true</p> <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cCAP\u53ea\u4f1a\u4ece\u6d88\u606f\u961f\u5217\u8bfb\u53d6\u4e00\u6761\uff0c\u7136\u540e\u6267\u884c\u8ba2\u9605\u65b9\u6cd5\uff0c\u6267\u884c\u5b8c\u6210\u540e\u624d\u4f1a\u8bfb\u53d6\u4e0b\u4e00\u6761\u6765\u6267\u884c. \u5982\u679c\u8bbe\u7f6e\u4e3a true, \u6d88\u8d39\u7aef\u4f1a\u9884\u53d6\u4e00\u90e8\u5206\u6d88\u606f\u5230\u5185\u5b58\u961f\u5217\uff0c\u7136\u540e\u518d\u5206\u53d1\u7ed9\u8c03\u5ea6\u5668\u6267\u884c\u3002</p> <p>\u6ce8\u610f\u4e8b\u9879</p> <p>\u8bbe\u7f6e\u4e3a true \u53ef\u80fd\u4f1a\u4ea7\u751f\u4e00\u4e9b\u95ee\u9898\uff0c\u5f53\u8ba2\u9605\u65b9\u6cd5\u6267\u884c\u8fc7\u6162\u8017\u65f6\u592a\u4e45\u65f6\uff0c\u4f1a\u5bfc\u81f4\u91cd\u8bd5\u7ebf\u7a0b\u62fe\u53d6\u5230\u8fd8\u672a\u6267\u884c\u7684\u7684\u6d88\u606f\u3002\u91cd\u8bd5\u7ebf\u7a0b\u9ed8\u8ba4\u62fe\u53d64\u5206\u949f\u524d\u7684\u6d88\u606f\uff0c\u4e5f\u5c31\u662f\u8bf4\u5982\u679c\u6d88\u8d39\u7aef\u79ef\u538b\u4e86\u8d85\u8fc74\u5206\u949f\u7684\u6d88\u606f\u5c31\u4f1a\u88ab\u91cd\u65b0\u62fe\u53d6\u5230\u518d\u6b21\u6267\u884c</p>"},{"location":"user-guide/zh/cap/filter/","title":"\u8fc7\u6ee4\u5668","text":"<p>\u5728 5.1.0 \u7248\u672c\u4e2d\uff0c\u6211\u4eec\u652f\u6301\u4e86\u5728\u8ba2\u9605\u8005\u4e2d\u6dfb\u52a0\u8fc7\u6ee4\u5668\u3002\u5728\u8fc7\u53bb\uff0c\u6211\u4eec\u901a\u8fc7\u5bf9\u7b2c\u4e09\u65b9 AOP \u7ec4\u4ef6\u63d0\u4f9b\u652f\u6301\u6765\u505a\u5230\u8fd9\u4e00\u70b9\uff0c\u4f8b\u5982\u6211\u4eec\u5199\u4e86\u4e00\u7bc7\u535a\u5ba2 \u6765\u63cf\u8ff0\u5982\u4f55\u5728 CAP 5.0 \u7248\u672c\u4e2d\u4f7f\u7528 Castle \u6765\u5bf9\u8ba2\u9605\u65b9\u6cd5\u8fdb\u884c\u62e6\u622a\uff0c\u4f46\u4e86\u8fd9\u79cd\u65b9\u5f0f\u5b58\u5728\u4e00\u4e9b\u7f3a\u70b9\uff0c\u4f8b\u5982\u65e0\u6cd5\u65b9\u4fbf\u7684\u5728\u4ee3\u7406\u7c7b\u4e2d\u8fdb\u884c\u6784\u9020\u51fd\u6570\u6ce8\u5165\u4ee5\u53ca\u65b9\u6cd5\u9700\u8981\u8bbe\u5b9a\u4e3a virtual \u53e6\u5916\u8fd8\u6709\u62e6\u622a\u5668\u751f\u547d\u5468\u671f\u63a7\u5236\u7b49\u95ee\u9898\u3002</p> <p>\u6240\u4ee5\u6211\u4eec\u5f15\u5165\u4e86\u5bf9\u8ba2\u9605\u8005\u8fc7\u6ee4\u5668\u7684\u652f\u6301\uff0c\u4ee5\u4f7f\u5728\u67d0\u4e9b\u573a\u666f\uff08\u5982\u4e8b\u52a1\u5904\u7406\uff0c\u65e5\u5fd7\u8bb0\u5f55\u7b49\uff09\u4e2d\u53d8\u5f97\u5bb9\u6613\u3002</p>"},{"location":"user-guide/zh/cap/filter/#_2","title":"\u81ea\u5b9a\u4e49\u8fc7\u6ee4\u5668","text":""},{"location":"user-guide/zh/cap/filter/#_3","title":"\u6dfb\u52a0\u8fc7\u6ee4\u5668","text":"<p>\u521b\u5efa\u4e00\u4e2a\u8fc7\u6ee4\u5668\u7c7b\uff0c\u5e76\u7ee7\u627f <code>SubscribeFilter</code> \u62bd\u8c61\u7c7b\u3002</p> <pre><code>public class MyCapFilter: SubscribeFilter\n{\npublic override Task OnSubscribeExecutingAsync(ExecutingContext context)\n{\n// \u8ba2\u9605\u65b9\u6cd5\u6267\u884c\u524d\n}\n\npublic override Task OnSubscribeExecutedAsync(ExecutedContext context)\n{\n// \u8ba2\u9605\u65b9\u6cd5\u6267\u884c\u540e\n}\n\npublic override Task OnSubscribeExceptionAsync(ExceptionContext context)\n{\n// \u8ba2\u9605\u65b9\u6cd5\u6267\u884c\u5f02\u5e38\n}\n}\n</code></pre> <p>\u5728\u4e00\u4e9b\u573a\u666f\u4e2d\uff0c\u5982\u679c\u60f3\u7ec8\u6b62\u8ba2\u9605\u8005\u65b9\u6cd5\u6267\u884c\uff0c\u53ef\u4ee5\u5728 <code>OnSubscribeExecutingAsync</code> \u4e2d\u629b\u51fa\u5f02\u5e38\uff0c\u5e76\u4e14\u5728 <code>OnSubscribeExceptionAsync</code> \u4e2d\u9009\u62e9\u5ffd\u7565\u8be5\u5f02\u5e38\u3002</p> <p>\u901a\u8fc7\u5728 <code>ExceptionContext</code> \u4e2d\u8bbe\u7f6e <code>context.ExceptionHandled = true</code> \u6765\u5ffd\u7565\u5f02\u5e38\u3002</p> <pre><code>public override Task OnSubscribeExceptionAsync(ExceptionContext context)\n{\ncontext.ExceptionHandled = true;\n}\n</code></pre>"},{"location":"user-guide/zh/cap/filter/#_4","title":"\u914d\u7f6e\u8fc7\u6ee4\u5668","text":"<pre><code>services.AddCap(opt =&gt;\n{\n// ***\n}.AddSubscribeFilter&lt;MyCapFilter&gt;();\n</code></pre> <p>\u76ee\u524d\uff0c \u6211\u4eec\u8fd8\u4e0d\u652f\u6301\u540c\u65f6\u6dfb\u52a0\u591a\u4e2a\u8fc7\u6ee4\u5668\u3002</p>"},{"location":"user-guide/zh/cap/idempotence/","title":"\u5e42\u7b49\u6027","text":"<p>\u5e42\u7b49\u6027\uff08\u4f60\u53ef\u4ee5\u5728Wikipedia\u8bfb\u5230\u5173\u4e8e\u5e42\u7b49\u6027\u7684\u5b9a\u4e49\uff09\uff0c\u5f53\u6211\u4eec\u8c08\u8bba\u5e42\u7b49\u65f6\uff0c\u4e00\u822c\u662f\u6307\u53ef\u4ee5\u91cd\u590d\u5904\u7406\u4f20\u9012\u7684\u6d88\u606f\uff0c\u800c\u4e0d\u4f1a\u4ea7\u751f\u610f\u5916\u7684\u7ed3\u679c\u3002</p>"},{"location":"user-guide/zh/cap/idempotence/#_2","title":"\u4ea4\u4ed8\u4fdd\u8bc1","text":"<p>\u5728\u8bf4\u5e42\u7b49\u6027\u4e4b\u524d\uff0c\u6211\u4eec\u5148\u6765\u8bf4\u4e0b\u5173\u4e8e\u6d88\u8d39\u7aef\u7684\u6d88\u606f\u4ea4\u4ed8\u3002</p> <p>\u7531\u4e8eCAP\u4e0d\u662f\u4f7f\u7528\u7684 MS DTC \u6216\u5176\u4ed6\u7c7b\u578b\u76842PC\u5206\u5e03\u5f0f\u4e8b\u52a1\u673a\u5236\uff0c\u6240\u4ee5\u5b58\u5728\u81f3\u5c11\u6d88\u606f\u4e25\u683c\u4ea4\u4ed8\u4e00\u6b21\u7684\u95ee\u9898\uff0c\u5177\u4f53\u7684\u8bf4\u5728\u57fa\u4e8e\u6d88\u606f\u7684\u7cfb\u7edf\u4e2d\uff0c\u5b58\u5728\u4ee5\u4e0b\u4e09\u79cd\u53ef\u80fd\uff1a</p> <ul> <li>Exactly Once(*) \uff08\u4ec5\u6709\u4e00\u6b21\uff09</li> <li>At Most Once \uff08\u6700\u591a\u4e00\u6b21\uff09</li> <li>At Least Once \uff08\u6700\u5c11\u4e00\u6b21\uff09</li> </ul> <p>\u5e26 * \u53f7\u8868\u793a\u5728\u5b9e\u9645\u573a\u666f\u4e2d\uff0c\u5f88\u96be\u8fbe\u5230\u3002</p>"},{"location":"user-guide/zh/cap/idempotence/#at-most-once","title":"At Most Once","text":"<p>\u6700\u591a\u4e00\u6b21\u4ea4\u4ed8\u4fdd\u8bc1\uff0c\u6db5\u76d6\u4e86\u4fdd\u8bc1\u4e00\u6b21\u6216\u6839\u672c\u4e0d\u63a5\u6536\u6240\u6709\u6d88\u606f\u7684\u60c5\u51b5\u3002</p> <p>\u8fd9\u79cd\u7c7b\u578b\u7684\u4f20\u9012\u4fdd\u8bc1\u53ef\u80fd\u6765\u81ea\u4f60\u7684\u6d88\u606f\u7cfb\u7edf\uff0c\u4f60\u7684\u4ee3\u7801\u6309\u4ee5\u4e0b\u987a\u5e8f\u6267\u884c\u5176\u64cd\u4f5c\uff1a</p> <pre><code>1. \u4ece\u961f\u5217\u79fb\u9664\u6d88\u606f\n2. \u5f00\u59cb\u4e00\u4e2a\u5de5\u4f5c\u4e8b\u52a1\n3. \u5904\u7406\u6d88\u606f ( \u4f60\u7684\u4ee3\u7801 )\n4. \u662f\u5426\u6210\u529f ?\n    Yes:\n        1. \u63d0\u4ea4\u5de5\u4f5c\u4e8b\u52a1\n    No: \n        1. \u56de\u6eda\u5de5\u4f5c\u4e8b\u52a1\n        2. \u5c06\u6d88\u606f\u53d1\u56de\u5230\u961f\u5217\u3002\n</code></pre> <p>\u6b63\u5e38\u60c5\u51b5\u4e0b\uff0c\u4ed6\u4eec\u5de5\u4f5c\u7684\u5f88\u597d\uff0c\u5de5\u4f5c\u4e8b\u52a1\u5c06\u88ab\u63d0\u4ea4\u3002</p> <p>\u7136\u800c\uff0c\u6709\u4e9b\u65f6\u5019\u5e76\u4e0d\u80fd\u603b\u662f\u6210\u529f\uff0c\u6bd4\u5982\u5728 1 \u4e4b\u540e\u51fa\u73b0\u5f02\u5e38\uff0c\u6216\u8005\u662f\u4f60\u5728\u5c06\u6d88\u606f\u653e\u56de\u5230\u961f\u5217\u4e2d\u51fa\u73b0\u7f51\u7edc\u95ee\u9898\u7531\u6216\u8005\u5b95\u673a\u91cd\u542f\u7b49\u60c5\u51b5\u3002</p> <p>\u4f7f\u7528\u8fd9\u4e2a\u534f\u8bae\uff0c\u4f60\u5c06\u5192\u7740\u4e22\u5931\u6d88\u606f\u7684\u98ce\u9669\uff0c\u5982\u679c\u53ef\u4ee5\u63a5\u53d7\uff0c\u90a3\u5c31\u6ca1\u6709\u5173\u7cfb\u3002</p>"},{"location":"user-guide/zh/cap/idempotence/#at-least-once","title":"At Least Once","text":"<p>\u8fd9\u4e2a\u4ea4\u4ed8\u4fdd\u8bc1\u5305\u542b\u4f60\u6536\u5230\u81f3\u5c11\u4e00\u6b21\u7684\u6d88\u606f\uff0c\u5f53\u51fa\u73b0\u6545\u969c\u65f6\uff0c\u53ef\u80fd\u4f1a\u6536\u5230\u591a\u6b21\u6d88\u606f\u3002</p> <p>\u5b83\u9700\u8981\u7a0d\u5fae\u6539\u53d8\u6211\u4eec\u6267\u884c\u6b65\u9aa4\u7684\u987a\u5e8f\uff0c\u5b83\u8981\u6c42\u6d88\u606f\u961f\u5217\u7cfb\u7edf\u652f\u6301\u4e8b\u52a1\u6216ACK\u673a\u5236\uff0c\u6bd4\u5982\u4f20\u7edf\u7684 begin-commit-rollback \u534f\u8bae\uff08MSMQ\u662f\u8fd9\u6837\uff09\uff0c\u6216\u8005\u662f receive-ack-nack \u534f\u8bae\uff08RabbitMQ\uff0cAzure Service Bus\u7b49\u662f\u8fd9\u6837\u7684\uff09\u3002</p> <p>\u5927\u81f4\u6b65\u9aa4\u5982\u4e0b:</p> <pre><code>1. \u62a2\u5360\u961f\u5217\u4e2d\u7684\u6d88\u606f\u3002\n2. \u5f00\u59cb\u4e00\u4e2a\u5de5\u4f5c\u4e8b\u52a1\n3. \u5904\u7406\u6d88\u606f ( \u4f60\u7684\u4ee3\u7801 )\n4. \u662f\u5426\u6210\u529f ?\n    Yes: \n        1. \u63d0\u4ea4\u5de5\u4f5c\u4e8b\u52a1\n        2. \u4ece\u961f\u5217\u5220\u9664\u6d88\u606f\n    No: \n        1. \u56de\u6eda\u5de5\u4f5c\u4e8b\u52a1\n        2. \u4ece\u961f\u5217\u91ca\u653e\u62a2\u5360\u7684\u6d88\u606f\n</code></pre> <p>\u5f53\u51fa\u73b0\u5931\u8d25\u6216\u8005\u62a2\u5360\u6d88\u606f\u8d85\u65f6\u7684\u65f6\u5019\uff0c\u6211\u4eec\u603b\u662f\u80fd\u591f\u518d\u6b21\u63a5\u6536\u5230\u6d88\u606f\u4ee5\u4fdd\u8bc1\u6211\u4eec\u5de5\u4f5c\u4e8b\u52a1\u63d0\u4ea4\u6210\u529f\u3002</p>"},{"location":"user-guide/zh/cap/idempotence/#_3","title":"\u4ec0\u4e48\u662f \u201c\u5de5\u4f5c\u4e8b\u52a1\u201d ?","text":"<p>\u4e0a\u9762\u6240\u8bf4\u7684\u201c\u5de5\u4f5c\u4e8b\u52a1\u201d\u5e76\u4e0d\u662f\u7279\u6307\u5173\u7cfb\u578b\u6570\u636e\u5e93\u4e2d\u7684\u4e8b\u52a1\uff0c\u8fd9\u91cc\u7684\u5de5\u4f5c\u4e8b\u52a1\u662f\u4e00\u4e2a\u6982\u5ff5\uff0c\u4e5f\u5c31\u662f\u8bf4\u6267\u884c\u4ee3\u7801\u7684\u539f\u5b50\u6027\u3002</p> <p>\u6bd4\u5982\u5b83\u53ef\u4ee5\u662f\u4f20\u7edf\u7684RDMS\u4e8b\u52a1\uff0c\u4e5f\u6216\u8005\u662f MongoDB \u4e8b\u52a1\u6216\u8005\u662f\u4e00\u4e2a\u4ea4\u6613\u7b49\u3002</p> <p>\u5728\u8fd9\u91cc\u5b83\u4ee3\u8868\u4e00\u4e2a\u6267\u884c\u5355\u5143\uff0c\u8fd9\u4e2a\u6267\u884c\u5355\u5143\u662f\u4e00\u4e2a\u6982\u5ff5\u6027\u7684\u4e8b\u5b9e\u4ee5\u652f\u6301\u524d\u9762\u63d0\u5230\u7684\u4ec5\u4ea4\u4ed8\u4e00\u6b21\u7684\u8fd9\u79cd\u95ee\u9898\u3002</p> <p>\u901a\u5e38\uff0c\u4e0d\u53ef\u80fd\u505a\u5230\u6d88\u606f\u7684\u4e8b\u52a1\u548c\u5de5\u4f5c\u4e8b\u52a1\u6765\u5f62\u6210\u539f\u5b50\u6027\u8fdb\u884c\u63d0\u4ea4\u6216\u8005\u56de\u6eda\u3002</p>"},{"location":"user-guide/zh/cap/idempotence/#cap","title":"CAP \u4e2d\u7684\u5e42\u7b49\u6027","text":"<p>\u5728CAP\u4e2d\uff0c\u6211\u4eec\u91c7\u7528\u7684\u4ea4\u4ed8\u4fdd\u8bc1\u4e3a At Least Once\u3002</p> <p>\u7531\u4e8e\u6211\u4eec\u5177\u6709\u4e34\u65f6\u5b58\u50a8\u4ecb\u8d28\uff08\u6570\u636e\u5e93\u8868\uff09\uff0c\u4e5f\u8bb8\u53ef\u4ee5\u505a\u5230 At Most Once, \u4f46\u662f\u4e3a\u4e86\u4e25\u683c\u4fdd\u8bc1\u6d88\u606f\u4e0d\u4f1a\u4e22\u5931\uff0c\u6211\u4eec\u6ca1\u6709\u63d0\u4f9b\u76f8\u5173\u529f\u80fd\u6216\u914d\u7f6e\u3002</p>"},{"location":"user-guide/zh/cap/idempotence/#_4","title":"\u4e3a\u4ec0\u4e48\u6ca1\u6709\u5b9e\u73b0\u5e42\u7b49\uff1f","text":"<p>1\u3001\u6d88\u606f\u5199\u5165\u6210\u529f\u4e86\uff0c\u4f46\u662f\u6b64\u65f6\u6267\u884cConsumer\u65b9\u6cd5\u5931\u8d25\u4e86</p> <p>\u6267\u884cConsumer\u65b9\u6cd5\u5931\u8d25\u7684\u539f\u56e0\u6709\u975e\u5e38\u591a\uff0c\u6211\u5982\u679c\u4e0d\u77e5\u9053\u5177\u4f53\u7684\u573a\u666f\u76f2\u76ee\u8fdb\u884c\u91cd\u8bd5\u6216\u8005\u4e0d\u8fdb\u884c\u91cd\u8bd5\u90fd\u662f\u4e0d\u6b63\u786e\u7684\u9009\u62e9\u3002 \u4e3e\u4e2a\u4f8b\u5b50\uff1a\u5047\u5982\u6d88\u8d39\u8005\u4e3a\u6263\u6b3e\u670d\u52a1\uff0c\u5982\u679c\u662f\u6267\u884c\u6263\u6b3e\u6210\u529f\u4e86\uff0c\u4f46\u662f\u5728\u5199\u6263\u6b3e\u65e5\u5fd7\u7684\u65f6\u5019\u5931\u8d25\u4e86\uff0c\u6b64\u65f6CAP\u4f1a\u5224\u65ad\u4e3a\u6d88\u8d39\u8005\u6267\u884c\u5931\u8d25\uff0c\u8fdb\u884c\u91cd\u8bd5\u3002\u5982\u679c\u5ba2\u6237\u7aef\u81ea\u5df1\u6ca1\u6709\u4fdd\u8bc1\u5e42\u7b49\u6027\uff0c\u6846\u67b6\u5bf9\u5176\u8fdb\u884c\u91cd\u8bd5\uff0c\u8fd9\u91cc\u52bf\u5fc5\u4f1a\u9020\u6210\u591a\u6b21\u6263\u6b3e\u51fa\u73b0\u4e25\u91cd\u540e\u679c\u3002</p> <p>2\u3001\u6267\u884cConsumer\u65b9\u6cd5\u6210\u529f\u4e86\uff0c\u4f46\u662f\u53c8\u6536\u5230\u4e86\u540c\u6837\u7684\u6d88\u606f</p> <p>\u6b64\u5904\u573a\u666f\u4e5f\u662f\u53ef\u80fd\u5b58\u5728\u7684\uff0c\u5047\u5982\u5f00\u59cb\u7684\u65f6\u5019Consumer\u5df2\u7ecf\u6267\u884c\u6210\u529f\u4e86\uff0c\u4f46\u662f\u7531\u4e8e\u67d0\u79cd\u539f\u56e0\u5982 Broker \u5b95\u673a\u6062\u590d\u7b49\uff0c\u53c8\u6536\u5230\u4e86\u76f8\u540c\u7684\u6d88\u606f\uff0cCAP \u5728\u6536\u5230Broker\u6d88\u606f\u540e\u4f1a\u8ba4\u4e3a\u8fd9\u4e2a\u662f\u4e00\u4e2a\u65b0\u7684\u6d88\u606f\uff0c\u4f1a\u5bf9 Consumer\u518d\u6b21\u6267\u884c\uff0c\u7531\u4e8e\u662f\u65b0\u6d88\u606f\uff0c\u6b64\u65f6 CAP \u4e5f\u662f\u65e0\u6cd5\u505a\u5230\u5e42\u7b49\u7684\u3002</p> <p>3\u3001\u76ee\u524d\u7684\u6570\u636e\u5b58\u50a8\u6a21\u5f0f\u65e0\u6cd5\u505a\u5230\u5e42\u7b49</p> <p>\u7531\u4e8eCAP\u5b58\u6d88\u606f\u7684\u8868\u5bf9\u4e8e\u6210\u529f\u6d88\u8d39\u7684\u6d88\u606f\u4f1a\u4e8e1\u4e2a\u5c0f\u65f6\u540e\u5220\u9664\uff0c\u6240\u4ee5\u5982\u679c\u5bf9\u4e8e\u4e00\u4e9b\u5386\u53f2\u6027\u6d88\u606f\u65e0\u6cd5\u505a\u5230\u5e42\u7b49\u64cd\u4f5c\u3002 \u5386\u53f2\u6027\u6307\u7684\u662f\uff0c\u5047\u5982 Broker\u7531\u4e8e\u67d0\u79cd\u539f\u56e0\u7ef4\u62a4\u4e86\u6216\u8005\u662f\u4eba\u5de5\u5904\u7406\u7684\u4e00\u4e9b\u6d88\u606f\u3002</p> <p>4\u3001\u4e1a\u754c\u505a\u6cd5</p> <p>\u8bb8\u591a\u57fa\u4e8e\u4e8b\u4ef6\u9a71\u52a8\u7684\u6846\u67b6\u90fd\u662f\u8981\u6c42 \u7528\u6237 \u6765\u4fdd\u8bc1\u5e42\u7b49\u6027\u64cd\u4f5c\u7684\uff0c\u6bd4\u5982 ENode, RocketMQ \u7b49\u7b49...</p> <p>\u4ece\u5b9e\u73b0\u7684\u89d2\u5ea6\u6765\u8bf4\uff0cCAP\u53ef\u4ee5\u505a\u4e00\u4e9b\u6bd4\u8f83\u4e0d\u4e25\u683c\u7684\u5e42\u7b49\uff0c\u4f46\u662f\u4e25\u683c\u7684\u5e42\u7b49\u65e0\u6cd5\u505a\u5230\u7684\u3002</p>"},{"location":"user-guide/zh/cap/idempotence/#_5","title":"\u4ee5\u81ea\u7136\u7684\u65b9\u5f0f\u5904\u7406\u5e42\u7b49\u6d88\u606f","text":"<p>\u901a\u5e38\u60c5\u51b5\u4e0b\uff0c\u4fdd\u8bc1\u6d88\u606f\u88ab\u6267\u884c\u591a\u6b21\u800c\u4e0d\u4f1a\u4ea7\u751f\u610f\u5916\u7ed3\u679c\u662f\u5f88\u81ea\u7136\u7684\u4e00\u79cd\u65b9\u5f0f\u662f\u91c7\u7528\u64cd\u4f5c\u5bf9\u8c61\u81ea\u5e26\u7684\u4e00\u4e9b\u5e42\u7b49\u529f\u80fd\u3002\u6bd4\u5982\uff1a</p> <p>\u6570\u636e\u5e93\u63d0\u4f9b\u7684 <code>INSERT ON DUPLICATE KEY UPDATE</code> \u6216\u8005\u662f\u91c7\u53d6\u7c7b\u578b\u7684\u7a0b\u5e8f\u5224\u65ad\u884c\u4e3a\u3002</p>"},{"location":"user-guide/zh/cap/idempotence/#_6","title":"\u663e\u5f0f\u5904\u7406\u5e42\u7b49\u6d88\u606f","text":"<p>\u53e6\u5916\u4e00\u79cd\u5904\u7406\u5e42\u7b49\u6027\u7684\u65b9\u5f0f\u5c31\u662f\u5728\u6d88\u606f\u4f20\u9012\u7684\u8fc7\u7a0b\u4e2d\u4f20\u9012ID\uff0c\u7136\u540e\u7531\u5355\u72ec\u7684\u6d88\u606f\u8ddf\u8e2a\u5668\u6765\u5904\u7406\u3002 </p> <p>\u6bd4\u5982\u4f60\u4f7f\u7528\u5177\u6709\u4e8b\u52a1\u6570\u636e\u5b58\u50a8\u7684 IMessageTracker \u6765\u8ddf\u8e2a\u6d88\u606fID\uff0c\u4f60\u7684\u4ee3\u7801\u53ef\u80fd\u770b\u8d77\u6765\u50cf\u8fd9\u6837\uff1a</p> <pre><code>readonly IMessageTracker _messageTracker;\n\npublic SomeMessageHandler(IMessageTracker messageTracker)\n{\n_messageTracker = messageTracker;\n}\n\n[CapSubscribe]\npublic async Task Handle(SomeMessage message) {\nif (await _messageTracker.HasProcessed(message.Id))\n{\nreturn;\n}\n\n// do the work here\n// ...\n\n// remember that this message has been processed\nawait _messageTracker.MarkAsProcessed(messageId);\n}\n</code></pre> <p>\u81f3\u4e8e <code>IMessageTracker</code> \u7684\u5b9e\u73b0\uff0c\u53ef\u4ee5\u4f7f\u7528\u8bf8\u5982Redis\u6216\u8005\u6570\u636e\u5e93\u7b49\u5b58\u50a8\u6d88\u606fId\u548c\u5bf9\u5e94\u7684\u5904\u7406\u72b6\u6001\u3002</p>"},{"location":"user-guide/zh/cap/messaging/","title":"\u6d88\u606f","text":"<p>\u4f7f\u7528 <code>ICapPublisher</code> \u63a5\u53e3\u53d1\u9001\u51fa\u53bb\u7684\u6570\u636e\u79f0\u4e4b\u4e3a Message (<code>\u6d88\u606f</code>)\u3002</p>"},{"location":"user-guide/zh/cap/messaging/#_2","title":"\u53d1\u9001 &amp; \u5904\u7406\u6d88\u606f","text":"<p>\u4f60\u53ef\u4ee5\u9605\u8bfb quick-start \u6765\u5b66\u4e60\u5982\u4f55\u53d1\u9001\u548c\u5904\u7406\u6d88\u606f\u3002</p>"},{"location":"user-guide/zh/cap/messaging/#_3","title":"\u8865\u507f\u4e8b\u52a1","text":"<p>Compensating transaction</p> <p>\u67d0\u4e9b\u60c5\u51b5\u4e0b\uff0c\u6d88\u8d39\u8005\u9700\u8981\u8fd4\u56de\u503c\u4ee5\u544a\u8bc9\u53d1\u5e03\u8005\u6267\u884c\u7ed3\u679c\uff0c\u4ee5\u4fbf\u4e8e\u53d1\u5e03\u8005\u5b9e\u65bd\u4e00\u4e9b\u52a8\u4f5c\uff0c\u901a\u5e38\u60c5\u51b5\u4e0b\u8fd9\u5c5e\u4e8e\u8865\u507f\u8303\u56f4\u3002</p> <p>\u4f60\u53ef\u4ee5\u5728\u6d88\u8d39\u8005\u6267\u884c\u7684\u4ee3\u7801\u4e2d\u901a\u8fc7\u91cd\u65b0\u53d1\u5e03\u4e00\u4e2a\u65b0\u6d88\u606f\u6765\u901a\u77e5\u4e0a\u6e38\uff0cCAP \u63d0\u4f9b\u4e86\u4e00\u79cd\u7b80\u5355\u7684\u65b9\u5f0f\u6765\u505a\u5230\u8fd9\u4e00\u70b9\u3002 \u4f60\u53ef\u4ee5\u5728\u53d1\u9001\u7684\u65f6\u5019\u6307\u5b9a <code>callbackName</code> \u6765\u5f97\u5230\u6d88\u8d39\u8005\u7684\u6267\u884c\u7ed3\u679c\uff0c\u901a\u5e38\u8fd9\u4ec5\u9002\u7528\u4e8e\u70b9\u5bf9\u70b9\u7684\u6d88\u8d39\u3002\u4ee5\u4e0b\u662f\u4e00\u4e2a\u793a\u4f8b\u3002</p> <p>\u4f8b\u5982\uff0c\u5728\u4e00\u4e2a\u7535\u5546\u7a0b\u5e8f\u4e2d\uff0c\u8ba2\u5355\u521d\u59cb\u72b6\u6001\u4e3a pending\uff0c\u5f53\u5546\u54c1\u6570\u91cf\u6210\u529f\u6263\u9664\u65f6\u5c06\u72b6\u6001\u6807\u8bb0\u4e3a succeeded \uff0c\u5426\u5219\u4e3a failed\u3002</p> <pre><code>// =============  Publisher =================\n\n_capBus.Publish(\"place.order.qty.deducted\", contentObj: new { OrderId = 1234, ProductId = 23255, Qty = 1 }, callbackName: \"place.order.mark.status\");    // publisher using `callbackName` to subscribe consumer result\n\n[CapSubscribe(\"place.order.mark.status\")]\npublic void MarkOrderStatus(JsonElement param)\n{\nvar orderId = param.GetProperty(\"OrderId\").GetInt32();\nvar isSuccess = param.GetProperty(\"IsSuccess\").GetBoolean();\n\nif(isSuccess){\n// mark order status to succeeded\n}\nelse{\n// mark order status to failed\n}\n}\n\n// =============  Consumer ===================\n\n[CapSubscribe(\"place.order.qty.deducted\")]\npublic object DeductProductQty(JsonElement param)\n{\nvar orderId = param.GetProperty(\"OrderId\").GetInt32();\nvar productId = param.GetProperty(\"ProductId\").GetInt32();\nvar qty = param.GetProperty(\"Qty\").GetInt32();\n\n//business logic \n\nreturn new { OrderId = orderId, IsSuccess = true };\n}\n</code></pre>"},{"location":"user-guide/zh/cap/messaging/#_4","title":"\u5f02\u6784\u7cfb\u7edf\u96c6\u6210","text":"<p>\u5728 3.0+ \u7248\u672c\u4e2d\uff0c\u6211\u4eec\u5bf9\u6d88\u606f\u7ed3\u6784\u8fdb\u884c\u4e86\u91cd\u6784\uff0c\u6211\u4eec\u5229\u7528\u4e86\u6d88\u606f\u961f\u5217\u4e2d\u6d88\u606f\u534f\u8bae\u4e2d\u7684 Header \u6765\u4f20\u8f93\u4e00\u4e9b\u989d\u5916\u4fe1\u606f\uff0c\u4ee5\u4fbf\u4e8e\u5728 Body \u4e2d\u6211\u4eec\u53ef\u4ee5\u505a\u5230\u4e0d\u9700\u8981\u4fee\u6539\u6216\u5305\u88c5\u4f7f\u7528\u8005\u7684\u539f\u59cb\u6d88\u606f\u6570\u636e\u683c\u5f0f\u548c\u5185\u5bb9\u8fdb\u884c\u53d1\u9001\u3002</p> <p>\u8fd9\u6837\u7684\u505a\u6cd5\u662f\u5408\u7406\u7684\uff0c\u5b83\u6709\u52a9\u4e8e\u5728\u5f02\u6784\u7cfb\u7edf\u4e2d\u8fdb\u884c\u66f4\u597d\u7684\u96c6\u6210\uff0c\u76f8\u5bf9\u4e8e\u4ee5\u524d\u7684\u7248\u672c\u4f7f\u7528\u8005\u4e0d\u9700\u8981\u77e5\u9053CAP\u5185\u90e8\u4f7f\u7528\u7684\u6d88\u606f\u7ed3\u6784\u5c31\u53ef\u4ee5\u5b8c\u6210\u96c6\u6210\u5de5\u4f5c\u3002</p> <p>\u73b0\u5728\u6211\u4eec\u5c06\u6d88\u606f\u5212\u5206\u4e3a Header \u548c Body \u6765\u8fdb\u884c\u4f20\u8f93\u3002</p> <p>Body \u4e2d\u7684\u6570\u636e\u4e3a\u7528\u6237\u53d1\u9001\u7684\u539f\u59cb\u6d88\u606f\u5185\u5bb9\uff0c\u4e5f\u5c31\u662f\u8c03\u7528 Publish \u65b9\u6cd5\u53d1\u9001\u7684\u5185\u5bb9\uff0c\u6211\u4eec\u4e0d\u8fdb\u884c\u4efb\u4f55\u5305\u88c5\u4ec5\u4ec5\u662f\u5e8f\u5217\u5316\u540e\u4f20\u9012\u5230\u6d88\u606f\u961f\u5217\u3002</p> <p>\u5728 Header \u4e2d\uff0c\u6211\u4eec\u9700\u8981\u4f20\u9012\u4e00\u4e9b\u989d\u5916\u4fe1\u606f\u4ee5\u4fbf\u4e8eCAP\u5728\u6536\u5230\u6d88\u606f\u65f6\u80fd\u591f\u63d0\u53d6\u5230\u5173\u952e\u7279\u5f81\u8fdb\u884c\u64cd\u4f5c\u3002</p> <p>\u4ee5\u4e0b\u662f\u5728\u5f02\u6784\u7cfb\u7edf\u4e2d\uff0c\u9700\u8981\u5728\u53d1\u6d88\u606f\u7684\u65f6\u5019\u5411\u6d88\u606f\u7684Header \u4e2d\u5199\u5165\u7684\u5185\u5bb9\uff1a</p> \u952e \u7c7b\u578b \u8bf4\u660e cap-msg-id string \u6d88\u606fId\uff0c \u7531\u96ea\u82b1\u7b97\u6cd5\u751f\u6210\uff0c\u4e5f\u53ef\u4ee5\u662f guid cap-msg-name string \u6d88\u606f\u540d\u79f0\uff0c\u5373 Topic \u540d\u5b57 cap-msg-type string \u6d88\u606f\u7684\u7c7b\u578b, \u5373 typeof(T).FullName (\u975e\u5fc5\u987b) cap-senttime stringg \u53d1\u9001\u7684\u65f6\u95f4 (\u975e\u5fc5\u987b) <p>\u4ee5 Java \u7cfb\u7edf\u53d1\u9001 RabbitMQ \u4e3a\u4f8b\uff1a</p> <pre><code>Map&lt;String, Object&gt; headers = new HashMap&lt;String, Object&gt;();\nheaders.put(\"cap-msg-id\",  UUID.randomUUID().toString());\nheaders.put(\"cap-msg-name\", routingKey);\n\nchannel.basicPublish(exchangeName, routingKey,\nnew AMQP.BasicProperties.Builder()\n.headers(headers)\n.build(),\nmessageBodyBytes);\n// messageBodyBytes = \"\u53d1\u9001\u7684json\".getBytes(Charset.forName(\"UTF-8\"))\n// \u6ce8\u610f messageBody \u9ed8\u8ba4\u4e3a json \u7684 byte[]\uff0c\u5982\u679c\u91c7\u7528\u5176\u4ed6\u7cfb\u5217\u5316\uff0c\u9700\u8981\u5728CAP\u4fa7\u81ea\u5b9a\u4e49\u53cd\u5e8f\u5217\u5316\u5668\n</code></pre>"},{"location":"user-guide/zh/cap/messaging/#_5","title":"\u6d88\u606f\u8c03\u5ea6","text":"<p>CAP \u63a5\u6536\u5230\u6d88\u606f\u4e4b\u540e\u4f1a\u5c06\u6d88\u606f\u53d1\u9001\u5230 Transport, \u7531 Transport \u8fdb\u884c\u8fd0\u8f93\u3002</p> <p>\u5f53\u4f60\u4f7f\u7528 <code>ICapPublisher</code> \u63a5\u53e3\u53d1\u9001\u65f6\uff0cCAP\u5c06\u4f1a\u5c06\u6d88\u606f\u8c03\u5ea6\u5230\u76f8\u5e94\u7684 Transport\u4e2d\u53bb\uff0c\u76ee\u524d\u8fd8\u4e0d\u652f\u6301\u6279\u91cf\u53d1\u9001\u6d88\u606f\u3002</p> <p>\u6709\u5173 Transports \u7684\u66f4\u591a\u4fe1\u606f\uff0c\u53ef\u4ee5\u67e5\u770b Transports \u7ae0\u8282\u3002</p>"},{"location":"user-guide/zh/cap/messaging/#_6","title":"\u6d88\u606f\u5b58\u50a8","text":"<p>CAP \u63a5\u6536\u5230\u6d88\u606f\u4e4b\u540e\u4f1a\u5c06\u6d88\u606f\u8fdb\u884c Persistent\uff08\u6301\u4e45\u5316\uff09\uff0c \u6709\u5173 Persistent \u7684\u66f4\u591a\u4fe1\u606f\uff0c\u53ef\u4ee5\u67e5\u770b Persistent \u7ae0\u8282\u3002</p>"},{"location":"user-guide/zh/cap/messaging/#_7","title":"\u6d88\u606f\u91cd\u8bd5","text":"<p>\u91cd\u8bd5\u5728\u6574\u4e2aCAP\u67b6\u6784\u8bbe\u8ba1\u4e2d\u5177\u6709\u91cd\u8981\u4f5c\u7528\uff0cCAP \u4e2d\u4f1a\u9488\u5bf9\u53d1\u9001\u5931\u8d25\u6216\u8005\u6267\u884c\u5931\u8d25\u7684\u6d88\u606f\u8fdb\u884c\u91cd\u8bd5\u3002\u5728\u6574\u4e2a CAP \u7684\u8bbe\u8ba1\u8fc7\u7a0b\u4e2d\u6709\u4ee5\u4e0b\u51e0\u5904\u91c7\u7528\u7684\u91cd\u8bd5\u7b56\u7565\u3002</p> <p>1\u3001 \u53d1\u9001\u91cd\u8bd5</p> <p>\u5728\u6d88\u606f\u53d1\u9001\u8fc7\u7a0b\u4e2d\uff0c\u5f53\u51fa\u73b0 Broker \u5b95\u673a\u6216\u8005\u8fde\u63a5\u5931\u8d25\u7684\u60c5\u51b5\u4ea6\u6216\u8005\u51fa\u73b0\u5f02\u5e38\u7684\u60c5\u51b5\u4e0b\uff0c\u8fd9\u4e2a\u65f6\u5019 CAP \u4f1a\u5bf9\u53d1\u9001\u7684\u91cd\u8bd5\uff0c\u7b2c\u4e00\u6b21\u91cd\u8bd5\u6b21\u6570\u4e3a 3\uff0c4\u5206\u949f\u540e\u4ee5\u540e\u6bcf\u5206\u949f\u91cd\u8bd5\u4e00\u6b21\uff0c\u8fdb\u884c\u6b21\u6570 +1\uff0c\u5f53\u603b\u6b21\u6570\u8fbe\u523050\u6b21\u540e\uff0cCAP\u5c06\u4e0d\u5bf9\u5176\u8fdb\u884c\u91cd\u8bd5\u3002</p> <p>\u4f60\u53ef\u4ee5\u5728 CapOptions \u4e2d\u8bbe\u7f6e FailedRetryCount \u6765\u8c03\u6574\u9ed8\u8ba4\u91cd\u8bd5\u7684\u603b\u6b21\u6570\u3002</p> <p>\u5f53\u5931\u8d25\u603b\u6b21\u6570\u8fbe\u5230\u9ed8\u8ba4\u5931\u8d25\u603b\u6b21\u6570\u540e\uff0c\u5c31\u4e0d\u4f1a\u8fdb\u884c\u91cd\u8bd5\u4e86\uff0c\u4f60\u53ef\u4ee5\u5728 Dashboard \u4e2d\u67e5\u770b\u6d88\u606f\u5931\u8d25\u7684\u539f\u56e0\uff0c\u7136\u540e\u8fdb\u884c\u4eba\u5de5\u91cd\u8bd5\u5904\u7406\u3002</p> <p>2\u3001 \u6d88\u8d39\u91cd\u8bd5</p> <p>\u5f53 Consumer \u63a5\u6536\u5230\u6d88\u606f\u65f6\uff0c\u4f1a\u6267\u884c\u6d88\u8d39\u8005\u65b9\u6cd5\uff0c\u5728\u6267\u884c\u6d88\u8d39\u8005\u65b9\u6cd5\u51fa\u73b0\u5f02\u5e38\u65f6\uff0c\u4f1a\u8fdb\u884c\u91cd\u8bd5\u3002\u8fd9\u4e2a\u91cd\u8bd5\u7b56\u7565\u548c\u4e0a\u9762\u7684 \u53d1\u9001\u91cd\u8bd5 \u662f\u76f8\u540c\u7684\u3002</p>"},{"location":"user-guide/zh/cap/messaging/#_8","title":"\u6d88\u606f\u6570\u636e\u6e05\u7406","text":"<p>\u6570\u636e\u5e93\u6d88\u606f\u8868\u4e2d\u5177\u6709\u4e00\u4e2a ExpiresAt \u5b57\u6bb5\u8868\u793a\u6d88\u606f\u7684\u8fc7\u671f\u65f6\u95f4\uff0c\u5f53\u6d88\u606f\u53d1\u9001\u6210\u529f\u6216\u8005\u6d88\u8d39\u6210\u529f\u540e\uff0cCAP\u4f1a\u5c06\u6d88\u606f\u72b6\u6001\u4e3a Successed \u7684 ExpiresAt \u8bbe\u7f6e\u4e3a 1\u5929 \u540e\u8fc7\u671f\uff0c\u4f1a\u5c06\u6d88\u606f\u72b6\u6001\u4e3a Failed \u7684 ExpiresAt \u8bbe\u7f6e\u4e3a 15\u5929 \u540e\u8fc7\u671f\uff08\u53ef\u901a\u8fc7 FailedMessageExpiredAfter \u914d\u7f6e)\u3002</p> <p>CAP \u9ed8\u8ba4\u60c5\u51b5\u4e0b\u4f1a\u6bcf\u9694**5\u5206\u949f**\u5c06\u6d88\u606f\u8868\u7684\u6570\u636e\u8fdb\u884c\u6e05\u7406\u5220\u9664\uff0c\u907f\u514d\u6570\u636e\u91cf\u8fc7\u591a\u5bfc\u81f4\u6027\u80fd\u7684\u964d\u4f4e\u3002\u6e05\u7406\u89c4\u5219\u4e3a ExpiresAt \u4e0d\u4e3a\u7a7a\u5e76\u4e14\u5c0f\u4e8e\u5f53\u524d\u65f6\u95f4\u7684\u6570\u636e\u3002 \u4e5f\u5c31\u662f\u8bf4\u72b6\u6001\u4e3aFailed\u7684\u6d88\u606f\uff08\u6b63\u5e38\u60c5\u51b5\u4ed6\u4eec\u5df2\u7ecf\u88ab\u91cd\u8bd5\u4e86 50 \u6b21\uff09\uff0c\u5982\u679c\u4f6015\u5929\u6ca1\u6709\u4eba\u5de5\u4ecb\u5165\u5904\u7406\uff0c\u540c\u6837\u4f1a\u88ab\u6e05\u7406\u6389\u3002\u4f60\u53ef\u4ee5\u901a\u8fc7 CollectorCleaningInterval \u914d\u7f6e\u9879\u6765\u81ea\u5b9a\u4e49\u95f4\u9694\u65f6\u95f4\u3002</p>"},{"location":"user-guide/zh/cap/serialization/","title":"\u5e8f\u5217\u5316","text":"<p>CAP \u63d0\u4f9b\u4e86 <code>ISerializer</code> \u63a5\u53e3\u6765\u652f\u6301\u5bf9\u6d88\u606f\u8fdb\u884c\u5e8f\u5217\u5316\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u6211\u4eec\u4f7f\u7528 json \u6765\u5bf9\u6d88\u606f\u8fdb\u884c\u5e8f\u5217\u5316\u5904\u7406\u5e76\u5b58\u50a8\u5230\u6570\u636e\u5e93\u4e2d\u3002</p>"},{"location":"user-guide/zh/cap/serialization/#_2","title":"\u81ea\u5b9a\u4e49\u5e8f\u5217\u5316","text":"<pre><code>public class YourSerializer: ISerializer\n{\nTask&lt;TransportMessage&gt; SerializeAsync(Message message)\n{\n\n}\n\nTask&lt;Message&gt; DeserializeAsync(TransportMessage transportMessage, Type valueType)\n{\n\n}\n}\n</code></pre> <p>\u7136\u540e\u5c06\u4f60\u7684\u5b9e\u73b0\u6ce8\u518c\u5230\u5bb9\u5668\u4e2d:</p> <pre><code>//\u6ce8\u518c\u4f60\u7684\u81ea\u5b9a\u4e49\u5b9e\u73b0\nservices.AddSingleton&lt;ISerializer, YourSerializer&gt;();\n\n// ---\nservices.AddCap \n</code></pre>"},{"location":"user-guide/zh/cap/serialization/#v30","title":"\u6d88\u606f\u9002\u914d\u5668 (v3.0\u79fb\u9664 )","text":"<p>\u5728\u5f02\u6784\u7cfb\u7edf\u4e2d\uff0c\u6709\u65f6\u5019\u9700\u8981\u548c\u5176\u4ed6\u7cfb\u7edf\u8fdb\u884c\u901a\u8baf\uff0c\u4f46\u662f\u5176\u4ed6\u7cfb\u7edf\u4f7f\u7528\u7684\u6d88\u606f\u5bf9\u8c61\u53ef\u80fd\u548c CAP \u7684\u5305\u88c5\u5668\u5bf9\u8c61\u4e0d\u4e00\u6837\uff0c\u8fd9\u4e2a\u65f6\u5019\u5c31\u9700\u8981\u5bf9\u6d88\u606f\u8fdb\u884c\u81ea\u5b9a\u4e49\u9002\u914d\u3002</p> <p>CAP \u63d0\u4f9b\u4e86 <code>IMessagePacker</code> \u63a5\u53e3\u7528\u4e8e\u5bf9 \u5305\u88c5\u5668\u5bf9\u8c61 \u8fdb\u884c\u81ea\u5b9a\u4e49\uff0c\u81ea\u5b9a\u4e49\u7684 MessagePacker \u901a\u5e38\u662f\u5c06 <code>CapMessage</code> \u8fdb\u884c\u6253\u5305\u548c\u89e3\u5305\u64cd\u4f5c\uff0c\u5728\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\u53ef\u4ee5\u6dfb\u52a0\u81ea\u5df1\u7684\u4e1a\u52a1\u5bf9\u8c61\u3002</p> <p>\u4f7f\u7528\u65b9\u6cd5\uff1a</p> <pre><code>class MyMessagePacker : IMessagePacker\n{\nprivate readonly IContentSerializer _serializer;\n\npublic DefaultMessagePacker(IContentSerializer serializer)\n{\n_serializer = serializer;\n}\n\npublic string Pack(CapMessage obj)\n{\nvar myStructure = new\n{\nId = obj.Id,\nBody = obj.Content,\nDate = obj.Timestamp,\nCallback = obj.CallbackName\n};\nreturn _serializer.Serialize(myStructure);\n}\n\npublic CapMessage UnPack(string packingMessage)\n{\nvar myStructure = _serializer.DeSerialize&lt;MyStructure&gt;(packingMessage);\n\nreturn new CapMessageDto\n{\nId = myStructure.Id,\nTimestamp = myStructure.Date,\nContent = myStructure.Body,\nCallbackName = myStructure.Callback\n};\n}\n}\n</code></pre> <p>\u63a5\u4e0b\u6765\uff0c\u914d\u7f6e\u81ea\u5b9a\u4e49\u7684 <code>MyMessagePacker</code> \u5230\u670d\u52a1\u4e2d\u3002</p> <pre><code>services.AddCap(x =&gt;{  }).AddMessagePacker&lt;MyMessagePacker&gt;();\n</code></pre>"},{"location":"user-guide/zh/cap/transactions/","title":"\u4e8b\u52a1","text":""},{"location":"user-guide/zh/cap/transactions/#_2","title":"\u5206\u5e03\u5f0f\u4e8b\u52a1?","text":"<p>CAP \u4e0d\u76f4\u63a5\u63d0\u4f9b\u5f00\u7bb1\u5373\u7528\u7684\u57fa\u4e8e DTC \u6216\u8005 2PC \u7684\u5206\u5e03\u5f0f\u4e8b\u52a1\uff0c\u76f8\u53cd\u6211\u4eec\u63d0\u4f9b\u4e00\u79cd\u53ef\u4ee5\u7528\u4e8e\u89e3\u51b3\u5728\u5206\u5e03\u5f0f\u4e8b\u52a1\u9047\u5230\u7684\u95ee\u9898\u7684\u4e00\u79cd\u89e3\u51b3\u65b9\u6848\u3002</p> <p>\u5728\u5206\u5e03\u5f0f\u73af\u5883\u4e2d\uff0c\u7531\u4e8e\u6d89\u53ca\u901a\u8baf\u7684\u5f00\u9500\uff0c\u4f7f\u7528\u57fa\u4e8e2PC\u6216DTC\u7684\u5206\u5e03\u5f0f\u4e8b\u52a1\u5c06\u975e\u5e38\u6602\u8d35\uff0c\u5728\u6027\u80fd\u65b9\u9762\u4e5f\u540c\u6837\u5982\u6b64\u3002\u53e6\u5916\u7531\u4e8e\u57fa\u4e8e2PC\u6216DTC\u7684\u5206\u5e03\u5f0f\u4e8b\u52a1\u540c\u6837\u53d7**CAP\u5b9a\u7406**\u7684\u7ea6\u675f\uff0c\u5f53\u53d1\u751f\u7f51\u7edc\u5206\u533a\u65f6\u5b83\u5c06\u4e0d\u5f97\u4e0d\u653e\u5f03\u53ef\u7528\u6027(CAP\u4e2d\u7684A)\u3002</p> <p>\u9488\u5bf9\u4e8e\u5206\u5e03\u5f0f\u4e8b\u52a1\u7684\u5904\u7406\uff0cCAP \u91c7\u7528\u7684\u662f\u201c\u5f02\u6b65\u786e\u4fdd\u201d\u8fd9\u79cd\u65b9\u6848\u3002</p>"},{"location":"user-guide/zh/cap/transactions/#_3","title":"\u5f02\u6b65\u786e\u4fdd","text":"<p>\u5f02\u6b65\u786e\u4fdd\u8fd9\u79cd\u65b9\u6848\u53c8\u53eb\u505a\u672c\u5730\u6d88\u606f\u8868\uff0c\u8fd9\u662f\u4e00\u79cd\u7ecf\u5178\u7684\u65b9\u6848\uff0c\u65b9\u6848\u6700\u521d\u6765\u6e90\u4e8e eBay\uff0c\u53c2\u8003\u8d44\u6599\u89c1\u6bb5\u672b\u94fe\u63a5\u3002\u8fd9\u79cd\u65b9\u6848\u76ee\u524d\u4e5f\u662f\u4f01\u4e1a\u4e2d\u4f7f\u7528\u6700\u591a\u7684\u65b9\u6848\u4e4b\u4e00\u3002</p> <p>\u76f8\u5bf9\u4e8e TCC \u6216\u8005 2PC/3PC \u6765\u8bf4\uff0c\u8fd9\u4e2a\u65b9\u6848\u5bf9\u4e8e\u5206\u5e03\u5f0f\u4e8b\u52a1\u6765\u8bf4\u662f\u6700\u7b80\u5355\u7684\uff0c\u800c\u4e14\u5b83\u662f\u53bb\u4e2d\u5fc3\u5316\u7684\u3002\u5728TCC \u6216\u8005 2PC \u7684\u65b9\u6848\u4e2d\uff0c\u5fc5\u987b\u5177\u6709\u4e8b\u52a1\u534f\u8c03\u5668\u6765\u5904\u7406\u6bcf\u4e2a\u4e0d\u540c\u670d\u52a1\u4e4b\u95f4\u7684\u72b6\u6001\uff0c\u800c\u6b64\u79cd\u65b9\u6848\u4e0d\u9700\u8981\u4e8b\u52a1\u534f\u8c03\u5668\u3002 \u53e6\u5916 2PC/TCC \u8fd9\u79cd\u65b9\u6848\u5982\u679c\u670d\u52a1\u4f9d\u8d56\u8fc7\u591a\uff0c\u4f1a\u5e26\u6765\u7ba1\u7406\u590d\u6742\u6027\u589e\u52a0\u548c\u7a33\u5b9a\u6027\u98ce\u9669\u589e\u5927\u7684\u95ee\u9898\u3002\u8bd5\u60f3\u5982\u679c\u6211\u4eec\u5f3a\u4f9d\u8d56 10 \u4e2a\u670d\u52a1\uff0c9 \u4e2a\u90fd\u6267\u884c\u6210\u529f\u4e86\uff0c\u6700\u540e\u4e00\u4e2a\u6267\u884c\u5931\u8d25\u4e86\uff0c\u90a3\u4e48\u662f\u4e0d\u662f\u524d\u9762 9 \u4e2a\u90fd\u8981\u56de\u6eda\u6389\uff1f\u8fd9\u4e2a\u6210\u672c\u8fd8\u662f\u975e\u5e38\u9ad8\u7684\u3002</p> <p>\u4f46\u662f\uff0c\u5e76\u4e0d\u662f\u8bf4 2PC \u6216\u8005 TCC \u8fd9\u79cd\u65b9\u6848\u4e0d\u597d\uff0c\u56e0\u4e3a\u6bcf\u4e00\u79cd\u65b9\u6848\u90fd\u6709\u5176\u76f8\u5bf9\u4f18\u52bf\u7684\u4f7f\u7528\u573a\u666f\u548c\u4f18\u7f3a\u70b9\uff0c\u8fd9\u91cc\u5c31\u4e0d\u505a\u8fc7\u591a\u4ecb\u7ecd\u4e86\u3002</p> <p>\u4e2d\u6587\uff1ahttp://www.cnblogs.com/savorboard/p/base-an-acid-alternative.html \u82f1\u6587\uff1ahttp://queue.acm.org/detail.cfm?id=1394128</p>"},{"location":"user-guide/zh/getting-started/contributing/","title":"\u8d21\u732e","text":"<p>\u8d21\u732e\u6700\u7b80\u5355\u7684\u65b9\u5f0f\u4e4b\u4e00\u5c31\u662f\u53c2\u4e0e\u8ba8\u8bba\u548cissue\u8ba8\u8bba\u3002</p> <p>\u5982\u679c\u60a8\u6709\u4efb\u4f55\u7591\u95ee\u6216\u95ee\u9898\uff0c\u8bf7\u5728CAP\u4ed3\u5e93\u4e2d\u62a5\u544a\uff1a</p> <p> Report Issue  Active Issues </p>"},{"location":"user-guide/zh/getting-started/contributing/#_2","title":"\u63d0\u4ea4\u66f4\u6539","text":"<p>\u60a8\u8fd8\u53ef\u4ee5\u901a\u8fc7\u63d0\u4ea4\u4ee3\u7801\u66f4\u6539PR\u6765\u505a\u51fa\u8d21\u732e\u3002</p> <p>Pull requests \u53ef\u8ba9\u60a8\u544a\u8bc9\u5176\u4ed6\u4eba\u5df2\u63a8\u9001\u5230GitHub\u4e0a\u5b58\u50a8\u5e93\u7684\u66f4\u6539\u3002 \u6253\u5f00 Pull requests \u540e\uff0c\u60a8\u53ef\u4ee5\u4e0e\u534f\u4f5c\u8005\u8ba8\u8bba\u548c\u5ba1\u67e5\u505a\u51fa\u7684\u66f4\u6539\uff0c\u5e76\u5728\u66f4\u6539\u5408\u5e76\u5230\u5b58\u50a8\u5e93\u4e4b\u524d\u6dfb\u52a0\u540e\u7eed\u63d0\u4ea4\u3002</p>"},{"location":"user-guide/zh/getting-started/contributing/#_3","title":"\u5176\u4ed6\u8d44\u6e90","text":"<ul> <li> <p>issue \u548c pull requests</p> </li> <li> <p>\u4f7f\u7528\u641c\u7d22\u8fc7\u6ee4 issue \u548c pull requests</p> </li> </ul>"},{"location":"user-guide/zh/getting-started/introduction/","title":"\u4ecb\u7ecd","text":"<p>CAP \u662f\u4e00\u4e2aEventBus\uff0c\u540c\u65f6\u4e5f\u662f\u4e00\u4e2a\u5728\u5fae\u670d\u52a1\u6216\u8005SOA\u7cfb\u7edf\u4e2d\u89e3\u51b3\u5206\u5e03\u5f0f\u4e8b\u52a1\u95ee\u9898\u7684\u4e00\u4e2a\u6846\u67b6\u3002\u5b83\u6709\u52a9\u4e8e\u521b\u5efa\u53ef\u6269\u5c55\uff0c\u53ef\u9760\u5e76\u4e14\u6613\u4e8e\u66f4\u6539\u7684\u5fae\u670d\u52a1\u7cfb\u7edf\u3002</p> <p>\u5728\u5fae\u8f6f\u7684 eShopOnContainer \u5fae\u670d\u52a1\u793a\u4f8b\u9879\u76ee\u4e2d\uff0c\u63a8\u8350\u4f7f\u7528 CAP \u4f5c\u4e3a\u751f\u4ea7\u73af\u5883\u53ef\u7528\u7684 EventBus\u3002</p> <p>\u4ec0\u4e48\u662f EventBus\uff1f</p> <p>\u4e8b\u4ef6\u603b\u7ebf\u662f\u4e00\u79cd\u673a\u5236\uff0c\u5b83\u5141\u8bb8\u4e0d\u540c\u7684\u7ec4\u4ef6\u5f7c\u6b64\u901a\u4fe1\u800c\u4e0d\u5f7c\u6b64\u4e86\u89e3\u3002 \u7ec4\u4ef6\u53ef\u4ee5\u5c06\u4e8b\u4ef6\u53d1\u9001\u5230Eventbus\uff0c\u800c\u65e0\u9700\u77e5\u9053\u662f\u8c01\u6765\u63a5\u542c\u6216\u6709\u591a\u5c11\u5176\u4ed6\u4eba\u6765\u63a5\u542c\u3002 \u7ec4\u4ef6\u4e5f\u53ef\u4ee5\u4fa6\u542cEventbus\u4e0a\u7684\u4e8b\u4ef6\uff0c\u800c\u65e0\u9700\u77e5\u9053\u8c01\u53d1\u9001\u4e86\u4e8b\u4ef6\u3002 \u8fd9\u6837\uff0c\u7ec4\u4ef6\u53ef\u4ee5\u76f8\u4e92\u901a\u4fe1\u800c\u65e0\u9700\u76f8\u4e92\u4f9d\u8d56\u3002 \u540c\u6837\uff0c\u5f88\u5bb9\u6613\u66ff\u6362\u4e00\u4e2a\u7ec4\u4ef6\u3002 \u53ea\u8981\u65b0\u7ec4\u4ef6\u4e86\u89e3\u6b63\u5728\u53d1\u9001\u548c\u63a5\u6536\u7684\u4e8b\u4ef6\uff0c\u5176\u4ed6\u7ec4\u4ef6\u5c31\u6c38\u8fdc\u4e0d\u4f1a\u77e5\u9053.</p> <p>\u76f8\u5bf9\u4e8e\u5176\u4ed6\u7684 Service Bus \u6216\u8005 Event Bus\uff0c CAP \u62e5\u6709\u81ea\u5df1\u7684\u7279\u8272\uff0c\u5b83\u4e0d\u8981\u6c42\u4f7f\u7528\u8005\u53d1\u9001\u6d88\u606f\u6216\u8005\u5904\u7406\u6d88\u606f\u7684\u65f6\u5019\u5b9e\u73b0\u6216\u8005\u7ee7\u627f\u4efb\u4f55\u63a5\u53e3\uff0c\u62e5\u6709\u975e\u5e38\u9ad8\u7684\u7075\u6d3b\u6027\u3002\u6211\u4eec\u4e00\u76f4\u575a\u4fe1\u7ea6\u5b9a\u5927\u4e8e\u914d\u7f6e\uff0c\u6240\u4ee5CAP\u4f7f\u7528\u8d77\u6765\u975e\u5e38\u7b80\u5355\uff0c\u5bf9\u4e8e\u65b0\u624b\u975e\u5e38\u53cb\u597d\uff0c\u5e76\u4e14\u62e5\u6709\u8f7b\u91cf\u7ea7\u3002</p> <p>CAP \u91c7\u7528\u6a21\u5757\u5316\u8bbe\u8ba1\uff0c\u5177\u6709\u9ad8\u5ea6\u7684\u53ef\u6269\u5c55\u6027\u3002\u4f60\u6709\u8bb8\u591a\u9009\u9879\u53ef\u4ee5\u9009\u62e9\uff0c\u5305\u62ec\u6d88\u606f\u961f\u5217\uff0c\u5b58\u50a8\uff0c\u5e8f\u5217\u5316\u65b9\u5f0f\u7b49\uff0c\u7cfb\u7edf\u7684\u8bb8\u591a\u5143\u7d20\u5185\u5bb9\u53ef\u4ee5\u66ff\u6362\u4e3a\u81ea\u5b9a\u4e49\u5b9e\u73b0\u3002</p>"},{"location":"user-guide/zh/getting-started/introduction/#_2","title":"\u76f8\u5173\u89c6\u9891","text":"<p>Video: bilibili \u6559\u7a0b</p> <p>Video: Youtube \u6559\u7a0b</p> <p>Video: \u817e\u8baf\u89c6\u9891\u6559\u7a0b</p>"},{"location":"user-guide/zh/getting-started/introduction/#_3","title":"\u76f8\u5173\u6587\u7ae0","text":"<p>Article: CAP \u4ecb\u7ecd\u53ca\u4f7f\u7528</p> <p>Article: CAP 7.0 \u7248\u672c\u4e2d\u7684\u65b0\u7279\u6027</p> <p>Article: CAP 6.0 \u7248\u672c\u4e2d\u7684\u65b0\u7279\u6027</p> <p>Article: CAP 5.0 \u7248\u672c\u4e2d\u7684\u65b0\u7279\u6027</p> <p>Article: CAP 3.0 \u7248\u672c\u4e2d\u7684\u65b0\u7279\u6027</p> <p>Article: CAP 2.6 \u7248\u672c\u4e2d\u7684\u65b0\u7279\u6027</p> <p>Article: CAP 2.5 \u7248\u672c\u4e2d\u7684\u65b0\u7279\u6027</p> <p>Article: CAP 2.4 \u7248\u672c\u4e2d\u7684\u65b0\u7279\u6027</p> <p>Article: CAP 2.3 \u7248\u672c\u4e2d\u7684\u65b0\u7279\u6027\u7528</p> <p>Article: .NET Core Community \u9996\u4e2a\u5343\u661f\u9879\u76ee\u8bde\u751f\uff1aCAP</p>"},{"location":"user-guide/zh/getting-started/quick-start/","title":"\u5feb\u901f\u5f00\u59cb","text":"<p>\u4e86\u89e3\u5982\u4f55\u4f7f\u7528 CAP \u6784\u5efa\u5fae\u670d\u52a1\u4e8b\u4ef6\u603b\u7ebf\u67b6\u6784\uff0c\u5b83\u6bd4\u76f4\u63a5\u96c6\u6210\u6d88\u606f\u961f\u5217\u63d0\u4f9b\u4e86\u54ea\u4e9b\u4f18\u52bf\uff0c\u5b83\u63d0\u4f9b\u4e86\u54ea\u4e9b\u5f00\u7bb1\u5373\u7528\u7684\u529f\u80fd\u3002</p>"},{"location":"user-guide/zh/getting-started/quick-start/#_2","title":"\u5b89\u88c5","text":"<pre><code>PM&gt; Install-Package DotNetCore.CAP\n</code></pre>"},{"location":"user-guide/zh/getting-started/quick-start/#aspnet-core","title":"\u5728 Asp.Net Core \u4e2d\u96c6\u6210","text":"<p>\u4ee5\u4fbf\u4e8e\u5feb\u901f\u542f\u52a8\uff0c\u6211\u4eec\u4f7f\u7528\u57fa\u4e8e\u5185\u5b58\u7684\u4e8b\u4ef6\u5b58\u50a8\u548c\u6d88\u606f\u961f\u5217\u3002</p> <pre><code>PM&gt; Install-Package DotNetCore.CAP.InMemoryStorage\nPM&gt; Install-Package Savorboard.CAP.InMemoryMessageQueue\n</code></pre> <p>\u5728 <code>Startup.cs</code> \u4e2d\uff0c\u6dfb\u52a0\u4ee5\u4e0b\u914d\u7f6e\uff1a</p> <pre><code>public void ConfigureServices(IServiceCollection services)\n{\nservices.AddCap(x =&gt;\n{\nx.UseInMemoryStorage();\nx.UseInMemoryMessageQueue();\n});\n}\n</code></pre>"},{"location":"user-guide/zh/getting-started/quick-start/#_3","title":"\u53d1\u9001\u6d88\u606f","text":"<pre><code>public class PublishController : Controller\n{\n[Route(\"~/send\")]\npublic IActionResult SendMessage([FromServices]ICapPublisher capBus)\n{\ncapBus.Publish(\"test.show.time\", DateTime.Now);\n\nreturn Ok();\n}\n}\n</code></pre>"},{"location":"user-guide/zh/getting-started/quick-start/#_4","title":"\u53d1\u9001\u5ef6\u8fdf\u6d88\u606f","text":"<pre><code>public class PublishController : Controller\n{\n[Route(\"~/send/delay\")]\npublic IActionResult SendDelayMessage([FromServices]ICapPublisher capBus)\n{\ncapBus.PublishDelay(TimeSpan.FromSeconds(100),\"test.show.time\", DateTime.Now);\n\nreturn Ok();\n}\n}\n</code></pre>"},{"location":"user-guide/zh/getting-started/quick-start/#_5","title":"\u53d1\u9001\u5305\u542b\u5934\u4fe1\u606f\u7684\u6d88\u606f","text":"<pre><code>var header = new Dictionary&lt;string, string&gt;()\n{\n[\"my.header.first\"] = \"first\",\n[\"my.header.second\"] = \"second\"\n};\n\ncapBus.Publish(\"test.show.time\", DateTime.Now, header);\n</code></pre>"},{"location":"user-guide/zh/getting-started/quick-start/#_6","title":"\u5904\u7406\u6d88\u606f","text":"<pre><code>public class ConsumerController : Controller\n{\n[NonAction]\n[CapSubscribe(\"test.show.time\")]\npublic void ReceiveMessage(DateTime time)\n{\nConsole.WriteLine(\"message time is:\" + time);\n}\n}\n</code></pre>"},{"location":"user-guide/zh/getting-started/quick-start/#_7","title":"\u5904\u7406\u5305\u542b\u5934\u4fe1\u606f\u7684\u6d88\u606f","text":"<pre><code>[CapSubscribe(\"test.show.time\")]\npublic void ReceiveMessage(DateTime time, [FromCap]CapHeader header)\n{\nConsole.WriteLine(\"message time is:\" + time);\nConsole.WriteLine(\"message firset header :\" + header[\"my.header.first\"]);\nConsole.WriteLine(\"message second header :\" + header[\"my.header.second\"]);\n}\n</code></pre>"},{"location":"user-guide/zh/getting-started/quick-start/#_8","title":"\u6458\u8981","text":"<p>\u76f8\u5bf9\u4e8e\u76f4\u63a5\u96c6\u6210\u6d88\u606f\u961f\u5217\uff0c\u5f02\u6b65\u6d88\u606f\u4f20\u9012\u6700\u5f3a\u5927\u7684\u4f18\u52bf\u4e4b\u4e00\u662f\u53ef\u9760\u6027\uff0c\u7cfb\u7edf\u7684\u4e00\u4e2a\u90e8\u5206\u4e2d\u7684\u6545\u969c\u4e0d\u4f1a\u4f20\u64ad\uff0c\u4e5f\u4e0d\u4f1a\u5bfc\u81f4\u6574\u4e2a\u7cfb\u7edf\u5d29\u6e83\u3002 \u5728 CAP \u5185\u90e8\u4f1a\u5c06\u6d88\u606f\u8fdb\u884c\u5b58\u50a8\uff0c\u4ee5\u4fdd\u8bc1\u6d88\u606f\u7684\u53ef\u9760\u6027\uff0c\u5e76\u914d\u5408\u91cd\u8bd5\u7b49\u7b56\u7565\u4ee5\u8fbe\u5230\u5404\u4e2a\u670d\u52a1\u4e4b\u95f4\u7684\u6570\u636e\u6700\u7ec8\u4e00\u81f4\u6027\u3002</p>"},{"location":"user-guide/zh/monitoring/consul/","title":"Consul","text":"<p>Consul \u662f\u4e00\u4e2a\u5206\u5e03\u5f0f\u670d\u52a1\u7f51\u683c\uff0c\u7528\u4e8e\u8de8\u4efb\u4f55\u8fd0\u884c\u65f6\u5e73\u53f0\u548c\u516c\u5171\u6216\u79c1\u6709\u4e91\u8fde\u63a5\uff0c\u4fdd\u62a4\u548c\u914d\u7f6e\u670d\u52a1\u3002</p>"},{"location":"user-guide/zh/monitoring/consul/#dashboard-consul","title":"Dashboard \u4e2d\u7684 Consul \u914d\u7f6e","text":"<p>CAP\u7684 Dashboard \u4f7f\u7528 Consul \u4f5c\u4e3a\u670d\u52a1\u53d1\u73b0\u6765\u663e\u793a\u5176\u4ed6\u8282\u70b9\u7684\u6570\u636e\uff0c\u7136\u540e\u4f60\u5c31\u5728\u4efb\u610f\u8282\u70b9\u7684 Dashboard \u4e2d\u5207\u6362\u5230 Servers \u9875\u9762\u770b\u5230\u5176\u4ed6\u7684\u8282\u70b9\u3002</p> <p></p> <p>\u901a\u8fc7\u70b9\u51fb Switch \u6309\u94ae\u6765\u5207\u6362\u5230\u5176\u4ed6\u7684\u8282\u70b9\u770b\u5230\u5176\u4ed6\u8282\u70b9\u7684\u6570\u636e\uff0c\u800c\u4e0d\u5fc5\u8bbf\u95ee\u5f88\u591a\u5730\u5740\u6765\u5206\u522b\u67e5\u770b\u3002</p> <p>\u4ee5\u4e0b\u662f\u4e00\u4e2a\u914d\u7f6e\u793a\u4f8b, \u4f60\u9700\u8981\u5728\u6bcf\u4e2a\u8282\u70b9\u5206\u522b\u914d\u7f6e\uff1a</p> <pre><code>services.AddCap(x =&gt;\n{\nx.UseMySql(Configuration.GetValue&lt;string&gt;(\"ConnectionString\"));\nx.UseRabbitMQ(\"localhost\");\nx.UseDashboard();\nx.UseDiscovery(_ =&gt;\n{\n_.DiscoveryServerHostName = \"localhost\";\n_.DiscoveryServerPort = 8500;\n_.CurrentNodeHostName = Configuration.GetValue&lt;string&gt;(\"ASPNETCORE_HOSTNAME\");\n_.CurrentNodePort = Configuration.GetValue&lt;int&gt;(\"ASPNETCORE_PORT\");\n_.NodeId = Configuration.GetValue&lt;string&gt;(\"NodeId\");\n_.NodeName = Configuration.GetValue&lt;string&gt;(\"NodeName\");\n});\n});\n</code></pre> <p>Consul 1.6.2:</p> <pre><code>consul agent -dev\n</code></pre> <p>Windows 10, ASP.NET Core 3.1:</p> <pre><code>set ASPNETCORE_HOSTNAME=localhost&amp;&amp; set ASPNETCORE_PORT=5001&amp;&amp; dotnet run --urls=http://localhost:5001 NodeId=1 NodeName=CAP-1 ConnectionString=\"Server=localhost;Database=aaa;UserId=xxx;Password=xxx;\"\nset ASPNETCORE_HOSTNAME=localhost&amp;&amp; set ASPNETCORE_PORT=5002&amp;&amp; dotnet run --urls=http://localhost:5002 NodeId=2 NodeName=CAP-2 ConnectionString=\"Server=localhost;Database=bbb;UserId=xxx;Password=xxx;\"\n</code></pre>"},{"location":"user-guide/zh/monitoring/dashboard/","title":"Dashboard","text":"<p>CAP \u539f\u751f\u63d0\u4f9b\u4e86 Dashboard \u4f9b\u67e5\u770b\u6d88\u606f\uff0c\u5229\u7528 Dashboard \u63d0\u4f9b\u7684\u529f\u80fd\u53ef\u4ee5\u5f88\u65b9\u4fbf\u7684\u67e5\u770b\u548c\u7ba1\u7406\u6d88\u606f\u3002</p> <p>\u4f7f\u7528\u9650\u5236</p> <p>Dashboard \u53ea\u652f\u6301\u5728 ASP.NET Core \u4e2d\u4f7f\u7528\uff0c\u4e0d\u652f\u6301\u63a7\u5236\u53f0\u5e94\u7528(Console App)</p>"},{"location":"user-guide/zh/monitoring/dashboard/#dashboard_1","title":"\u542f\u7528 Dashboard","text":"<p>\u9996\u5148\uff0c\u4f60\u9700\u8981\u5b89\u88c5Dashboard\u7684 NuGet \u5305\u3002</p> <pre><code>PM&gt; Install-Package DotNetCore.CAP.Dashboard\n</code></pre> <p>\u7136\u540e\uff0c\u5728\u914d\u7f6e\u4e2d\u6dfb\u52a0\u5982\u4e0b\u4ee3\u7801\uff1a</p> <pre><code>services.AddCap(x =&gt;\n{\n//...\n\n// Register Dashboard\nx.UseDashboard();\n});\n</code></pre> <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u4f60\u53ef\u4ee5\u8bbf\u95ee <code>http://localhost:xxx/cap</code> \u8fd9\u4e2a\u5730\u5740\u6253\u5f00Dashboard\u3002 </p>"},{"location":"user-guide/zh/monitoring/dashboard/#dashboard_2","title":"Dashboard \u914d\u7f6e\u9879","text":"<ul> <li>PathBase</li> </ul> <p>\u9ed8\u8ba4\u503c\uff1aN/A</p> <p>\u5f53\u4f4d\u4e8e\u4ee3\u7406\u540e\u65f6\uff0c\u901a\u8fc7\u914d\u7f6e\u6b64\u53c2\u6570\u53ef\u4ee5\u6307\u5b9a\u4ee3\u7406\u8bf7\u6c42\u524d\u7f00\u3002</p> <ul> <li>PathMatch</li> </ul> <p>\u9ed8\u8ba4\u503c\uff1a'/cap'</p> <p>\u4f60\u53ef\u4ee5\u901a\u8fc7\u4fee\u6539\u6b64\u914d\u7f6e\u9879\u6765\u66f4\u6539Dashboard\u7684\u8bbf\u95ee\u8def\u5f84\u3002</p> <ul> <li>StatsPollingInterval</li> </ul> <p>\u9ed8\u8ba4\u503c\uff1a2000 \u6beb\u79d2</p> <p>\u6b64\u914d\u7f6e\u9879\u7528\u6765\u914d\u7f6eDashboard \u524d\u7aef \u83b7\u53d6\u72b6\u6001\u63a5\u53e3(/stats)\u7684\u8f6e\u8be2\u65f6\u95f4</p> <ul> <li>UseAuth </li> </ul> <p>\u9ed8\u8ba4\u503c\uff1afalse</p> <p>\u6307\u5b9a\u662f\u5426\u5f00\u542f\u6388\u6743</p> <ul> <li>DefaultAuthenticationScheme </li> </ul> <p>\u6388\u6743\u9ed8\u8ba4\u4f7f\u7528\u7684 Scheme </p> <ul> <li>UseChallengeOnAuth</li> </ul> <p>\u9ed8\u8ba4\u503c\uff1afalse</p> <p>\u6388\u6743\u662f\u5426\u542f\u7528 Challenge</p> <ul> <li>DefaultChallengeScheme </li> </ul> <p>Challenge \u9ed8\u8ba4\u4f7f\u7528\u7684 Scheme</p>"},{"location":"user-guide/zh/monitoring/dashboard/#_1","title":"\u81ea\u5b9a\u4e49\u8ba4\u8bc1","text":"<p>\u81ea 5.1.0 \u5f00\u59cb\uff0cCAP Dashboard \u6388\u6743\u9ed8\u8ba4\u4f7f\u7528 ASP.NET Core \u7684\u65b9\u5f0f\uff0c\u4e0d\u518d\u63d0\u4f9b\u81ea\u5b9a\u4e49\u6388\u6743\u8fc7\u6ee4\u5668\u3002</p> <p>\u5728 Dashabord \u8ba4\u8bc1\u65f6\uff0c\u4f1a\u4ece HttpContext.User?.Identity?.IsAuthenticated \u4e2d\u53d6\u503c\uff0c\u5982\u679c\u53d6\u4e0d\u5230\u5219\u8ba4\u8bc1\u5931\u8d25\uff0c\u5e76\u8c03\u7528 Challenge Scheme(\u5982\u8fdb\u884c\u914d\u7f6e)\u3002</p> <p>\u4f60\u53ef\u4ee5\u5728 Sample.Dashboard.Auth \u8fd9\u4e2a\u793a\u4f8b\u9879\u76ee\u4e2d\u67e5\u770b\u4f7f\u7528\u7ec6\u8282\u3002</p> <pre><code>services\n.AddAuthorization()\n.AddAuthentication(options =&gt;\n{\noptions.DefaultScheme =  CookieAuthenticationDefaults.AuthenticationScheme;\noptions.DefaultChallengeScheme = OpenIdConnectDefaults.AuthenticationScheme;\n})\n.AddCookie()\n.AddOpenIdConnect(options =&gt;\n{\noptions.Authority = \"https://demo.duendesoftware.com/\";\noptions.ClientId = \"interactive.confidential\";\noptions.ClientSecret = \"secret\";\noptions.ResponseType = \"code\";\noptions.UsePkce = true;\n\noptions.Scope.Clear();\noptions.Scope.Add(\"openid\");\noptions.Scope.Add(\"profile\");\n})\n</code></pre> <p>\u914d\u7f6e</p> <pre><code>services.AddCap(cap =&gt;\n{\ncap.UseDashboard(d =&gt;\n{\nd.UseChallengeOnAuth = true;\nd.DefaultChallengeScheme = OpenIdConnectDefaults.AuthenticationScheme;\n});\n}\n</code></pre>"},{"location":"user-guide/zh/monitoring/diagnostics/","title":"\u8bca\u65ad(Diagnostics)","text":"<p>Diagnostics \u63d0\u4f9b\u4e00\u7ec4\u529f\u80fd\u4f7f\u6211\u4eec\u80fd\u591f\u5f88\u65b9\u4fbf\u7684\u53ef\u4ee5\u8bb0\u5f55\u5728\u5e94\u7528\u7a0b\u5e8f\u8fd0\u884c\u671f\u95f4\u53d1\u751f\u7684\u5173\u952e\u6027\u64cd\u4f5c\u4ee5\u53ca\u4ed6\u4eec\u7684\u6267\u884c\u65f6\u95f4\u7b49\uff0c\u4f7f\u7ba1\u7406\u5458\u53ef\u4ee5\u67e5\u627e\u7279\u522b\u662f\u751f\u4ea7\u73af\u5883\u4e2d\u51fa\u73b0\u95ee\u9898\u6240\u5728\u7684\u6839\u672c\u539f\u56e0\u3002</p>"},{"location":"user-guide/zh/monitoring/diagnostics/#tracing","title":"\u8ddf\u8e2a(Tracing)","text":"<p>CAP \u5bf9 .NET <code>DiagnosticSource</code> \u63d0\u4f9b\u4e86\u652f\u6301\uff0c\u76d1\u542c\u5668\u540d\u79f0\u4e3a <code>CapDiagnosticListener</code>\u3002</p> <p>\u4f60\u53ef\u4ee5\u5728 <code>DotNetCore.CAP.Diagnostics.CapDiagnosticListenerNames</code> \u7c7b\u4e0b\u9762\u627e\u5230CAP\u5df2\u7ecf\u5b9a\u4e49\u7684\u4e8b\u4ef6\u540d\u79f0\u3002</p> <p>Diagnostics \u63d0\u4f9b\u5bf9\u5916\u63d0\u4f9b\u7684\u4e8b\u4ef6\u4fe1\u606f\u6709\uff1a</p> <ul> <li>\u6d88\u606f\u6301\u4e45\u5316\u4e4b\u524d</li> <li>\u6d88\u606f\u6301\u4e45\u5316\u4e4b\u540e</li> <li>\u6d88\u606f\u6301\u4e45\u5316\u5f02\u5e38</li> <li>\u6d88\u606f\u5411MQ\u53d1\u9001\u4e4b\u524d</li> <li>\u6d88\u606f\u5411MQ\u53d1\u9001\u4e4b\u540e</li> <li>\u6d88\u606f\u5411MQ\u53d1\u9001\u5f02\u5e38</li> <li>\u6d88\u606f\u4eceMQ\u6d88\u8d39\u4fdd\u5b58\u4e4b\u524d</li> <li>\u6d88\u606f\u4eceMQ\u6d88\u8d39\u4fdd\u5b58\u4e4b\u540e</li> <li>\u8ba2\u9605\u8005\u65b9\u6cd5\u6267\u884c\u4e4b\u524d</li> <li>\u8ba2\u9605\u8005\u65b9\u6cd5\u6267\u884c\u4e4b\u540e</li> <li>\u8ba2\u9605\u8005\u65b9\u6cd5\u6267\u884c\u5f02\u5e38</li> </ul>"},{"location":"user-guide/zh/monitoring/diagnostics/#skywalking-apm-cap","title":"\u5728 Skywalking APM \u4e2d\u8ffd\u8e2a CAP \u4e8b\u4ef6","text":"<p>Skywalking \u7684 C# \u5ba2\u6237\u7aef\u63d0\u4f9b\u4e86\u5bf9 CAP Diagnostics \u7684\u652f\u6301\uff0c\u4f60\u53ef\u4ee5\u5229\u7528 SkyAPM-dotnet \u6765\u5b9e\u73b0\u5728 Skywalking \u4e2d\u8ffd\u8e2a\u4e8b\u4ef6\u3002</p> <p>\u5c1d\u8bd5\u9605\u8bfbReadme\u6587\u6863\u6765\u5728\u4f60\u7684\u9879\u76ee\u4e2d\u96c6\u6210\u5b83\u3002</p> <p></p> <p></p>"},{"location":"user-guide/zh/monitoring/diagnostics/#apm","title":"\u5176\u4ed6 APM \u7684\u652f\u6301","text":"<p>\u76ee\u524d\u8fd8\u6ca1\u6709\u5b9e\u73b0\u5bf9\u9664\u4e86 Skywalking \u7684\u5176\u4ed6APM\u7684\u652f\u6301\uff0c\u5982\u679c\u4f60\u60f3\u5728\u5176\u4ed6 APM \u4e2d\u5b9e\u73b0\u5bf9 CAP \u8bca\u65ad\u4e8b\u4ef6\u7684\u652f\u6301\uff0c\u4f60\u53ef\u4ee5\u53c2\u8003\u8fd9\u91cc\u7684\u4ee3\u7801\u6765\u5b9e\u73b0\u5b83\uff1a</p> <p>https://github.com/SkyAPM/SkyAPM-dotnet/tree/master/src/SkyApm.Diagnostics.CAP</p>"},{"location":"user-guide/zh/monitoring/diagnostics/#metrics","title":"\u5ea6\u91cf(Metrics)","text":"<p>\u5ea6\u91cf\u662f\u6307\u5bf9\u4e8e\u4e00\u4e2a\u7269\u4f53\u6216\u662f\u4e8b\u4ef6\u7684\u67d0\u4e2a\u6027\u8d28\u7ed9\u4e88\u4e00\u4e2a\u6570\u5b57\uff0c\u4f7f\u5176\u53ef\u4ee5\u548c\u5176\u4ed6\u7269\u4f53\u6216\u662f\u4e8b\u4ef6\u7684\u76f8\u540c\u6027\u8d28\u6bd4\u8f83\u3002\u5ea6\u91cf\u53ef\u4ee5\u662f\u5bf9\u4e00\u7269\u7406\u91cf\uff08\u5982\u957f\u5ea6\u3001\u5c3a\u5bf8\u6216\u5bb9\u91cf\u7b49\uff09\u7684\u4f30\u8ba1\u6216\u6d4b\u5b9a\uff0c\u4e5f\u53ef\u4ee5\u662f\u5176\u4ed6\u8f83\u62bd\u8c61\u7684\u7279\u8d28\u3002</p> <p>CAP 7.0 \u5bf9 <code>EventSource</code> \u63d0\u4f9b\u4e86\u652f\u6301\uff0c\u8ba1\u6570\u5668\u540d\u79f0\u4e3a <code>DotNetCore.CAP.EventCounter</code>\u3002</p> <p>CAP \u63d0\u4f9b\u4e86\u4ee5\u4e0b\u51e0\u4e2a\u5ea6\u91cf\u6307\u6807\uff1a</p> <ul> <li>\u6bcf\u79d2\u53d1\u5e03\u901f\u5ea6</li> <li>\u6bcf\u79d2\u6d88\u8d39\u901f\u5ea6</li> <li>\u6bcf\u79d2\u8c03\u7528\u8ba2\u9605\u8005\u901f\u5ea6</li> <li>\u6bcf\u79d2\u6267\u884c\u8ba2\u9605\u8005\u5e73\u5747\u8017\u65f6</li> </ul>"},{"location":"user-guide/zh/monitoring/diagnostics/#dotnet-counters","title":"\u4f7f\u7528 dotnet-counters \u67e5\u770b\u5ea6\u91cf","text":"<p>dotnet-counters \u662f\u4e00\u4e2a\u6027\u80fd\u76d1\u89c6\u5de5\u5177\uff0c\u7528\u4e8e\u4e34\u65f6\u8fd0\u884c\u72b6\u51b5\u76d1\u89c6\u548c\u521d\u7ea7\u6027\u80fd\u8c03\u67e5\u3002 \u5b83\u53ef\u4ee5\u89c2\u5bdf\u901a\u8fc7 EventCounter API \u6216 Meter API \u53d1\u5e03\u7684\u6027\u80fd\u8ba1\u6570\u5668\u503c\u3002 </p> <p>\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u6765\u76d1\u89c6CAP\u4e2d\u7684\u5ea6\u91cf\u6307\u6807\uff1a</p> <pre><code>dotnet-counters ps\ndotnet-counters monitor --process-id=25496 --counters=DotNetCore.CAP.EventCounter\n</code></pre> <p>\u5176\u4e2d process-id \u4e3a CAP \u6240\u5c5e\u7684\u8fdb\u7a0bId\u3002</p> <p></p>"},{"location":"user-guide/zh/monitoring/diagnostics/#dashboard","title":"\u5728 Dashboard \u4e2d\u67e5\u770b\u5ea6\u91cf","text":"<p>\u4f60\u53ef\u4ee5\u914d\u7f6e <code>x.UseDashboard()</code> \u6765\u5f00\u542f\u4eea\u8868\u76d8\u4ee5\u56fe\u8868\u7684\u5f62\u5f0f\u67e5\u770b Metrics \u6307\u6807\u3002 \u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u5728 Realtime Metric Graph \u4e2d\uff0c\u65f6\u95f4\u8f74\u4f1a\u968f\u7740\u65f6\u95f4\u5b9e\u65f6\u6eda\u52a8\u4ece\u800c\u53ef\u4ee5\u770b\u5230\u53d1\u5e03\u548c\u6d88\u8d39\u6d88\u606f\u6bcf\u79d2\u7684\u901f\u7387\uff0c\u540c\u65f6\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u6d88\u8d39\u8005\u6267\u884c\u8017\u65f6\u4ee5\u201c\u6253\u70b9\u201d\u7684\u65b9\u5f0f\u5728 Y1 \u8f74\u4e0a\uff08Y0\u8f74\u4e3a\u901f\u7387\uff0cY1\u8f74\u4e3a\u6267\u884c\u8017\u65f6\uff09\u3002</p>"},{"location":"user-guide/zh/monitoring/opentelemetry/","title":"OpenTelemetry","text":"<p>https://opentelemetry.io/</p> <p>OpenTelemetry\u662f\u5de5\u5177\u3001api\u548csdk\u7684\u96c6\u5408\u3002 \u4f7f\u7528\u5b83\u6765\u68c0\u6d4b\u3001\u751f\u6210\u3001\u6536\u96c6\u548c\u5bfc\u51fa\u9065\u6d4b\u6570\u636e(\u5ea6\u91cf\u3001\u65e5\u5fd7\u548c\u8ddf\u8e2a)\uff0c\u4ee5\u5e2e\u52a9\u60a8\u5206\u6790\u8f6f\u4ef6\u7684\u6027\u80fd\u548c\u884c\u4e3a\u3002</p>"},{"location":"user-guide/zh/monitoring/opentelemetry/#_1","title":"\u96c6\u6210","text":"<p>\u4f60\u53ef\u4ee5\u5728\u8fd9\u91cc\u627e\u5230\u5173\u4e8e\u5982\u4f55\u5728\u63a7\u5236\u53f0\u5e94\u7528\u6216ASP.NET Core \u4e2d\u4f7f\u7528OpenTelemetry\u3002 \u5728\u8fd9\u91cc\u6211\u4eec\u4e3b\u8981\u63cf\u8ff0\u5982\u4f55\u5c06CAP\u96c6\u6210\u5230OpenTelemetry\u4e2d\u3002</p>"},{"location":"user-guide/zh/monitoring/opentelemetry/#_2","title":"\u914d\u7f6e","text":"<p>\u5b89\u88c5CAP\u7684OpenTelemetry\u5305\u5230\u9879\u76ee\u4e2d\u3002</p> <pre><code>dotnet add package DotNetCore.Cap.OpenTelemetry\n</code></pre> <p>OpenTelemetry \u7684\u8ddf\u8e2a\u6570\u636e\u6765\u81ea\u4e8eDiagnostics\u53d1\u9001\u7684\u8bca\u65ad\u6570\u636e\uff0c\u6dfb\u52a0 CAP Instrumentation \u5230 OpenTelemetry\u7684\u6269\u5c55\u914d\u7f6e\u4e2d\u4f1a\u8fdb\u884c\u81ea\u52a8\u6536\u96c6\u3002</p> <pre><code>services.AddOpenTelemetryTracing((builder) =&gt; builder\n.AddAspNetCoreInstrumentation()\n.AddCapInstrumentation()    // &lt;-- \u6dfb\u52a0\u8fd9\u884c\n.AddZipkinExporter()\n);\n</code></pre> <p>\u4ee5\u4e0b\u662fCAP\u7684\u8ddf\u8e2a\u6570\u636e\u5728 Zipkin \u4e2d\u7684\u4e00\u4e2a\u793a\u610f\u56fe\uff1a</p> <p></p>"},{"location":"user-guide/zh/samples/castle.dynamicproxy/","title":"\u548c Castle DynamicProxy \u96c6\u6210","text":"<p>Castle DynamicProxy \u662f\u4e00\u4e2a\u7528\u4e8e\u5728\u8fd0\u884c\u65f6\u52a8\u6001\u751f\u6210\u8f7b\u91cf\u7ea7.NET\u4ee3\u7406\u7684\u5e93\u3002\u4ee3\u7406\u5bf9\u8c61\u5141\u8bb8\u5728\u4e0d\u4fee\u6539\u7c7b\u4ee3\u7801\u7684\u60c5\u51b5\u4e0b\u622a\u53d6\u5bf9\u5bf9\u8c61\u6210\u5458\u7684\u8c03\u7528\u3002\u53ef\u4ee5\u4ee3\u7406\u7c7b\u548c\u63a5\u53e3\uff0c\u4f46\u662f\u53ea\u80fd\u62e6\u622a\u865a\u62df\u6210\u5458\u3002</p> <p>Castle.DynamicProxy \u53ef\u4ee5\u5e2e\u52a9\u4f60\u65b9\u4fbf\u7684\u521b\u5efa\u4ee3\u7406\u5bf9\u8c61\uff0c\u4ee3\u7406\u5bf9\u8c61\u53ef\u4ee5\u5e2e\u52a9\u6784\u5efa\u7075\u6d3b\u7684\u5e94\u7528\u7a0b\u5e8f\u4f53\u7cfb\u7ed3\u6784\uff0c\u56e0\u4e3a\u5b83\u5141\u8bb8\u5c06\u529f\u80fd\u900f\u660e\u5730\u6dfb\u52a0\u5230\u4ee3\u7801\u4e2d\uff0c\u800c\u65e0\u9700\u5bf9\u5176\u8fdb\u884c\u4fee\u6539\u3002\u4f8b\u5982\uff0c\u53ef\u4ee5\u4ee3\u7406\u4e00\u4e2a\u7c7b\u6765\u6dfb\u52a0\u65e5\u5fd7\u8bb0\u5f55\u6216\u5b89\u5168\u68c0\u67e5\uff0c\u800c\u65e0\u9700\u4f7f\u4ee3\u7801\u77e5\u9053\u5df2\u6dfb\u52a0\u6b64\u529f\u80fd\u3002</p> <p>\u4e0b\u9762\u53ef\u4ee5\u770b\u5230\u5982\u4f55\u5728 CAP \u4e2d\u96c6\u6210\u4f7f\u7528 Castle.DynamicProxy\u3002</p>"},{"location":"user-guide/zh/samples/castle.dynamicproxy/#1-nuget","title":"1\u3001\u5b89\u88c5 NuGet \u5305","text":"<p>\u5728 \u96c6\u6210\u4e86 CAP \u7684\u9879\u76ee\u4e2d\u5b89\u88c5\u5305\uff0c\u6709\u5173\u5982\u4f55\u96c6\u6210 CAP \u7684\u6587\u6863\u8bf7\u770b\u8fd9\u91cc\u3002</p> <p>\u6ce8\u610f\uff0c<code>Castle.DynamicProxy</code> \u8fd9\u4e2a\u5305\u5df2\u7ecf\u88ab\u5e9f\u5f03\uff0c\u8bf7\u4f7f\u7528\u6700\u65b0\u7684 <code>Castle.Core</code> \u5305\u3002</p> <pre><code>&lt;PackageReference Include=\"Castle.Core\" Version=\"4.4.1\" /&gt;\n</code></pre>"},{"location":"user-guide/zh/samples/castle.dynamicproxy/#2-castle","title":"2\u3001\u521b\u5efa\u4e00\u4e2a Castle \u5207\u9762\u62e6\u622a\u5668","text":"<p>\u53ef\u4ee5\u5728\u8fd9\u91cc dynamicproxy.md \u627e\u5230\u76f8\u5173\u7684\u6587\u6863\u3002</p> <p>\u4e0b\u9762\u4e3a\u793a\u4f8b\u4ee3\u7801\uff0c\u7ee7\u627f Castle \u63d0\u4f9b\u7684 <code>IInterceptor</code> \u63a5\u53e3\u5373\u53ef\uff1a</p> <pre><code>[Serializable]\npublic class MyInterceptor : IInterceptor\n{\n    public void Intercept(IInvocation invocation)\n    {\n        Console.WriteLine(\"Before target call\");\n        try\n        {\n            invocation.Proceed();\n        }\n        catch (Exception)\n        {\n            Console.WriteLine(\"Target threw an exception!\");\n            throw;\n        }\n        finally\n        {\n            Console.WriteLine(\"After target call\");\n        }\n    }\n}\n</code></pre> <p>\u62e6\u622a\u5668\u6b64\u5904\u547d\u540d\u4e3a <code>MyInterceptor</code>\uff0c\u4f60\u53ef\u4ee5\u5728\u5176\u4e2d\u5904\u7406\u4f60\u7684\u4e1a\u52a1\u903b\u8f91\uff0c\u6bd4\u5982\u6dfb\u52a0\u65e5\u5fd7\u6216\u5176\u4ed6\u7684\u4e00\u4e9b\u884c\u4e3a\u3002</p>"},{"location":"user-guide/zh/samples/castle.dynamicproxy/#3-iservicecollection","title":"3\u3001\u521b\u5efa IServiceCollection \u7684\u6269\u5c55\u7c7b","text":"<p>\u4e3a <code>IServiceCollection</code> \u521b\u5efa\u6269\u5c55\uff0c\u65b9\u9762\u540e\u7eed\u8c03\u7528\u3002</p> <pre><code>using Castle.DynamicProxy;\n\npublic static class ServicesExtensions\n{\npublic static void AddProxiedSingleton&lt;TImplementation&gt;(this IServiceCollection services)\nwhere TImplementation : class\n{\nservices.AddSingleton(serviceProvider =&gt;\n{\nvar proxyGenerator = serviceProvider.GetRequiredService&lt;ProxyGenerator&gt;();\nvar interceptors = serviceProvider.GetServices&lt;IInterceptor&gt;().ToArray();\nreturn proxyGenerator.CreateClassProxy&lt;TImplementation&gt;(interceptors);\n});\n}\n}\n</code></pre> <p>\u6b64\u5904\u6211\u521b\u5efa\u4e86\u4e00\u4e2a Singleton \u58f0\u660e\u5468\u671f\u7684\u6269\u5c55\u65b9\u6cd5\uff0c\u5efa\u8bae\u6240\u6709 CAP \u7684\u8ba2\u9605\u8005\u90fd\u521b\u5efa\u4e3a Singleton \u5373\u53ef\uff0c\u56e0\u4e3a\u5728 CAP \u5185\u90e8\u5b9e\u9645\u6267\u884c\u7684\u65f6\u5019\u4e5f\u4f1a\u521b\u5efa\u4e00\u4e2a scope \u6765\u6267\u884c\uff0c\u6240\u4ee5\u65e0\u9700\u62c5\u5fc3\u8d44\u6e90\u91ca\u653e\u95ee\u9898\u3002</p>"},{"location":"user-guide/zh/samples/castle.dynamicproxy/#4-cap","title":"4\u3001\u521b\u5efa CAP \u8ba2\u9605\u670d\u52a1","text":"<p>\u521b\u5efa\u4e00\u4e2a CAP \u8ba2\u9605\u7c7b\uff0c\u6ce8\u610f\u4e0d\u80fd\u653e\u5728 Controller \u4e2d\u4e86\u3002</p> <p>\u6ce8\u610f\uff1a\u65b9\u6cd5\u9700\u8981\u4e3a\u865a\u65b9\u6cd5 virtual\uff0c\u624d\u80fd\u88ab Castle \u91cd\u5199\uff0c\u522b\u641e\u5fd8\u4e86\u52a0\uff01\uff01\uff01 </p> <pre><code>public class CapSubscribeService: ICapSubscribe\n{\n[CapSubscribe(\"sample.rabbitmq.mysql\")]\npublic virtual void Subscriber(DateTime p)\n{\nConsole.WriteLine($@\"{DateTime.Now} Subscriber invoked, Info: {p}\");\n}\n}\n</code></pre>"},{"location":"user-guide/zh/samples/castle.dynamicproxy/#5-startup","title":"5\u3001\u5728 Startup \u4e2d\u96c6\u6210","text":"<pre><code>public void ConfigureServices(IServiceCollection services)\n{\n// \u6dfb\u52a0 Castle \u7684\u4ee3\u7406\u751f\u6210\u5668\nservices.AddSingleton(new ProxyGenerator());\n\n// \u6dfb\u52a0\u7b2c2\u6b65\u7684\u81ea\u5b9a\u4e49\u7684\u62e6\u622a\u7c7b\uff0c\u58f0\u660e\u5468\u671f\u4e3a\nservices.AddSingleton&lt;IInterceptor, MyInterceptor&gt;();\n\n// \u6b64\u5904\u4e3a\u4e0a\u9762\u7684\u6269\u5c55\u65b9\u6cd5\uff0c \u6dfb\u52a0 CAP \u8ba2\u9605 Service\nservices.AddProxiedSingleton&lt;CapSubscribeService&gt;();\n\nservices.AddCap(x =&gt;\n{\nx.UseMySql(\"\");\nx.UseRabbitMQ(\"\");\nx.UseDashboard();\n});\n\n// ...\n}\n</code></pre> <p>\u4ee5\u4e0a\u5c31\u5b8c\u6210\u4e86\u6240\u6709\u7684\u96c6\u6210\u5de5\u4f5c\uff0c\u53ef\u4ee5\u5f00\u59cb\u8fdb\u884c\u6d4b\u8bd5\u4e86\uff0c\u6709\u95ee\u9898\u6b22\u8fce\u5230 Github issue \u53cd\u9988\u3002</p> <p>\u6ce8\u610f\uff1a CAP \u9700\u8981\u4f7f\u7528 5.0 + \u7248\u672c\uff0c\u76ee\u524d(2021\u5e741\u67086\u65e5)\u53ea\u6709 preview \u7248\u672c\u3002</p>"},{"location":"user-guide/zh/samples/eshoponcontainers/","title":"eShopOnContainers","text":"<p>eShopOnContainers is a sample application written in C# running on .NET Core using a microservice architecture, Domain Driven Design.</p> <p>.NET Core reference application, powered by Microsoft, based on a simplified microservices architecture and Docker containers.</p> <p>This reference application is cross-platform at the server and client side, thanks to .NET Core services capable of running on Linux or Windows containers depending on your Docker host, and to Xamarin for mobile apps running on Android, iOS or Windows/UWP plus any browser for the client web apps.</p> <p>The architecture proposes a microservice oriented architecture implementation with multiple autonomous microservices (each one owning its own data/db) and implementing different approaches within each microservice (simple CRUD vs. DDD/CQRS patterns) using Http as the communication protocol between the client apps and the microservices and supports asynchronous communication for data updates propagation across multiple services based on Integration Events and an Event Bus (a light message broker, to choose between RabbitMQ or Azure Service Bus, underneath) plus other features defined at the roadmap.</p>"},{"location":"user-guide/zh/samples/eshoponcontainers/#eshoponcontainers-with-cap","title":"eShopOnContainers with CAP","text":"<p>\u4f60\u53ef\u4ee5\u5728\u4e0b\u9762\u7684\u5730\u5740\u770b\u5230\u5982\u4f55\u5728 eShopOnContainers \u4e2d\u4f7f\u7528 CAP\u3002</p> <p>https://github.com/yang-xiaodong/eShopOnContainers</p>"},{"location":"user-guide/zh/samples/faq/","title":"FAQ","text":"<p>Any IM group(e.g Tencent QQ group) to learn and chat about CAP?</p> <p>None of that. Better than wasting much time in IM group, I hope developers could be capable of independent thinking more, and solve problems yourselves with referenced documents, even create issues or send emails when errors are remaining present.</p> <p>Does it require different databases, one each for producer and consumer in CAP?</p> <p>No difference necessary, a recommendation is to use a dedicated database for each program.</p> <p>Otherwise, look at Q&amp;A below.</p> <p>How to use the same database for different applications?</p> <p>Define a table prefix name in <code>ConfigureServices</code> method.</p> <p>Code example\uff1a</p> <pre><code>public void ConfigureServices(IServiceCollection services)\n{\nservices.AddCap(x =&gt;\n{\nx.UseKafka(\"\");\nx.UseMySql(opt =&gt;\n{\nopt.ConnectionString = \"connection string\";\nopt.TableNamePrefix = \"appone\"; // different table name prefix here\n});\n});\n}\n</code></pre> <p>Can CAP not use the database as event storage? I just want to send the message</p> <p>Not yet.</p> <p>The purpose of CAP is that ensure consistency principle right in microservice or SOA architectures. The solution is based on ACID features of database, there is no sense about a single client wapper of message queue without database.</p> <p>If the consumer is abnormal, can I roll back the database executed sql that the producer has executed?</p> <p>Can't roll back, CAP is the ultimate consistency solution.</p> <p>You can imagine your scenario is to call a third party payment. If you are doing a third-party payment operation, after calling Alipay's interface successfully, and your own code is wrong, will Alipay roll back? If you don't roll back, what should you do? The same is true here.</p>"},{"location":"user-guide/zh/samples/github/","title":"Github \u4e0a\u7684\u793a\u4f8b","text":"<p>\u4f60\u53ef\u4ee5\u5728\u4e0b\u9762\u7684\u5730\u5740\u627e\u5230\u76f8\u5173\u793a\u4f8b\u4ee3\u7801\uff1a</p> <p>https://github.com/dotnetcore/CAP/tree/master/samples</p>"},{"location":"user-guide/zh/storage/general/","title":"\u57fa\u672c","text":"<p>CAP \u9700\u8981\u4f7f\u7528\u5177\u6709\u6301\u4e45\u5316\u529f\u80fd\u7684\u5b58\u50a8\u4ecb\u8d28\u6765\u5b58\u50a8\u4e8b\u4ef6\u6d88\u606f\uff0c\u4f8b\u5982\u901a\u8fc7\u6570\u636e\u5e93\u6216\u8005\u5176\u4ed6NoSql\u8bbe\u65bd\u3002CAP \u4f7f\u7528\u8fd9\u79cd\u65b9\u5f0f\u6765\u5e94\u5bf9\u4e00\u5207\u73af\u5883\u6216\u8005\u7f51\u7edc\u5f02\u5e38\u5bfc\u81f4\u6d88\u606f\u4e22\u5931\u7684\u60c5\u51b5\uff0c\u6d88\u606f\u7684\u53ef\u9760\u6027\u662f\u5206\u5e03\u5f0f\u4e8b\u52a1\u7684\u57fa\u77f3\uff0c\u6240\u4ee5\u5728\u4efb\u4f55\u60c5\u51b5\u4e0b\u6d88\u606f\u90fd\u4e0d\u80fd\u4e22\u5931\u3002</p>"},{"location":"user-guide/zh/storage/general/#_2","title":"\u6301\u4e45\u5316","text":""},{"location":"user-guide/zh/storage/general/#_3","title":"\u53d1\u9001\u524d","text":"<p>\u5728\u6d88\u606f\u8fdb\u5165\u5230\u6d88\u606f\u961f\u5217\u4e4b\u524d\uff0cCAP\u4f7f\u7528\u672c\u5730\u6570\u636e\u5e93\u8868\u5bf9\u6d88\u606f\u8fdb\u884c\u6301\u4e45\u5316\uff0c\u8fd9\u6837\u53ef\u4ee5\u4fdd\u8bc1\u5f53\u6d88\u606f\u961f\u5217\u51fa\u73b0\u5f02\u5e38\u6216\u8005\u7f51\u7edc\u9519\u8bef\u65f6\u5019\u6d88\u606f\u662f\u6ca1\u6709\u4e22\u5931\u7684\u3002</p> <p>\u4e3a\u4e86\u4fdd\u8bc1\u8fd9\u79cd\u673a\u5236\u7684\u53ef\u9760\u6027\uff0cCAP\u4f7f\u7528\u548c\u4e1a\u52a1\u4ee3\u7801\u76f8\u540c\u7684\u6570\u636e\u5e93\u4e8b\u52a1\u6765\u4fdd\u8bc1\u4e1a\u52a1\u64cd\u4f5c\u548cCAP\u7684\u6d88\u606f\u5728\u6301\u4e45\u5316\u7684\u8fc7\u7a0b\u4e2d\u662f\u5f3a\u4e00\u81f4\u7684\u3002\u4e5f\u5c31\u662f\u8bf4\u5728\u8fdb\u884c\u6d88\u606f\u6301\u4e45\u5316\u7684\u8fc7\u7a0b\u4e2d\uff0c\u4efb\u4f55\u4e00\u65b9\u53d1\u751f\u5f02\u5e38\u60c5\u51b5\u6570\u636e\u5e93\u90fd\u4f1a\u8fdb\u884c\u56de\u6eda\u64cd\u4f5c\u3002</p>"},{"location":"user-guide/zh/storage/general/#_4","title":"\u53d1\u9001\u540e","text":"<p>\u6d88\u606f\u8fdb\u5165\u5230\u6d88\u606f\u961f\u5217\u4e4b\u540e\uff0cCAP\u4f1a\u542f\u52a8\u6d88\u606f\u961f\u5217\u7684\u6301\u4e45\u5316\u529f\u80fd\uff0c\u6211\u4eec\u9700\u8981\u8bf4\u660e\u4e00\u4e0b\u5728 RabbitMQ \u548c Kafka \u4e2dCAP\u7684\u6d88\u606f\u662f\u5982\u4f55\u6301\u4e45\u5316\u7684\u3002</p> <p>\u9488\u5bf9\u4e8e RabbitMQ \u4e2d\u7684\u6d88\u606f\u6301\u4e45\u5316\uff0cCAP \u4f7f\u7528\u7684\u662f\u5177\u6709\u6d88\u606f\u6301\u4e45\u5316\u529f\u80fd\u7684\u6d88\u8d39\u8005\u961f\u5217\uff0c\u4f46\u662f\u8fd9\u91cc\u9762\u53ef\u80fd\u6709\u4f8b\u5916\u60c5\u51b5\uff0c\u53c2\u52a0 2.2.1 \u7ae0\u8282\u3002</p> <p>\u7531\u4e8e Kafka \u5929\u751f\u8bbe\u8ba1\u7684\u5c31\u662f\u4f7f\u7528\u6587\u4ef6\u8fdb\u884c\u7684\u6d88\u606f\u6301\u4e45\u5316\uff0c\u5728\u6240\u4ee5\u5728\u6d88\u606f\u8fdb\u5165\u5230Kafka\u4e4b\u540e\uff0cKafka\u4f1a\u4fdd\u8bc1\u6d88\u606f\u80fd\u591f\u6b63\u786e\u88ab\u6301\u4e45\u5316\u800c\u4e0d\u4e22\u5931\u3002</p>"},{"location":"user-guide/zh/storage/general/#_5","title":"\u6d88\u606f\u5b58\u50a8","text":""},{"location":"user-guide/zh/storage/general/#_6","title":"\u652f\u6301\u7684\u5b58\u50a8","text":"<p>CAP \u652f\u6301\u4ee5\u4e0b\u51e0\u79cd\u5177\u6709\u4e8b\u52a1\u652f\u6301\u7684\u6570\u636e\u5e93\u505a\u4e3a\u5b58\u50a8\uff1a</p> <ul> <li>SQL Server</li> <li>MySQL</li> <li>PostgreSql</li> <li>MongoDB</li> <li>In-Memory Storage</li> </ul> <p>\u5728 CAP \u542f\u52a8\u540e\uff0c\u4f1a\u5411\u6301\u4e45\u5316\u4ecb\u8d28\u4e2d\u751f\u6210\u4e24\u4e2a\u8868\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u540d\u79f0\u4e3a\uff1a<code>Cap.Published</code> <code>Cap.Received</code>\u3002</p>"},{"location":"user-guide/zh/storage/general/#_7","title":"\u5b58\u50a8\u683c\u5f0f","text":"<p>Published \u8868\u7ed3\u6784\uff1a</p> NAME DESCRIPTION TYPE Id Message Id int Version Message Version string Name Topic Name string Content Json Content string Added Added Time DateTime ExpiresAt Expire time DateTime Retries Retry times int StatusName Status Name string <p>Received \u8868\u7ed3\u6784\uff1a</p> NAME DESCRIPTION TYPE Id Message Id int Version Message Version string Name Topic Name string Group Group Name string Content Json Content string Added Added Time DateTime ExpiresAt Expire time DateTime Retries Retry times int StatusName Status Name string <p>Lock \u8868\u7ed3\u6784\uff08\u53ef\u9009\uff09\uff1a</p> NAME DESCRIPTION TYPE Key Lock Id string Instance Acquired instance of lock string LastLockTime Last acquired lock time DateTime"},{"location":"user-guide/zh/storage/general/#_8","title":"\u5305\u88c5\u5668\u5bf9\u8c61","text":"<p>CAP \u5728\u8fdb\u884c\u6d88\u606f\u53d1\u9001\u5230\u65f6\u5019\uff0c\u4f1a\u5bf9\u539f\u59cb\u6d88\u606f\u5bf9\u8c61\u8fdb\u884c\u4e00\u4e2a\u4e8c\u6b21\u5305\u88c5\u5b58\u50a8\u5230 <code>Content</code> \u5b57\u6bb5\u4e2d\uff0c\u4ee5\u4e0b\u4e3a\u5305\u88c5 Content \u7684 Message \u5bf9\u8c61\u6570\u636e\u7ed3\u6784\uff1a</p> NAME DESCRIPTION TYPE Id CAP\u751f\u6210\u7684\u6d88\u606f\u7f16\u53f7 string Timestamp \u6d88\u606f\u521b\u5efa\u65f6\u95f4 string Content \u5185\u5bb9 string CallbackName \u56de\u8c03\u7684\u8ba2\u9605\u8005\u540d\u79f0 string <p>\u5176\u4e2d Id \u5b57\u6bb5\uff0cCAP \u91c7\u7528\u7684 MongoDB \u4e2d\u7684 ObjectId \u5206\u5e03\u5f0fId\u751f\u6210\u7b97\u6cd5\u751f\u6210\u3002</p>"},{"location":"user-guide/zh/storage/general/#_9","title":"\u793e\u533a\u652f\u6301\u7684\u6301\u4e45\u5316","text":"<p>\u611f\u8c22\u793e\u533a\u5bf9CAP\u7684\u652f\u6301\uff0c\u4ee5\u4e0b\u662f\u793e\u533a\u652f\u6301\u7684\u6301\u4e45\u5316\u7684\u5b9e\u73b0</p> <ul> <li> <p>SQLite (@colinin) \uff1ahttps://github.com/colinin/DotNetCore.CAP.Sqlite </p> </li> <li> <p>LiteDB (@maikebing) \uff1ahttps://github.com/maikebing/CAP.Extensions</p> </li> <li> <p>SQLite &amp; Oracle (@cocosip) \uff1ahttps://github.com/cocosip/CAP-Extensions </p> </li> <li> <p>SmartSql (@xiangxiren) \uff1ahttps://github.com/xiangxiren/SmartSql.CAP </p> </li> </ul>"},{"location":"user-guide/zh/storage/in-memory-storage/","title":"In-Memory Storage","text":"<p>\u5185\u5b58\u6d88\u606f\u7684\u6301\u4e45\u5316\u5b58\u50a8\u5e38\u7528\u4e8e\u5f00\u53d1\u548c\u6d4b\u8bd5\u73af\u5883\uff0c\u5982\u679c\u4f7f\u7528\u57fa\u4e8e\u5185\u5b58\u7684\u5b58\u50a8\u5219\u4f60\u4f1a\u5931\u53bb\u672c\u5730\u4e8b\u52a1\u6d88\u606f\u53ef\u9760\u6027\u4fdd\u8bc1\u3002</p>"},{"location":"user-guide/zh/storage/in-memory-storage/#_1","title":"\u914d\u7f6e","text":"<p>\u5982\u679c\u8981\u4f7f\u7528\u5185\u5b58\u5b58\u50a8\uff0c\u4f60\u9700\u8981\u4ece NuGet \u5b89\u88c5\u4ee5\u4e0b\u6269\u5c55\u5305\uff1a</p> <pre><code>Install-Package DotNetCore.CAP.InMemoryStorage\n</code></pre> <p>\u7136\u540e\uff0c\u4f60\u53ef\u4ee5\u5728 <code>Startup.cs</code> \u7684 <code>ConfigureServices</code> \u65b9\u6cd5\u4e2d\u6dfb\u52a0\u57fa\u4e8e\u5185\u5b58\u7684\u914d\u7f6e\u9879\u3002</p> <pre><code>public void ConfigureServices(IServiceCollection services)\n{\n// ...\n\nservices.AddCap(x =&gt;\n{\nx.UseInMemoryStorage();\n// x.UseXXX ...\n});\n}\n</code></pre> <p>\u5185\u5b58\u4e2d\u7684\u53d1\u9001\u6210\u529f\u6d88\u606f\uff0cCAP \u5c06\u4f1a\u6bcf 5\u5206\u949f \u8fdb\u884c\u4e00\u6b21\u6e05\u7406\u3002</p>"},{"location":"user-guide/zh/storage/in-memory-storage/#publish-with-transaction","title":"Publish with transaction","text":"<p>In-Memory \u5b58\u50a8 \u4e0d\u652f\u6301 \u4e8b\u52a1\u65b9\u5f0f\u53d1\u9001\u6d88\u606f\u3002</p>"},{"location":"user-guide/zh/storage/mongodb/","title":"MongoDB","text":"<p>MongoDB \u662f\u4e00\u4e2a\u8de8\u5e73\u53f0\u7684\u9762\u5411\u6587\u6863\u578b\u7684\u6570\u636e\u5e93\u7a0b\u5e8f\uff0c\u5b83\u88ab\u5f52\u4e3a NOSQL \u6570\u636e\u5e93\uff0cCAP \u4ece 2.3 \u7248\u672c\u5f00\u59cb\u652f\u6301 MongoDB \u4f5c\u4e3a\u6d88\u606f\u5b58\u50a8\u3002 </p> <p>MongoDB \u4ece 4.0 \u7248\u672c\u5f00\u59cb\u652f\u6301 ACID \u4e8b\u52a1\uff0c\u6240\u4ee5 CAP \u4e5f\u53ea\u652f\u6301 4.0 \u4ee5\u4e0a\u7684 MongoDB\uff0c\u5e76\u4e14 MongoDB \u9700\u8981\u90e8\u7f72\u4e3a\u96c6\u7fa4\uff0c\u56e0\u4e3a MongoDB \u7684 ACID \u4e8b\u52a1\u9700\u8981\u96c6\u7fa4\u624d\u53ef\u4ee5\u4f7f\u7528\u3002</p> <p>\u6709\u5173\u5f00\u53d1\u73af\u5883\u5982\u4f55\u5feb\u901f\u642d\u5efa MongoDB 4.0+ \u96c6\u7fa4\uff0c\u4f60\u53ef\u4ee5\u6211\u7684\u53c2\u8003 \u8fd9\u7bc7\u6587\u7ae0\u3002</p>"},{"location":"user-guide/zh/storage/mongodb/#_1","title":"\u914d\u7f6e","text":"<p>\u8981\u4f7f\u7528 MongoDB \u5b58\u50a8\uff0c\u4f60\u9700\u8981\u4ece NuGet \u5b89\u88c5\u4ee5\u4e0b\u6269\u5c55\u5305\uff1a</p> <pre><code>Install-Package DotNetCore.CAP.MongoDB\n</code></pre> <p>\u7136\u540e\uff0c\u4f60\u53ef\u4ee5\u5728 <code>Startup.cs</code> \u7684 <code>ConfigureServices</code> \u65b9\u6cd5\u4e2d\u6dfb\u52a0\u57fa\u4e8e\u5185\u5b58\u7684\u914d\u7f6e\u9879\u3002</p> <pre><code>public void ConfigureServices(IServiceCollection services)\n{\n// ...\n\nservices.AddCap(x =&gt;\n{\nx.UseMongoDB(opt=&gt;{\n//MongoDBOptions\n});\n// x.UseXXX ...\n});\n}\n</code></pre>"},{"location":"user-guide/zh/storage/mongodb/#_2","title":"\u914d\u7f6e\u9879","text":"NAME DESCRIPTION TYPE DEFAULT DatabaseName \u6570\u636e\u5e93\u540d\u79f0 string cap DatabaseConnection \u6570\u636e\u5e93\u8fde\u63a5\u5b57\u7b26\u4e32 string mongodb://localhost:27017 ReceivedCollection \u63a5\u6536\u6d88\u606f\u96c6\u5408\u540d\u79f0 string cap.received PublishedCollection \u53d1\u9001\u6d88\u606f\u96c6\u5408\u540d\u79f0 string cap.published"},{"location":"user-guide/zh/storage/mongodb/#_3","title":"\u4f7f\u7528\u4e8b\u52a1\u53d1\u5e03\u6d88\u606f","text":"<p>\u4e0b\u9762\u7684\u793a\u4f8b\u5c55\u793a\u4e86\u5982\u4f55\u5229\u7528 CAP \u548c MongoDB \u8fdb\u884c\u672c\u5730\u4e8b\u52a1\u96c6\u6210\u3002</p> <pre><code>//NOTE: before your test, your need to create database and collection at first\n//\u6ce8\u610f\uff1aMongoDB \u4e0d\u80fd\u5728\u4e8b\u52a1\u4e2d\u521b\u5efa\u6570\u636e\u5e93\u548c\u96c6\u5408\uff0c\u6240\u4ee5\u4f60\u9700\u8981\u5355\u72ec\u521b\u5efa\u5b83\u4eec\uff0c\u6a21\u62df\u4e00\u6761\u8bb0\u5f55\u63d2\u5165\u5219\u4f1a\u81ea\u52a8\u521b\u5efa        \n//var mycollection = _client.GetDatabase(\"test\").GetCollection&lt;BsonDocument&gt;(\"test.collection\");\n//mycollection.InsertOne(new BsonDocument { { \"test\", \"test\" } });\n\nusing (var session = _client.StartTransaction(_capBus, autoCommit: false))\n{\nvar collection = _client.GetDatabase(\"test\").GetCollection&lt;BsonDocument&gt;(\"test.collection\");\ncollection.InsertOne(session, new BsonDocument { { \"hello\", \"world\" } });\n\n_capBus.Publish(\"sample.rabbitmq.mongodb\", DateTime.Now);\n\nsession.CommitTransaction();\n}\n</code></pre>"},{"location":"user-guide/zh/storage/mysql/","title":"MySQL","text":"<p>MySQL \u662f\u4e00\u4e2a\u5f00\u6e90\u7684\u5173\u7cfb\u578b\u6570\u636e\u5e93\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528 MySQL \u6765\u4f5c\u4e3a CAP \u6d88\u606f\u7684\u6301\u4e45\u5316\u3002</p>"},{"location":"user-guide/zh/storage/mysql/#_1","title":"\u914d\u7f6e","text":"<p>\u8981\u4f7f\u7528 MySQL \u5b58\u50a8\uff0c\u4f60\u9700\u8981\u4ece NuGet \u5b89\u88c5\u4ee5\u4e0b\u6269\u5c55\u5305\uff1a</p> <pre><code>Install-Package DotNetCore.CAP.MySql\n</code></pre> <p>\u7136\u540e\uff0c\u4f60\u53ef\u4ee5\u5728 <code>Startup.cs</code> \u7684 <code>ConfigureServices</code> \u65b9\u6cd5\u4e2d\u6dfb\u52a0\u57fa\u4e8e\u5185\u5b58\u7684\u914d\u7f6e\u9879\u3002</p> <pre><code>public void ConfigureServices(IServiceCollection services)\n{\n// ...\n\nservices.AddCap(x =&gt;\n{\nx.UseMySql(opt=&gt;{\n//MySqlOptions\n});\n// x.UseXXX ...\n});\n}\n</code></pre>"},{"location":"user-guide/zh/storage/mysql/#_2","title":"\u914d\u7f6e\u9879","text":"NAME DESCRIPTION TYPE DEFAULT TableNamePrefix Cap\u8868\u540d\u524d\u7f00 string cap ConnectionString \u6570\u636e\u5e93\u8fde\u63a5\u5b57\u7b26\u4e32 string null"},{"location":"user-guide/zh/storage/mysql/#_3","title":"\u81ea\u5b9a\u4e49\u8868\u540d\u79f0","text":"<p>\u4f60\u53ef\u4ee5\u901a\u8fc7\u91cd\u5199 <code>IStorageInitializer</code> \u63a5\u53e3\u83b7\u53d6\u8868\u540d\u79f0\u7684\u65b9\u6cd5\u6765\u505a\u5230\u8fd9\u4e00\u70b9</p> <p>\u793a\u4f8b\u4ee3\u7801\uff1a</p> <p><pre><code>public class MyTableInitializer : MySqlStorageInitializer\n{\npublic override string GetPublishedTableName()\n{\n//\u4f60\u7684 \u53d1\u9001\u6d88\u606f\u8868 \u540d\u79f0\n}\n\npublic override string GetReceivedTableName()\n{\n//\u4f60\u7684 \u63a5\u6536\u6d88\u606f\u8868 \u540d\u79f0\n}\n}\n</code></pre> \u7136\u540e\u5c06\u4f60\u7684\u5b9e\u73b0\u6ce8\u518c\u5230\u5bb9\u5668\u4e2d</p> <pre><code>services.AddSingleton&lt;IStorageInitializer, MyTableInitializer&gt;();\n</code></pre>"},{"location":"user-guide/zh/storage/mysql/#_4","title":"\u4f7f\u7528\u4e8b\u52a1\u53d1\u5e03\u6d88\u606f","text":""},{"location":"user-guide/zh/storage/mysql/#adonet","title":"ADO.NET","text":"<pre><code>private readonly ICapPublisher _capBus;\n\nusing (var connection = new MySqlConnection(AppDbContext.ConnectionString))\n{\nusing (var transaction = connection.BeginTransaction(_capBus, autoCommit: false))\n{\n//your business code\nconnection.Execute(\"insert into test(name) values('test')\", transaction: (IDbTransaction)transaction.DbTransaction);\n\n_capBus.Publish(\"sample.rabbitmq.mysql\", DateTime.Now);\n\ntransaction.Commit();\n}\n}\n</code></pre>"},{"location":"user-guide/zh/storage/mysql/#entityframework","title":"EntityFramework","text":"<pre><code>private readonly ICapPublisher _capBus;\n\nusing (var trans = dbContext.Database.BeginTransaction(_capBus, autoCommit: false))\n{\ndbContext.Persons.Add(new Person() { Name = \"ef.transaction\" });\n\n_capBus.Publish(\"sample.rabbitmq.mysql\", DateTime.Now);\n\ndbContext.SaveChanges();\ntrans.Commit();\n}\n</code></pre>"},{"location":"user-guide/zh/storage/postgresql/","title":"Postgre SQL","text":"<p>PostgreSQL \u662f\u4e00\u4e2a\u5f00\u6e90\u7684\u5173\u7cfb\u578b\u6570\u636e\u5e93\uff0c\u5b83\u5df2\u7ecf\u53d8\u5f97\u8d8a\u6765\u8d8a\u6d41\u884c\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528 Postgre SQL \u6765\u4f5c\u4e3a CAP \u6d88\u606f\u7684\u6301\u4e45\u5316\u3002</p>"},{"location":"user-guide/zh/storage/postgresql/#_1","title":"\u914d\u7f6e","text":"<p>\u8981\u4f7f\u7528 PostgreSQL \u5b58\u50a8\uff0c\u4f60\u9700\u8981\u4ece NuGet \u5b89\u88c5\u4ee5\u4e0b\u6269\u5c55\u5305\uff1a</p> <pre><code>Install-Package DotNetCore.CAP.PostgreSql\n</code></pre> <p>\u7136\u540e\uff0c\u4f60\u53ef\u4ee5\u5728 <code>Startup.cs</code> \u7684 <code>ConfigureServices</code> \u65b9\u6cd5\u4e2d\u6dfb\u52a0\u57fa\u4e8e\u5185\u5b58\u7684\u914d\u7f6e\u9879\u3002</p> <pre><code>public void ConfigureServices(IServiceCollection services)\n{\n// ...\n\nservices.AddCap(x =&gt;\n{\nx.UsePostgreSql(opt=&gt;{\n//PostgreSqlOptions\n}); // x.UseXXX ...\n});\n}\n</code></pre>"},{"location":"user-guide/zh/storage/postgresql/#_2","title":"\u914d\u7f6e\u9879","text":"NAME DESCRIPTION TYPE DEFAULT Schema \u6570\u636e\u5e93\u67b6\u6784 string cap ConnectionString \u6570\u636e\u5e93\u8fde\u63a5\u5b57\u7b26\u4e32 string"},{"location":"user-guide/zh/storage/postgresql/#_3","title":"\u81ea\u5b9a\u4e49\u8868\u540d\u79f0","text":"<p>\u4f60\u53ef\u4ee5\u901a\u8fc7\u91cd\u5199 <code>IStorageInitializer</code> \u63a5\u53e3\u83b7\u53d6\u8868\u540d\u79f0\u7684\u65b9\u6cd5\u6765\u505a\u5230\u8fd9\u4e00\u70b9</p> <p>\u793a\u4f8b\u4ee3\u7801\uff1a</p> <p><pre><code>public class MyTableInitializer : PostgreSqlStorageInitializer\n{\npublic override string GetPublishedTableName()\n{\n//\u4f60\u7684 \u53d1\u9001\u6d88\u606f\u8868 \u540d\u79f0\n}\n\npublic override string GetReceivedTableName()\n{\n//\u4f60\u7684 \u63a5\u6536\u6d88\u606f\u8868 \u540d\u79f0\n}\n}\n</code></pre> \u7136\u540e\u5c06\u4f60\u7684\u5b9e\u73b0\u6ce8\u518c\u5230\u5bb9\u5668\u4e2d</p> <pre><code>services.AddSingleton&lt;IStorageInitializer, MyTableInitializer&gt;();\n</code></pre>"},{"location":"user-guide/zh/storage/postgresql/#_4","title":"\u4f7f\u7528\u4e8b\u52a1\u53d1\u5e03\u6d88\u606f","text":""},{"location":"user-guide/zh/storage/postgresql/#adonet","title":"ADO.NET","text":"<pre><code>private readonly ICapPublisher _capBus;\n\nusing (var connection = new NpgsqlConnection(\"ConnectionString\"))\n{\nusing (var transaction = connection.BeginTransaction(_capBus, autoCommit: false))\n{\n//your business code\nconnection.Execute(\"insert into test(name) values('test')\", transaction: (IDbTransaction)transaction.DbTransaction);\n\n_capBus.Publish(\"sample.rabbitmq.mysql\", DateTime.Now);\n\ntransaction.Commit();\n}\n}\n</code></pre>"},{"location":"user-guide/zh/storage/postgresql/#entityframework","title":"EntityFramework","text":"<pre><code>private readonly ICapPublisher _capBus;\n\nusing (var trans = dbContext.Database.BeginTransaction(_capBus, autoCommit: false))\n{\ndbContext.Persons.Add(new Person() { Name = \"ef.transaction\" });\n\n_capBus.Publish(\"sample.rabbitmq.mysql\", DateTime.Now);\n\ndbContext.SaveChanges();\ntrans.Commit();\n}\n</code></pre>"},{"location":"user-guide/zh/storage/sqlserver/","title":"SQL Server","text":"<p>SQL Server \u662f\u7531\u5fae\u8f6f\u5f00\u53d1\u7684\u4e00\u4e2a\u5173\u7cfb\u578b\u6570\u636e\u5e93\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528 SQL Server \u6765\u4f5c\u4e3a CAP \u6d88\u606f\u7684\u6301\u4e45\u5316\u3002</p> <p>\u6ce8\u610f</p> <p>\u6211\u4eec\u76ee\u524d\u4f7f\u7528 <code>Microsoft.Data.SqlClient</code> \u4f5c\u4e3a\u6570\u636e\u5e93\u9a71\u52a8\u7a0b\u5e8f\uff0c\u5b83\u662fSQL Server \u9a71\u52a8\u7684\u672a\u6765\uff0c\u5e76\u4e14\u5df2\u7ecf\u653e\u5f03\u4e86 <code>System.Data.SqlClient</code>\uff0c\u6211\u4eec\u5efa\u8bae\u4f60\u5207\u6362\u8fc7\u53bb\u3002</p>"},{"location":"user-guide/zh/storage/sqlserver/#_1","title":"\u914d\u7f6e","text":"<p>\u8981\u4f7f\u7528 SQL Server \u5b58\u50a8\uff0c\u4f60\u9700\u8981\u4ece NuGet \u5b89\u88c5\u4ee5\u4e0b\u6269\u5c55\u5305\uff1a</p> <pre><code>Install-Package DotNetCore.CAP.SqlServer\n</code></pre> <p>\u7136\u540e\uff0c\u4f60\u53ef\u4ee5\u5728 <code>Startup.cs</code> \u7684 <code>ConfigureServices</code> \u65b9\u6cd5\u4e2d\u6dfb\u52a0\u57fa\u4e8e\u5185\u5b58\u7684\u914d\u7f6e\u9879\u3002</p> <pre><code>public void ConfigureServices(IServiceCollection services)\n{\n// ...\n\nservices.AddCap(x =&gt;\n{\nx.UseSqlServer(opt=&gt;{\n//SqlServerOptions\n}); // x.UseXXX ...\n});\n}\n</code></pre>"},{"location":"user-guide/zh/storage/sqlserver/#_2","title":"\u914d\u7f6e\u9879","text":"NAME DESCRIPTION TYPE DEFAULT Schema \u6570\u636e\u5e93\u67b6\u6784 string Cap ConnectionString \u6570\u636e\u5e93\u8fde\u63a5\u5b57\u7b26\u4e32 string"},{"location":"user-guide/zh/storage/sqlserver/#_3","title":"\u81ea\u5b9a\u4e49\u8868\u540d\u79f0","text":"<p>\u4f60\u53ef\u4ee5\u901a\u8fc7\u91cd\u5199 <code>IStorageInitializer</code> \u63a5\u53e3\u83b7\u53d6\u8868\u540d\u79f0\u7684\u65b9\u6cd5\u6765\u505a\u5230\u8fd9\u4e00\u70b9</p> <p>\u793a\u4f8b\u4ee3\u7801\uff1a</p> <p><pre><code>public class MyTableInitializer : SqlServerStorageInitializer\n{\npublic override string GetPublishedTableName()\n{\n//\u4f60\u7684 \u53d1\u9001\u6d88\u606f\u8868 \u540d\u79f0\n}\n\npublic override string GetReceivedTableName()\n{\n//\u4f60\u7684 \u63a5\u6536\u6d88\u606f\u8868 \u540d\u79f0\n}\n}\n</code></pre> \u7136\u540e\u5c06\u4f60\u7684\u5b9e\u73b0\u6ce8\u518c\u5230\u5bb9\u5668\u4e2d</p> <pre><code>services.AddSingleton&lt;IStorageInitializer, MyTableInitializer&gt;();\n</code></pre>"},{"location":"user-guide/zh/storage/sqlserver/#_4","title":"\u4f7f\u7528\u4e8b\u52a1\u53d1\u5e03\u6d88\u606f","text":""},{"location":"user-guide/zh/storage/sqlserver/#adonet","title":"ADO.NET","text":"<pre><code>private readonly ICapPublisher _capBus;\n\nusing (var connection = new SqlConnection(\"ConnectionString\"))\n{\nusing (var transaction = connection.BeginTransaction(_capBus, autoCommit: false))\n{\n//your business code\nconnection.Execute(\"insert into test(name) values('test')\", transaction: (IDbTransaction)transaction.DbTransaction);\n\n_capBus.Publish(\"sample.rabbitmq.mysql\", DateTime.Now);\n\ntransaction.Commit();\n}\n}\n</code></pre>"},{"location":"user-guide/zh/storage/sqlserver/#entityframework","title":"EntityFramework","text":"<pre><code>private readonly ICapPublisher _capBus;\n\nusing (var trans = dbContext.Database.BeginTransaction(_capBus, autoCommit: false))\n{\ndbContext.Persons.Add(new Person() { Name = \"ef.transaction\" });\n\n_capBus.Publish(\"sample.rabbitmq.mysql\", DateTime.Now);\n\ndbContext.SaveChanges();\ntrans.Commit();\n}\n</code></pre>"},{"location":"user-guide/zh/transport/aws-sqs/","title":"Amazon SQS","text":"<p>AWS SQS \u662f\u4e00\u79cd\u5b8c\u5168\u6258\u7ba1\u7684\u6d88\u606f\u961f\u5217\u670d\u52a1\uff0c\u53ef\u8ba9\u60a8\u5206\u79bb\u548c\u6269\u5c55\u5fae\u670d\u52a1\u3001\u5206\u5e03\u5f0f\u7cfb\u7edf\u548c\u65e0\u670d\u52a1\u5668\u5e94\u7528\u7a0b\u5e8f\u3002</p> <p>AWS SNS \u662f\u4e00\u79cd\u9ad8\u5ea6\u53ef\u7528\u3001\u6301\u4e45\u3001\u5b89\u5168\u3001\u5b8c\u5168\u6258\u7ba1\u7684\u53d1\u5e03/\u8ba2\u9605\u6d88\u606f\u6536\u53d1\u670d\u52a1\uff0c\u53ef\u4ee5\u8f7b\u677e\u5206\u79bb\u5fae\u670d\u52a1\u3001\u5206\u5e03\u5f0f\u7cfb\u7edf\u548c\u65e0\u670d\u52a1\u5668\u5e94\u7528\u7a0b\u5e8f\u3002</p>"},{"location":"user-guide/zh/transport/aws-sqs/#cap-aws-sns-sqs","title":"CAP \u5982\u4f55\u4f7f\u7528 AWS SNS &amp; SQS","text":""},{"location":"user-guide/zh/transport/aws-sqs/#sns","title":"SNS","text":"<p>\u7531\u4e8e CAP \u662f\u57fa\u4e8e Topic \u6a21\u5f0f\u5de5\u4f5c\u7684\uff0c\u6240\u4ee5\u9700\u8981\u4f7f\u7528\u5230 AWS SNS\uff0cSNS \u7b80\u5316\u4e86\u6d88\u606f\u7684\u53d1\u5e03\u8ba2\u9605\u67b6\u6784\u3002</p> <p>\u5728 CAP \u542f\u52a8\u65f6\u4f1a\u5c06\u6240\u6709\u7684\u8ba2\u9605\u540d\u79f0\u6ce8\u518c\u4e3a SNS \u7684 Topic\uff0c\u4f60\u5c06\u4f1a\u5728\u7ba1\u7406\u63a7\u5236\u53f0\u4e2d\u770b\u5230\u6240\u6709\u5df2\u7ecf\u6ce8\u518c\u7684 Topic \u5217\u8868\u3002 </p> <p>\u7531\u4e8e SNS \u4e0d\u652f\u6301\u4f7f\u7528 <code>.</code> <code>:</code> \u7b49\u7b26\u53f7\u4f5c\u4e3a Topic \u7684\u540d\u79f0\uff0c\u6240\u4ee5\u6211\u4eec\u8fdb\u884c\u4e86\u66ff\u6362\uff0c\u6211\u4eec\u5c06 <code>.</code> \u66ff\u6362\u4e3a\u4e86 <code>-</code>\uff0c\u5c06 <code>:</code> \u66ff\u6362\u4e3a\u4e86 <code>_</code></p> <p>\u6ce8\u610f\u4e8b\u9879</p> <p>Amazon SNS \u5f53\u524d\u5141\u8bb8\u53d1\u5e03\u7684\u6d88\u606f\u6700\u5927\u5927\u5c0f\u4e3a 256KB</p> <p>\u4e3e\u4f8b\uff0c\u4f60\u7684\u5f53\u524d\u9879\u76ee\u4e2d\u6709\u4ee5\u4e0b\u4e24\u4e2a\u8ba2\u9605\u8005\u65b9\u6cd5</p> <pre><code>[CapSubscribe(\"sample.sns.foo\")]\npublic void TestFoo(DateTime value)\n{\n}\n\n[CapSubscribe(\"sample.sns.bar\")]\npublic void TestBar(DateTime value)\n{\n}\n</code></pre> <p>\u5728 CAP \u542f\u52a8\u540e\uff0c\u5728 AWS SNS \u4e2d\u4f60\u5c06\u770b\u5230</p> <p></p>"},{"location":"user-guide/zh/transport/aws-sqs/#sqs","title":"SQS","text":"<p>\u9488\u5bf9\u6bcf\u4e2a\u6d88\u8d39\u8005\u7ec4\uff0cCAP \u5c06\u521b\u5efa\u4e00\u4e2a\u4e0e\u4e4b\u5bf9\u5e94\u7684 SQS \u961f\u5217\uff0c\u961f\u5217\u7684\u540d\u79f0\u4e3a\u914d\u7f6e\u9879\u4e2d DefaultGroup \u7684\u540d\u79f0\uff0c\u7c7b\u578b\u4e3a Standard Queue \u3002</p> <p>\u8be5 SQS \u961f\u5217\u5c06\u8ba2\u9605 SNS \u4e2d\u7684 Topic \uff0c\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u6ce8\u610f\u4e8b\u9879</p> <p>\u7531\u4e8e AWS SNS \u7684\u9650\u5236\uff0c\u5f53\u4f60\u51cf\u5c11\u8ba2\u9605\u65b9\u6cd5\u65f6\uff0c\u6211\u4eec\u4e0d\u4f1a\u4e3b\u52a8\u5220\u9664 AWS SNS \u6216\u8005 SQS \u4e0a\u7684\u76f8\u5173 Topic \u6216 Queue\uff0c\u4f60\u9700\u8981\u624b\u52a8\u5220\u9664\u4ed6\u4eec\u3002</p>"},{"location":"user-guide/zh/transport/aws-sqs/#_1","title":"\u914d\u7f6e","text":"<p>\u8981\u4f7f\u7528 AWS SQS \u4f5c\u4e3a\u6d88\u606f\u4f20\u8f93\u5668\uff0c\u4f60\u9700\u8981\u4ece NuGet \u5b89\u88c5\u4ee5\u4e0b\u6269\u5c55\u5305\uff1a</p> <pre><code>Install-Package DotNetCore.CAP.AmazonSQS\n</code></pre> <p>\u7136\u540e\uff0c\u4f60\u53ef\u4ee5\u5728 <code>Startup.cs</code> \u7684 <code>ConfigureServices</code> \u65b9\u6cd5\u4e2d\u6dfb\u52a0\u57fa\u4e8e RabbitMQ \u7684\u914d\u7f6e\u9879\u3002</p> <pre><code>public void ConfigureServices(IServiceCollection services)\n{\n// ...\n\nservices.AddCap(x =&gt;\n{\nx.UseAmazonSQS(opt=&gt;\n{\n//AmazonSQSOptions\n});\n// x.UseXXX ...\n});\n}\n</code></pre>"},{"location":"user-guide/zh/transport/aws-sqs/#amazonsqs-options","title":"AmazonSQS Options","text":"<p>CAP \u76f4\u63a5\u5bf9\u5916\u63d0\u4f9b\u7684 AmazonSQSOptions \u914d\u7f6e\u53c2\u6570\u5982\u4e0b\uff1a</p> NAME DESCRIPTION TYPE DEFAULT Region AWS \u6240\u5904\u7684\u533a\u57df Amazon.RegionEndpoint Credentials AWS AK SK\u4fe1\u606f Amazon.Runtime.AWSCredentials <p>\u5982\u679c\u4f60\u7684\u9879\u76ee\u8fd0\u884c\u5728 AWS EC2 \u4e2d\uff0c\u5219\u4e0d\u9700\u8981\u8bbe\u7f6e Credentials\uff0c\u76f4\u63a5\u5bf9 EC2 \u5e94\u7528 IAM \u7b56\u7565\u5373\u53ef\u3002</p> <p>Credentials \u9700\u8981\u5177\u6709\u65b0\u589e\u548c\u8ba2\u9605 SNS Topic\uff0cSQS Queue \u7b49\u6743\u9650\u3002</p>"},{"location":"user-guide/zh/transport/azure-service-bus/","title":"Azure Service Bus","text":"<p>Azure \u670d\u52a1\u603b\u7ebf\u662f\u4e00\u79cd\u591a\u79df\u6237\u4e91\u6d88\u606f\u670d\u52a1\uff0c\u53ef\u7528\u4e8e\u5728\u5e94\u7528\u7a0b\u5e8f\u548c\u670d\u52a1\u4e4b\u95f4\u53d1\u9001\u4fe1\u606f\u3002 \u5f02\u6b65\u64cd\u4f5c\u53ef\u5b9e\u73b0\u7075\u6d3b\u7684\u4e2d\u8f6c\u6d88\u606f\u4f20\u9001\u3001\u7ed3\u6784\u5316\u7684\u5148\u8fdb\u5148\u51fa (FIFO) \u6d88\u606f\u4f20\u9001\u4ee5\u53ca\u53d1\u5e03/\u8ba2\u9605\u529f\u80fd\u3002</p> <p>CAP \u652f\u6301\u4f7f\u7528 Azure Service Bus \u4f5c\u4e3a\u6d88\u606f\u4f20\u8f93\u5668\u3002</p>"},{"location":"user-guide/zh/transport/azure-service-bus/#configuration","title":"Configuration","text":"<p>\u5fc5\u987b\u6761\u4ef6</p> <p>\u9488\u5bf9 Service Bus \u7684\u5b9a\u4ef7, CAP \u8981\u6c42\u4f7f\u7528  \u201c\u6807\u51c6\u201d \u6216\u8005 \u201c\u9ad8\u7ea7\u201d \u4ee5\u652f\u6301 Topic \u529f\u80fd\u3002</p> <p>\u8981\u4f7f\u7528 Azure Service Bus \u4f5c\u4e3a\u6d88\u606f\u4f20\u8f93\u5668\uff0c\u4f60\u9700\u8981\u4ece NuGet \u5b89\u88c5\u4ee5\u4e0b\u6269\u5c55\u5305\uff1a</p> <pre><code>Install-Package DotNetCore.CAP.AzureServiceBus\n</code></pre> <p>\u7136\u540e\uff0c\u4f60\u53ef\u4ee5\u5728 <code>Startup.cs</code> \u7684 <code>ConfigureServices</code> \u65b9\u6cd5\u4e2d\u6dfb\u52a0\u57fa\u4e8e\u5185\u5b58\u7684\u914d\u7f6e\u9879\u3002</p> <pre><code>public void ConfigureServices(IServiceCollection services)\n{\n// ...\n\nservices.AddCap(x =&gt;\n{\nx.UseAzureServiceBus(opt=&gt;\n{\n//AzureServiceBusOptions\n});\n// x.UseXXX ...\n});\n}\n</code></pre>"},{"location":"user-guide/zh/transport/azure-service-bus/#azureservicebus-options","title":"AzureServiceBus Options","text":"<p>CAP \u76f4\u63a5\u5bf9\u5916\u63d0\u4f9b\u7684 Azure Service Bus \u914d\u7f6e\u53c2\u6570\u5982\u4e0b\uff1a</p> NAME DESCRIPTION TYPE DEFAULT ConnectionString Endpoint \u5730\u5740 string EnableSessions Enable Service bus sessions bool false TopicPath Topic entity path string cap ManagementTokenProvider Token provider ITokenProvider null AutoCompleteMessages \u83b7\u53d6\u4e00\u4e2a\u503c\uff0c\u8be5\u503c\u6307\u793a\u5904\u7406\u5668\u662f\u5426\u5e94\u5728\u6d88\u606f\u5904\u7406\u7a0b\u5e8f\u5b8c\u6210\u5904\u7406\u540e\u81ea\u52a8\u5b8c\u6210\u6d88\u606f bool false CustomHeaders \u4e3a\u6765\u81ea\u5f02\u6784\u7cfb\u7edf\u7684\u4f20\u5165\u6d88\u606f\u6dfb\u52a0\u81ea\u5b9a\u4e49\u5934 <code>Func&lt;Message, List&lt;KeyValuePair&lt;string, string&gt;&gt;&gt;?</code> null Namespace Servicebus \u7684\u547d\u540d\u7a7a\u95f4\uff0c\u4e0e TokenCredential \u5c5e\u6027\u4e00\u8d77\u4f7f\u7528\u65f6\u9700\u8981\u8bbe\u7f6e string null SQLFilters \u6839\u636e\u540d\u79f0\u548c\u8868\u8fbe\u5f0f\u81ea\u5b9a\u4e49 SQL \u8fc7\u6ee4\u5668 List&gt; null"},{"location":"user-guide/zh/transport/azure-service-bus/#sessions","title":"Sessions","text":"<p>\u5f53\u4f7f\u7528 <code>EnableSessions</code> \u9009\u9879\u542f\u7528 sessions \u540e\uff0c\u6bcf\u4e2a\u53d1\u9001\u7684\u6d88\u606f\u90fd\u4f1a\u5177\u6709\u4e00\u4e2a session id\u3002 \u8981\u63a7\u5236 seesion id \u4f60\u53ef\u4ee5\u5728\u53d1\u9001\u6d88\u606f\u65f6\u5728\u6d88\u606f\u5934\u4e2d\u4f7f\u7528 <code>AzureServiceBusHeaders.SessionId</code> \u643a\u5e26\u5b83\u3002</p> <pre><code>ICapPublisher capBus = ...;\nstring yourEventName = ...;\nYourEventType yourEvent = ...;\n\nDictionary&lt;string, string&gt; extraHeaders = new Dictionary&lt;string, string&gt;();\nextraHeaders.Add(AzureServiceBusHeaders.SessionId, &lt;your-session-id&gt;);\n\ncapBus.Publish(yourEventName, yourEvent, extraHeaders);\n</code></pre> <p>\u5982\u679c\u5934\u4e2d\u6ca1\u6709 session id , \u90a3\u4e48\u6d88\u606f Id \u4ecd\u7136\u4f7f\u7528\u7684 Message Id.</p>"},{"location":"user-guide/zh/transport/azure-service-bus/#heterogeneous-systems","title":"Heterogeneous Systems","text":"<p>\u6709\u65f6\u60a8\u53ef\u80fd\u60f3\u63a5\u6536\u7531\u5916\u90e8\u7cfb\u7edf\u53d1\u5e03\u7684\u6d88\u606f\u3002 \u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u60a8\u9700\u8981\u6dfb\u52a0\u4e00\u7ec4\u4e24\u4e2a\u5f3a\u5236\u6807\u5934\u4ee5\u5b9e\u73b0 CAP \u517c\u5bb9\u6027\uff0c\u5982\u4e0b\u6240\u793a\u3002</p> <pre><code>c.UseAzureServiceBus(asb =&gt;\n{\nasb.ConnectionString = ...\nasb.CustomHeaders = message =&gt; new List&lt;KeyValuePair&lt;string, string&gt;&gt;()\n{\nnew(DotNetCore.CAP.Messages.Headers.MessageId,\nSnowflakeId.Default().NextId().ToString()),\nnew(DotNetCore.CAP.Messages.Headers.MessageName, message.Label)\n};\n});\n</code></pre> <p>\u91cd\u8981\u63d0\u793a\uff1a\u5982\u679c\u6d88\u606f\u4e2d\u5df2\u5b58\u5728\u540c\u540d\uff08Key\uff09\u7684\u6807\u5934\uff0c\u5219\u4e0d\u4f1a\u6dfb\u52a0\u81ea\u5b9a\u4e49\u6807\u5934\u3002 </p>"},{"location":"user-guide/zh/transport/general/","title":"\u8fd0\u8f93\u5668","text":"<p>\u901a\u8fc7\u8fd0\u8f93\u5c06\u6570\u636e\u4ece\u4e00\u4e2a\u5730\u65b9\u79fb\u52a8\u5230\u53e6\u4e00\u4e2a\u5730\u65b9-\u5728\u91c7\u96c6\u7a0b\u5e8f\u548c\u7ba1\u9053\u4e4b\u95f4\uff0c\u7ba1\u9053\u4e0e\u5b9e\u4f53\u6570\u636e\u5e93\u4e4b\u95f4\uff0c\u751a\u81f3\u5728\u7ba1\u9053\u4e0e\u5916\u90e8\u7cfb\u7edf\u4e4b\u95f4\u3002</p>"},{"location":"user-guide/zh/transport/general/#_2","title":"\u652f\u6301\u7684\u8fd0\u8f93\u5668","text":"<p>CAP \u652f\u6301\u4ee5\u4e0b\u51e0\u79cd\u8fd0\u8f93\u65b9\u5f0f\uff1a</p> <ul> <li>RabbitMQ</li> <li>Kafka</li> <li>Azure Service Bus</li> <li>Amazon SQS</li> <li>NATS</li> <li>In-Memory Queue</li> <li>Redis Streams</li> <li>Apache Pulsar</li> </ul>"},{"location":"user-guide/zh/transport/general/#_3","title":"\u600e\u4e48\u9009\u62e9\u8fd0\u8f93\u5668","text":"\ud83c\udff3\u200d\ud83c\udf08 RabbitMQ Kafka Azure Service Bus In-Memory \u5b9a\u4f4d \u53ef\u9760\u6d88\u606f\u4f20\u8f93 \u5b9e\u65f6\u6570\u636e\u5904\u7406 \u4e91 \u5185\u5b58\u578b\uff0c\u6d4b\u8bd5 \u5206\u5e03\u5f0f \u2714 \u2714 \u2714 \u274c \u6301\u4e45\u5316 \u2714 \u2714 \u2714 \u274c \u6027\u80fd Medium High Medium High <p><code>Azure Service Bus</code> vs <code>RabbitMQ</code> : http://geekswithblogs.net/michaelstephenson/archive/2012/08/12/150399.aspx</p> <p><code>Kafka</code> vs <code>RabbitMQ</code> :  https://stackoverflow.com/questions/42151544/is-there-any-reason-to-use-rabbitmq-over-kafka</p>"},{"location":"user-guide/zh/transport/general/#_4","title":"\u793e\u533a\u652f\u6301\u7684\u8fd0\u8f93\u5668","text":"<p>\u611f\u8c22\u793e\u533a\u5bf9CAP\u7684\u652f\u6301\uff0c\u4ee5\u4e0b\u662f\u793e\u533a\u652f\u6301\u7684\u8fd0\u8f93\u5668\u5b9e\u73b0</p> <ul> <li> <p>ActiveMQ (@Lukas Zhang): https://github.com/lukazh</p> </li> <li> <p>RedisMQ (@\u6728\u6728): https://github.com/difudotnet/CAP.RedisMQ.Extensions</p> </li> <li> <p>ZeroMQ (@maikebing): https://github.com/maikebing/CAP.Extensions/tree/master/src/DotNetCore.CAP.ZeroMQ</p> </li> <li> <p>MQTT (@john jiang): https://github.com/jinzaz/jinzaz.CAP.MQTT</p> </li> </ul>"},{"location":"user-guide/zh/transport/in-memory-queue/","title":"In-Memory Queue","text":"<p>In Memory Queue \u4e3a\u57fa\u4e8e\u5185\u5b58\u7684\u6d88\u606f\u961f\u5217\uff0c\u8be5\u6269\u5c55\u7531 \u793e\u533a \u8fdb\u884c\u63d0\u4f9b\u3002</p>"},{"location":"user-guide/zh/transport/in-memory-queue/#_1","title":"\u914d\u7f6e","text":"<p>\u8981\u4f7f\u7528 In Memory Queue \u4f5c\u4e3a\u6d88\u606f\u4f20\u8f93\u5668\uff0c\u4f60\u9700\u8981\u4ece NuGet \u5b89\u88c5\u4ee5\u4e0b\u6269\u5c55\u5305\uff1a</p> <pre><code>Install-Package Savorboard.CAP.InMemoryMessageQueue\n</code></pre> <p>\u7136\u540e\uff0c\u4f60\u53ef\u4ee5\u5728 <code>Startup.cs</code> \u7684 <code>ConfigureServices</code> \u65b9\u6cd5\u4e2d\u6dfb\u52a0\u57fa\u4e8e\u5185\u5b58\u7684\u914d\u7f6e\u9879\u3002</p> <pre><code>public void ConfigureServices(IServiceCollection services)\n{\n// ...\n\nservices.AddCap(x =&gt;\n{\nx.UseInMemoryMessageQueue();\n// x.UseXXX ...\n});\n}\n</code></pre>"},{"location":"user-guide/zh/transport/kafka/","title":"Apache Kafka\u00ae","text":"<p>Apache Kafka\u00ae \u662f\u4e00\u4e2a\u5f00\u6e90\u6d41\u5904\u7406\u8f6f\u4ef6\u5e73\u53f0\uff0c\u7531 LinkedIn \u5f00\u53d1\u5e76\u6350\u8d60\u7ed9 Apache Software Foundation\uff0c\u7528 Scala \u548c Java \u7f16\u5199\u3002</p> <p>CAP \u652f\u6301\u4f7f\u7528 Apache Kafka\u00ae \u4f5c\u4e3a\u6d88\u606f\u4f20\u8f93\u5668\u3002</p>"},{"location":"user-guide/zh/transport/kafka/#configuration","title":"Configuration","text":"<p>\u8981\u4f7f\u7528 Kafka \u4f5c\u4e3a\u6d88\u606f\u4f20\u8f93\u5668\uff0c\u4f60\u9700\u8981\u4ece NuGet \u5b89\u88c5\u4ee5\u4e0b\u6269\u5c55\u5305\uff1a</p> <pre><code>Install-Package DotNetCore.CAP.Kafka\n</code></pre> <p>\u7136\u540e\uff0c\u4f60\u53ef\u4ee5\u5728 <code>Startup.cs</code> \u7684 <code>ConfigureServices</code> \u65b9\u6cd5\u4e2d\u6dfb\u52a0\u57fa\u4e8e Kafka \u7684\u914d\u7f6e\u9879\u3002</p> <pre><code>public void ConfigureServices(IServiceCollection services)\n{\n// ...\n\nservices.AddCap(x =&gt;\n{\nx.UseKafka(opt=&gt;{\n//KafkaOptions\n});\n// x.UseXXX ...\n});\n}\n</code></pre>"},{"location":"user-guide/zh/transport/kafka/#kafka-options","title":"Kafka Options","text":"<p>CAP \u76f4\u63a5\u5bf9\u5916\u63d0\u4f9b\u7684 Kafka \u914d\u7f6e\u53c2\u6570\u5982\u4e0b\uff1a</p> NAME DESCRIPTION TYPE DEFAULT Servers Broker \u5730\u5740 string ConnectionPoolSize \u7528\u6237\u540d int 10 CustomHeaders \u8bbe\u7f6e\u81ea\u5b9a\u4e49\u5934 Function <p>\u6709\u5173 <code>CustomHeaders</code> \u7684\u8bf4\u660e\uff1a</p> <p>\u5982\u679c\u4f60\u60f3\u5728\u6d88\u8d39\u6d88\u606f\u7684\u65f6\u5019\uff0c\u901a\u8fc7\u4ece <code>CapHeader</code> \u83b7\u53d6 Kafka \u4e2d\u4f8b\u5982 Offset \u6216\u8005 Partition \u7b49\u4fe1\u606f\uff0c\u4f60\u53ef\u4ee5\u901a\u8fc7\u81ea\u5b9a\u4e49\u6b64\u51fd\u6570\u6765\u5b9e\u73b0\u8fd9\u4e00\u70b9\u3002</p> <p>\u4f8b\u5982\u4ee5\u4e0b\u4ee3\u7801\u4e3a\u4f60\u5c55\u793a\u4e86\u5982\u4f55\u8fdb\u884c\u8bbe\u7f6e\u989d\u5916\u7684\u53c2\u6570\u5230 <code>CapHeader</code> \u4e2d:</p> <pre><code>x.UseKafka(opt =&gt;\n{\n//...\n\nopt.CustomHeaders = kafkaResult =&gt; new List&lt;KeyValuePair&lt;string, string&gt;&gt;\n{\nnew KeyValuePair&lt;string, string&gt;(\"my.kafka.offset\", kafkaResult.Offset.ToString()),\nnew KeyValuePair&lt;string, string&gt;(\"my.kafka.partition\", kafkaResult.Partition.ToString())\n};\n});\n</code></pre> <p>\u7136\u540e\u4f60\u53ef\u4ee5\u901a\u8fc7\u8fd9\u4e2a\u65b9\u5f0f\u6765\u83b7\u53d6\u4f60\u6dfb\u52a0\u7684\u5934\u4fe1\u606f:</p> <pre><code>[CapSubscribe(\"sample.kafka.postgrsql\")]\npublic void HeadersTest(DateTime value, [FromCap]CapHeader header)\n{\nvar offset = header[\"my.kafka.offset\"];\nvar partition = header[\"my.kafka.partition\"];\n}\n</code></pre>"},{"location":"user-guide/zh/transport/kafka/#kafka-mainconfig-options","title":"Kafka MainConfig Options","text":"<p>\u5982\u679c\u4f60\u9700\u8981 \u66f4\u591a \u539f\u751f Kakfa \u76f8\u5173\u7684\u914d\u7f6e\u9879\uff0c\u53ef\u4ee5\u901a\u8fc7 <code>MainConfig</code> \u914d\u7f6e\u9879\u8fdb\u884c\u8bbe\u5b9a\uff1a</p> <pre><code>services.AddCap(capOptions =&gt; {\ncapOptions.UseKafka(kafkaOption=&gt;\n{\n// kafka options.\n// kafkaOptions.MainConfig.Add(\"\", \"\");\n});\n});\n</code></pre> <p>MainConfig \u4e3a\u914d\u7f6e\u5b57\u5178\uff0c\u4f60\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u94fe\u63a5\u627e\u5230\u5176\u652f\u6301\u7684\u914d\u7f6e\u9879\u5217\u8868\u3002</p> <p>https://github.com/edenhill/librdkafka/blob/master/CONFIGURATION.md</p>"},{"location":"user-guide/zh/transport/nats/","title":"NATS","text":"<p>NATS\u662f\u4e00\u4e2a\u7b80\u5355\u3001\u5b89\u5168\u3001\u9ad8\u6027\u80fd\u7684\u6570\u5b57\u7cfb\u7edf\u3001\u670d\u52a1\u548c\u8bbe\u5907\u901a\u4fe1\u7cfb\u7edf\u3002NATS \u662f CNCF \u7684\u4e00\u90e8\u5206\u3002</p> <p>Warning</p> <p>CAP 5.2.0 \u4ee5\u4e0b\u7684\u7248\u672c\u57fa\u4e8e Request/Response \u5b9e\u73b0, \u73b0\u5728\u6211\u4eec\u5df2\u7ecf\u57fa\u4e8e  JetStream \u5b9e\u73b0\u3002 \u67e5\u770b https://github.com/dotnetcore/CAP/issues/983 \u4e86\u89e3\u66f4\u591a\u3002 </p>"},{"location":"user-guide/zh/transport/nats/#_1","title":"\u914d\u7f6e","text":"<p>\u8981\u4f7f\u7528NATS \u4f20\u8f93\u5668\uff0c\u4f60\u9700\u8981\u5b89\u88c5\u4e0b\u9762\u7684NuGet\u5305\uff1a</p> <pre><code>PM&gt; Install-Package DotNetCore.CAP.NATS\n</code></pre> <p>\u4f60\u53ef\u4ee5\u901a\u8fc7\u5728 <code>Startup.cs</code> \u6587\u4ef6\u4e2d\u914d\u7f6e <code>ConfigureServices</code> \u6765\u6dfb\u52a0\u914d\u7f6e\uff1a</p> <pre><code>public void ConfigureServices(IServiceCollection services)\n{\nservices.AddCap(capOptions =&gt;\n{\ncapOptions.UseNATS(natsOptions=&gt;{\n//NATS Options\n});\n});\n}\n</code></pre>"},{"location":"user-guide/zh/transport/nats/#nats_1","title":"NATS \u914d\u7f6e","text":"<p>CAP \u76f4\u63a5\u63d0\u4f9b\u7684\u5173\u4e8e NATS \u7684\u914d\u7f6e\u53c2\u6570\uff1a</p> NAME DESCRIPTION TYPE DEFAULT Options NATS \u5ba2\u6237\u7aef\u914d\u7f6e Options Options Servers \u670d\u52a1\u5668Urls\u5730\u5740 string NULL ConnectionPoolSize \u8fde\u63a5\u6c60\u6570\u91cf uint 10"},{"location":"user-guide/zh/transport/nats/#nats-configurationoptions","title":"NATS ConfigurationOptions","text":"<p>\u5982\u679c\u4f60\u9700\u8981 \u66f4\u591a \u539f\u751f\u76f8\u5173\u7684\u914d\u7f6e\u9879\uff0c\u53ef\u4ee5\u901a\u8fc7 <code>Options</code> \u914d\u7f6e\u9879\u8fdb\u884c\u8bbe\u5b9a\uff1a</p> <pre><code>services.AddCap(capOptions =&gt; {\ncapOptions.UseNATS(natsOptions=&gt;\n{\n// NATS options.\nnatsOptions.Options.Url=\"\";\n});\n});\n</code></pre> <p><code>Options</code> \u662f NATS.Client \u5ba2\u6237\u7aef\u63d0\u4f9b\u7684\u914d\u7f6e\uff0c \u4f60\u53ef\u4ee5\u5728\u8fd9\u4e2a\u94fe\u63a5\u627e\u5230\u66f4\u591a\u8be6\u7ec6\u4fe1\u606f\u3002</p>"},{"location":"user-guide/zh/transport/pulsar/","title":"Apache Pulsar","text":"<p>Apache Pulsar \u662f\u4e00\u4e2a\u7528\u4e8e\u670d\u52a1\u5668\u5230\u670d\u52a1\u5668\u7684\u6d88\u606f\u7cfb\u7edf\uff0c\u5177\u6709\u591a\u79df\u6237\u3001\u9ad8\u6027\u80fd\u7b49\u4f18\u52bf\u3002 Pulsar \u6700\u521d\u7531 Yahoo \u5f00\u53d1\uff0c\u76ee\u524d\u7531 Apache \u8f6f\u4ef6\u57fa\u91d1\u4f1a\u7ba1\u7406\u3002</p> <p>CAP \u652f\u6301\u4f7f\u7528 Apache Pulsar \u4f5c\u4e3a\u6d88\u606f\u4f20\u8f93\u5668\u3002</p>"},{"location":"user-guide/zh/transport/pulsar/#configuration","title":"Configuration","text":"<p>\u8981\u4f7f\u7528 Pulsar \u4f5c\u4e3a\u6d88\u606f\u4f20\u8f93\u5668\uff0c\u4f60\u9700\u8981\u4ece NuGet \u5b89\u88c5\u4ee5\u4e0b\u6269\u5c55\u5305\uff1a</p> <pre><code>Install-Package DotNetCore.CAP.Pulsar\n</code></pre> <p>\u7136\u540e\uff0c\u4f60\u53ef\u4ee5\u5728 <code>Startup.cs</code> \u7684 <code>ConfigureServices</code> \u65b9\u6cd5\u4e2d\u6dfb\u52a0\u57fa\u4e8e Pulsar \u7684\u914d\u7f6e\u9879\u3002</p> <pre><code>public void ConfigureServices(IServiceCollection services)\n{\n// ...\n\nservices.AddCap(x =&gt;\n{\nx.UsePulsar(opt =&gt; {\n//Pulsar Options\n});\n// x.UseXXX ...\n});\n}\n</code></pre>"},{"location":"user-guide/zh/transport/pulsar/#pulsar-options","title":"Pulsar Options","text":"<p>CAP \u76f4\u63a5\u5bf9\u5916\u63d0\u4f9b\u7684 Pulsar \u914d\u7f6e\u53c2\u6570\u5982\u4e0b\uff1a</p> NAME DESCRIPTION TYPE DEFAULT ServiceUrl Broker \u5730\u5740 string TlsOptions TLS \u914d\u7f6e\u9879 object"},{"location":"user-guide/zh/transport/rabbitmq/","title":"RabbitMQ","text":"<p>RabbitMQ\u662f\u5b9e\u73b0\u4e86\u9ad8\u7ea7\u6d88\u606f\u961f\u5217\u534f\u8bae\uff08AMQP\uff09\u7684\u5f00\u6e90\u6d88\u606f\u4ee3\u7406\u8f6f\u4ef6\uff08\u4ea6\u79f0\u9762\u5411\u6d88\u606f\u7684\u4e2d\u95f4\u4ef6\uff09\u3002RabbitMQ \u670d\u52a1\u5668\u662f\u7528 Erlang \u8bed\u8a00\u7f16\u5199\u7684\uff0c\u800c\u805a\u7c7b\u548c\u6545\u969c\u8f6c\u79fb\u662f\u6784\u5efa\u5728\u5f00\u6e90\u7684\u901a\u8baf\u5e73\u53f0\u6846\u67b6\u4e0a\u7684\u3002\u6240\u6709\u4e3b\u8981\u7684\u7f16\u7a0b\u8bed\u8a00\u5747\u6709\u4e0e\u4ee3\u7406\u63a5\u53e3\u901a\u8baf\u7684\u5ba2\u6237\u7aef\u5e93\u3002</p> <p>CAP \u652f\u6301\u4f7f\u7528 RabbitMQ \u4f5c\u4e3a\u6d88\u606f\u4f20\u8f93\u5668\u3002</p>"},{"location":"user-guide/zh/transport/rabbitmq/#_1","title":"\u914d\u7f6e","text":"<p>\u8981\u4f7f\u7528 RabbitMQ \u4f5c\u4e3a\u6d88\u606f\u4f20\u8f93\u5668\uff0c\u4f60\u9700\u8981\u4ece NuGet \u5b89\u88c5\u4ee5\u4e0b\u6269\u5c55\u5305\uff1a</p> <pre><code>Install-Package DotNetCore.CAP.RabbitMQ\n</code></pre> <p>\u7136\u540e\uff0c\u4f60\u53ef\u4ee5\u5728 <code>Startup.cs</code> \u7684 <code>ConfigureServices</code> \u65b9\u6cd5\u4e2d\u6dfb\u52a0\u57fa\u4e8e RabbitMQ \u7684\u914d\u7f6e\u9879\u3002</p> <pre><code>public void ConfigureServices(IServiceCollection services)\n{\n// ...\n\nservices.AddCap(x =&gt;\n{\nx.UseRabbitMQ(opt=&gt;\n{\n//RabbitMQOptions\n});\n// x.UseXXX ...\n});\n}\n</code></pre>"},{"location":"user-guide/zh/transport/rabbitmq/#rabbitmq-options","title":"RabbitMQ Options","text":"<p>CAP \u76f4\u63a5\u5bf9\u5916\u63d0\u4f9b\u7684 RabbitMQ \u914d\u7f6e\u53c2\u6570\u5982\u4e0b\uff1a</p> \u914d\u7f6e\u9879 \u63cf\u8ff0 \u7c7b\u578b \u9ed8\u8ba4\u503c HostName \u5bbf\u4e3b\u5730\u5740\uff0c\u5982\u679c\u8981\u914d\u7f6e\u96c6\u7fa4\u53ef\u4ee5\u4f7f\u7528\u9017\u53f7\u5206\u9694\uff0c\u4f8b\u5982 <code>192.168.1.111,192.168.1.112</code> string localhost UserName \u7528\u6237\u540d string guest Password \u5bc6\u7801 string guest VirtualHost \u865a\u62df\u4e3b\u673a string / Port \u7aef\u53e3\u53f7 int -1 ExchangeName CAP\u9ed8\u8ba4Exchange\u540d\u79f0 string cap.default.topic QueueArguments \u961f\u5217\u989d\u5916\u53c2\u6570 x-arguments QueueArgumentsOptions N/A ConnectionFactoryOptions RabbitMQClient\u539f\u751f\u53c2\u6570 ConnectionFactory N/A CustomHeaders \u8ba2\u9605\u8005\u81ea\u5b9a\u4e49\u5934\u4fe1\u606f \u89c1\u4e0b\u6587 N/A PublishConfirms \u662f\u5426\u542f\u7528\u53d1\u5e03\u786e\u8ba4 bool false BasicQosOptions \u6307\u5b9a\u6d88\u8d39\u7684Qos BasicQos N/A"},{"location":"user-guide/zh/transport/rabbitmq/#connectionfactory-option","title":"ConnectionFactory Option","text":"<p>\u5982\u679c\u4f60\u9700\u8981 \u66f4\u591a \u539f\u751f <code>ConnectionFactory</code> \u76f8\u5173\u7684\u914d\u7f6e\u9879\uff0c\u53ef\u4ee5\u901a\u8fc7 <code>ConnectionFactoryOptions</code> \u914d\u7f6e\u9879\u8fdb\u884c\u8bbe\u5b9a\uff1a</p> <pre><code>services.AddCap(x =&gt;\n{\nx.UseRabbitMQ(o =&gt;\n{\no.HostName = \"localhost\";\no.ConnectionFactoryOptions = opt =&gt; { //rabbitmq client ConnectionFactory config\n};\n});\n});\n</code></pre>"},{"location":"user-guide/zh/transport/rabbitmq/#customheaders-option","title":"CustomHeaders Option","text":"<p>\u5f53\u9700\u8981\u4ece\u5f02\u6784\u7cfb\u7edf\u6216\u8005\u76f4\u63a5\u63a5\u6536\u4eceRabbitMQ \u63a7\u5236\u53f0\u53d1\u9001\u7684\u6d88\u606f\u65f6\uff0c\u7531\u4e8e CAP \u9700\u8981\u5b9a\u4e49\u989d\u5916\u7684\u5934\u4fe1\u606f\u624d\u80fd\u6b63\u5e38\u8ba2\u9605\uff0c\u6240\u4ee5\u6b64\u65f6\u4f1a\u51fa\u73b0\u5f02\u5e38\u3002\u901a\u8fc7\u63d0\u4f9b\u6b64\u53c2\u6570\u6765\u8fdb\u884c\u81ea\u5b9a\u4e49\u5934\u4fe1\u606f\u7684\u8bbe\u7f6e\u6765\u4f7f\u8ba2\u9605\u8005\u6b63\u5e38\u5de5\u4f5c\u3002</p> <p>\u4f60\u53ef\u4ee5\u5728\u8fd9\u91cc\u627e\u5230\u6709\u5173 \u5934\u4fe1\u606f \u7684\u8bf4\u660e\u3002</p> <p>\u7528\u6cd5\u5982\u4e0b\uff1a</p> <pre><code>x.UseRabbitMQ(aa =&gt;\n{\naa.CustomHeaders = e =&gt; new List&lt;KeyValuePair&lt;string, string&gt;&gt;\n{\nnew KeyValuePair&lt;string, string&gt;(Headers.MessageId, SnowflakeId.Default().NextId().ToString()),\nnew KeyValuePair&lt;string, string&gt;(Headers.MessageName, e.RoutingKey),\n};\n});\n</code></pre>"},{"location":"user-guide/zh/transport/rabbitmq/#rabbitmq_1","title":"\u5982\u4f55\u8fde\u63a5 RabbitMQ \u96c6\u7fa4\uff1f","text":"<p>\u4f7f\u7528\u9017\u53f7\u5206\u9694\u8fde\u63a5\u5b57\u7b26\u4e32\u5373\u53ef\uff0c\u5982\u4e0b\uff1a</p> <pre><code>x=&gt; x.UseRabbitMQ(\"localhost:5672,localhost:5673,localhost:5674\")\n</code></pre>"},{"location":"user-guide/zh/transport/redis-streams/","title":"Redis Streams","text":"<p>Redis \u662f\u4e00\u4e2a\u5f00\u6e90\uff08BSD\u8bb8\u53ef\uff09\u7684\uff0c\u5185\u5b58\u4e2d\u7684\u6570\u636e\u7ed3\u6784\u5b58\u50a8\u7cfb\u7edf\uff0c\u5b83\u53ef\u4ee5\u7528\u4f5c\u6570\u636e\u5e93\u3001\u7f13\u5b58\u548c\u6d88\u606f\u4e2d\u95f4\u4ef6\u3002</p> <p>Redis Stream \u662f Redis 5.0 \u5f15\u5165\u7684\u4e00\u79cd\u65b0\u6570\u636e\u7c7b\u578b\uff0c\u5b83\u7528\u4e00\u79cd\u4ec5\u9644\u52a0\u7684\u6570\u636e\u7ed3\u6784\u4ee5\u66f4\u62bd\u8c61\u7684\u65b9\u5f0f\u6a21\u62df\u65e5\u5fd7\u6570\u636e\u7ed3\u6784\u3002</p> <p>Redis Streams \u53ef\u4ee5\u5728 CAP \u4e2d\u7528\u4f5c\u6d88\u606f\u4f20\u8f93\u5668\u3002 </p>"},{"location":"user-guide/zh/transport/redis-streams/#_1","title":"\u914d\u7f6e","text":"<p>\u8981\u4f7f\u7528 Redis Streams \u4f20\u8f93\u5668\uff0c\u60a8\u9700\u8981\u4ece NuGet \u5b89\u88c5\u4ee5\u4e0b\u5305\uff1a</p> <pre><code>PM&gt; Install-Package DotNetCore.CAP.RedisStreams\n</code></pre> <p>\u7136\u540e\uff0c\u60a8\u53ef\u4ee5\u5728 <code>Startup.cs</code> \u7684 <code>ConfigureServices</code> \u65b9\u6cd5\u4e2d\u6dfb\u52a0\u57fa\u4e8e Redis Stream \u7684\u914d\u7f6e\u9879\u3002 </p> <pre><code>public void ConfigureServices(IServiceCollection services)\n{\nservices.AddCap(capOptions =&gt;\n{\ncapOptions.UseRedis(redisOptions=&gt;{\n//redisOptions\n});\n});\n}\n</code></pre>"},{"location":"user-guide/zh/transport/redis-streams/#redis-streams-options","title":"Redis Streams Options","text":"<p>CAP \u76f4\u63a5\u5bf9\u5916\u63d0\u4f9b\u7684 Redis Stream \u914d\u7f6e\u53c2\u6570\u5982\u4e0b\uff1a</p> NAME DESCRIPTION TYPE DEFAULT Configuration redis\u8fde\u63a5\u914d\u7f6e (StackExchange.Redis) ConfigurationOptions ConfigurationOptions StreamEntriesCount \u8bfb\u53d6\u65f6\u4ece stream \u8fd4\u56de\u7684\u6761\u76ee\u6570 uint 10 ConnectionPoolSize \u8fde\u63a5\u6c60\u6570 uint 10"},{"location":"user-guide/zh/transport/redis-streams/#redis-configuration-options","title":"Redis Configuration Options","text":"<p>\u5982\u679c\u9700\u8981**\u66f4\u591a**\u539f\u751fRedis\u76f8\u5173\u914d\u7f6e\u9009\u9879\uff0c\u60a8\u53ef\u4ee5\u5728 <code>Configuration</code> \u9009\u9879\u4e2d\u8fdb\u884c\u8bbe\u7f6e :</p> <pre><code>services.AddCap(capOptions =&gt; {\ncapOptions.UseRedis(redisOptions=&gt;\n{\n// redis options.\nredisOptions.Configuration.EndPoints.Add(IPAddress.Loopback, 0);\n});\n});\n</code></pre> <p><code>Configuration</code> \u662f StackExchange.Redis ConfigurationOptions \uff0c\u60a8\u53ef\u4ee5\u901a\u8fc7\u6b64\u94fe\u63a5\u627e\u5230\u66f4\u591a\u8be6\u7ec6\u4fe1\u606f\u3002</p>"},{"location":"user-guide/zh/transport/redis-streams/#_2","title":"\u6d41\u6e05\u7406\u6ce8\u610f\u4e8b\u9879","text":"<p>\u7531\u4e8eredis streams \u6ca1\u6709\u81ea\u52a8\u5220\u9664\u6240\u6709\u5df2\u7ecf\u88ab\u6240\u6709\u7ec4\u786e\u8ba4\u7684\u6d88\u606f\u7684\u7279\u6027issue\uff0c\u6240\u4ee5\u4f60\u9700\u8981\u8003\u8651\u662f\u5426\u4f7f\u7528\u811a\u672c\u6765\u6267\u884c\u5b9a\u671f\u5220\u9664\u3002</p>"}]}